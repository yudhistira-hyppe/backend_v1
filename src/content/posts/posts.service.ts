import { Logger, Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { DBRef, Long, ObjectId } from 'mongodb';
import mongoose, { Model, Types } from 'mongoose';
import { CreatePostResponse, CreatePostsDto, PostResponseApps } from './dto/create-posts.dto';
import { Posts, PostsDocument } from './schemas/posts.schema';
import { GetuserprofilesService } from '../../trans/getuserprofiles/getuserprofiles.service';
import { UserbasicsService } from '../../trans/userbasics/userbasics.service';
import { GlobalResponse } from '../../utils/data/globalResponse';
import { Mediavideos, MediavideosDocument } from '../mediavideos/schemas/mediavideos.schema';
import { UtilsService } from '../../utils/utils.service';
import { InterestsService } from '../../infra/interests/interests.service';
import { UserauthsService } from '../../trans/userauths/userauths.service';
import { MediavideosService } from '../mediavideos/mediavideos.service';
import { InsightsService } from '../insights/insights.service';
import { Insights } from '../insights/schemas/insights.schema';
import axios from 'axios';
import { ConfigService } from '@nestjs/config';
import { createWriteStream, unlink } from 'fs'
import { ContentDto } from '../disqus/dto/create-disqus.dto';
import { Userbasic } from '../../trans/userbasics/schemas/userbasic.schema';
import { ContenteventsService } from '../contentevents/contentevents.service';
import { Contentevents } from '../contentevents/schemas/contentevents.schema';
import { ErrorHandler } from '../../utils/error.handler';
import { MediadiariesService } from '../../content/mediadiaries/mediadiaries.service';
import { MediastoriesService } from '../../content/mediastories/mediastories.service';
import { MediapictsService } from '../../content/mediapicts/mediapicts.service';
import { CreateUserplaylistDto } from '../../trans/userplaylist/dto/create-userplaylist.dto';
import { UserplaylistService } from '../../trans/userplaylist/userplaylist.service';
import { InjectQueue, Process, Processor } from '@nestjs/bull';
import { SeaweedfsService } from '../../stream/seaweedfs/seaweedfs.service';
import { SettingsService } from '../../trans/settings/settings.service';
import * as fs from 'fs';

import { Queue, Job } from 'bull';


@Injectable()
export class PostsService {
  private readonly logger = new Logger(PostsService.name);

  constructor(
    @InjectQueue('post-user-playlist') private generateUserPlaylistqueue: Queue,
    @InjectModel(Posts.name, 'SERVER_FULL')
    private readonly PostsModel: Model<PostsDocument>,
    private getuserprofilesService: GetuserprofilesService,
    private userService: UserbasicsService,
    private readonly utilsService: UtilsService,
    private readonly errorHandler: ErrorHandler,
    private interestService: InterestsService,
    private userAuthService: UserauthsService,
    private videoService: MediavideosService,
    private insightService: InsightsService,
    private contentEventService: ContenteventsService,
    private readonly mediadiariesService: MediadiariesService,
    private readonly mediastoriesService: MediastoriesService,
    private readonly mediavideosService: MediavideosService,
    private readonly mediapictsService: MediapictsService,
    private readonly configService: ConfigService,
    private readonly userplaylistService: UserplaylistService,
    private readonly seaweedfsService: SeaweedfsService,
    private readonly settingsService: SettingsService,

  ) { }

  async findChild(): Promise<Posts[]> {
    return this.PostsModel.find({ $or: [{ reportedUser: { $elemMatch: { email: { $ne: "tjikaljedy@hyppe.id" } } } }, { reportedUser: { $exists: false } }] }).exec();
  }

  async create(CreatePostsDto: CreatePostsDto): Promise<Posts> {
    const createPostsDto = await this.PostsModel.create(CreatePostsDto);
    return createPostsDto;
  }

  async findAll(): Promise<Posts[]> {
    return this.PostsModel.find().exec();
  }

  async findOneByMedias(mediaID: string): Promise<Posts> {
    return this.PostsModel.findOne({ 'contentMedias.$id': mediaID }).exec();
  }

  async findAllSort(): Promise<Posts[]> {
    return this.PostsModel.find().sort({ createdAt: -1 }).exec();
  }

  async findid(id: string): Promise<Posts> {
    return this.PostsModel.findOne({ _id: id }).exec();
  }

  async findOne(email: string): Promise<Posts> {
    return this.PostsModel.findOne({ email: email }).exec();
  }

  async findUserPost(email: string): Promise<number> {
    return this.PostsModel.where('email', email).where('active', true).where('postType').ne('story').count();
  }

  async findByPostId(postID: string): Promise<Posts> {
    return this.PostsModel.findOne({ postID: postID }).exec();
  }
  async updateByPostId(
    postID: string,
    CreatePostsDto: CreatePostsDto,
  ): Promise<Object> {
    return await this.PostsModel.updateOne(
      { postID: postID },
      CreatePostsDto
    );
  }

  async update(
    id: string,
    CreatePostsDto: CreatePostsDto,
  ): Promise<Posts> {
    let data = await this.PostsModel.findByIdAndUpdate(
      id,
      CreatePostsDto,
      { new: true },
    );

    if (!data) {
      throw new Error('Todo is not found!');
    }
    return data;
  }

  async findOnepostID(postID: string): Promise<Object> {
    var datacontent = null;
    var CreatePostsDto_ = await this.PostsModel.findOne({ postID: postID }).exec();
    if (await this.utilsService.ceckData(CreatePostsDto_)) {

      if (CreatePostsDto_.postType == 'vid') {
        datacontent = 'mediavideos';
      } else if (CreatePostsDto_.postType == 'pict') {
        datacontent = 'mediapicts';
      } else if (CreatePostsDto_.postType == 'diary') {
        datacontent = 'mediadiaries';
      } else if (CreatePostsDto_.postType == 'story') {
        datacontent = 'mediastories';
      }

      //Ceck User Userbasics
      const datauserbasicsService = await this.utilsService.generateProfile(
        CreatePostsDto_.email.toString(), "FULL");

      const query = await this.PostsModel.aggregate([
        {
          $match: {
            postID: postID
          }
        },
        {
          $lookup: {
            from: datacontent,
            localField: "postID",
            foreignField: "postID",
            as: "datacontent"
          }
        },
      ]);
      Object.assign(query[0], { datauser: datauserbasicsService });
      return query;
    } else {
      return null;
    }
  }

  async updateView(email: string, postID: string) {
    this.PostsModel.updateOne(
      {
        email: email,
        postID: postID,
      },
      { $inc: { views: 1 } },
      function (err, docs) {
        if (err) {
          console.log(err);
        } else {
          console.log(docs);
        }
      },
    );
  }

  async updateReaction(email: string, postID: string) {
    this.PostsModel.updateOne(
      {
        email: email,
        postID: postID,
      },
      { $inc: { reactions: 1 } },
      function (err, docs) {
        if (err) {
          console.log(err);
        } else {
          console.log(docs);
        }
      },
    );
  }

  async updateLike(email: string, postID: string) {
    this.PostsModel.updateOne(
      {
        email: email,
        postID: postID,
      },
      { $inc: { likes: 1 } },
      function (err, docs) {
        if (err) {
          console.log(err);
        } else {
          console.log(docs);
        }
      },
    );
  }

  async updateUnLike(email: string, postID: string) {
    this.PostsModel.updateOne(
      {
        email: email,
        postID: postID,
      },
      { $inc: { likes: -1 } },
      function (err, docs) {
        if (err) {
          console.log(err);
        } else {
          console.log(docs);
        }
      },
    );
  }

  async updateBuyBoostToNoBoost(id: string, boosted: any) {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "boosted": boosted,
        },
        $unset: { isBoost: 1 }
      });
    return data;
  }

  async updateemail(id: string, email: string, iduser: {
    "$oid": string
  }, createdAt: string): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "email": email, "userProfile": {
            "$ref": "userbasics",
            "$id": iduser,
            "$db": "hyppe_trans_db"
          },
          "saleAmount": 0,
          "certified": true,
          "createdAt": createdAt,
          "updatedAt": createdAt,
          "metadata.email": email
        }
      });
    return data;
  }

  async updatesalelike(id: string): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "salelike": false,
          "saleAmount": 0
        }
      });
    return data;
  }

  async updatesaleview(id: string): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "saleview": false,
          "saleAmount": 0
        }
      });
    return data;
  }

  async updateprice(id: string, saleAmount: number): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "saleAmount": saleAmount
        }
      });
    return data;
  }

  async updatenonaktif(id: string): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "active": false
        }
      });
    return data;
  }
  async updateTag(id: string, tagPeople: []): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "tagPeople": tagPeople
        }
      });

    return data;
  }

  async updateNoneActive(email: string) {
    this.PostsModel.updateMany(
      {
        email: email,
      },
      {
        $set: {
          "active": false,
          "email": email + '_noneactive'
        }
      },
      function (err, docs) {
        if (err) {
          //console.log(err);
        } else {
          //console.log(docs);
        }
      },
    );
  }

  async updateTags(id: string, idauth: Types.ObjectId) {



    let data = await this.PostsModel.updateOne({ "_id": id }, {
      $pull: {
        "tagPeople": { "$in": [{ "$ref": "userauths", "$id": idauth, "$db": "hyppe_trans_db" }] }
      }
    });
    return data;
  }

  async updateReportuser(postID: string, reportedStatus: string, reportedUserCount: number, reportedUser: any[], contentModeration: boolean, contentModerationResponse: string, reportedUserHandle: any[]): Promise<Object> {
    let data = await this.PostsModel.updateOne({ "postID": postID },
      { $set: { "reportedStatus": reportedStatus, "reportedUserCount": reportedUserCount, "reportedUser": reportedUser, "contentModeration": contentModeration, "contentModerationResponse": contentModerationResponse, "reportedUserHandle": reportedUserHandle } });
    return data;
  }

  async updateStatusCB(id: string, cb: string) {
    let data = await this.PostsModel.updateOne({ "_id": id },
      {
        $set: {
          "statusCB": cb,
        }
      });
    return data;
  }

  async delete(id: string) {
    const deletedCat = await this.PostsModel.findByIdAndRemove({
      _id: id,
    }).exec();
    return deletedCat;
  }

  async MonetizeByYear(year: number): Promise<Object> {
    var currentTime = new Date();
    var year_param = 0;
    if (year != undefined) {
      year_param = year;
    } else {
      year_param = currentTime.getFullYear();
    }
    const monthsArray = [
      'Jan',
      'Feb',
      'Mar',
      'Apr',
      'May',
      'Jun',
      'Jul',
      'Aug',
      'Sep',
      'Oct',
      'Nov',
      'Dec',
    ];
    var GetCount = this.PostsModel.aggregate([
      {
        $sort: { createdAt: 1 },
      },
      {
        $project: {
          certified: '$certified',
          createdAt: '$createdAt',
          YearcreatedAt: { $toInt: { $substrCP: ['$createdAt', 0, 4] } },
          year_param: { $toInt: year_param.toString() },
        },
      },
      {
        $match: {
          certified: { $ne: null },
          YearcreatedAt: year_param,
        },
      },
      {
        $group: {
          _id: {
            year_month: { $substrCP: ['$createdAt', 0, 7] },
            isCertified_data: '$certified',
          },
          isCertified_data_count: { $sum: 1 },
        },
      },
      {
        $group: {
          _id: '$_id.year_month',
          log: {
            $push: {
              isCertified_data: '$_id.isCertified_data',
              isCertified_data_count_: '$isCertified_data_count',
            },
          },
          count: { $sum: '$isCertified_data_count' },
        },
      },
      {
        $project: {
          _id: 0,
          count: 1,
          month_int: { $toInt: { $substrCP: ['$_id', 5, 2] } },
          month_: { $substrCP: ['$_id', 5, 2] },
          monet: '$log',
          month_name_: {
            $arrayElemAt: [
              monthsArray,
              {
                $subtract: [{ $toInt: { $substrCP: ['$_id', 5, 2] } }, 1],
              },
            ],
          },
          year_: { $substrCP: ['$_id', 0, 4] },
        },
      },
      {
        $sort: { month_int: 1 },
      },
      {
        $project: {
          _id: 0,
          month_name: '$month_name_',
          month: '$month_',
          year: { $toInt: '$year_' },
          monitize: '$monet',
          count_all: { $sum: '$monet.isCertified_data_count_' },
        },
      },
    ]).exec();
    return GetCount;
  }

  // async findpost() {
  //   const query = await this.PostsModel.aggregate([

  //     {
  //       $lookup: {
  //         from: 'posts',
  //         localField: 'posts.$id',
  //         foreignField: '_id',
  //         as: 'roless',
  //       },
  //     }, {
  //       $out: {
  //         db: 'hyppe_trans_db',
  //         coll: 'posts2'
  //       }
  //     },

  //   ]);
  //   return query;
  // }

  async regcontenMonetize(): Promise<Object> {
    var GetCount = this.PostsModel.aggregate([
      {
        $addFields: {
          contentMedias_id: '$contentMedias.$id',
          contentMedias_ref: { $arrayElemAt: ['$contentMedias.$ref', 0] },
          metadata_duration: '$metadata.duration',
          metadata_duration_second: {
            $floor: {
              $mod: ['$metadata.duration', 60],
            },
          },
          metadata_duration_minute: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 3600],
                },
                60,
              ],
            },
          },
          metadata_duration_hour: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 86400],
                },
                3600,
              ],
            },
          },
        },
      },
      {
        $sort: { createdAt: 1 },
      },
      {
        $match: {
          certified: false,
          active: true,
        },
      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediavideos',
        },
      },
      {
        $lookup: {
          from: 'mediapicts',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediapicts',
        },
      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediadiaries',
        },
      },
      {
        $lookup: {
          from: 'mediastories',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediastories',
        },
      },
      {
        $group: {
          _id: '$certified',
          log: {
            $push: {
              email: '$email',
              postType: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$postType', 'vid'] },
                      then: 'HyppeVid',
                    },
                    {
                      case: { $eq: ['$postType', 'pic'] },
                      then: 'HyppePic',
                    },
                    {
                      case: { $eq: ['$postType', 'diary'] },
                      then: 'HyppeDiary',
                    },
                    {
                      case: { $eq: ['$postType', 'story'] },
                      then: 'HyppeStory',
                    },
                  ],
                  default: [],
                },
              },
              duration: {
                $cond: {
                  if: { $ne: ['$metadata_duration_hour', 0] },
                  then: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                  else: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                },
              },
              description: '$description',
              visibility: '$visibility',
              tags: '$tags',
              allowComments: '$allowComments',
              metadata: '$metadata',
              likes: '$likes',
              views: '$views',
              shares: '$shares',
              comments: '$comments',
              reactions: '$reactions',
              // contentMedias_ref: '$contentMedias_ref',
              // contentMedias_id: '$contentMedias_id',
              // contentMedias_ref: '$customfield',
              // contentMedias_mediavideos: '$contentMedias_mediavideos',
              // contentMedias_mediapicts: '$contentMedias_mediavideos',
              // contentMedias_mediadiaries: '$contentMedias_mediavideos',
              // contentMedias_mediastories: '$contentMedias_mediastories',
              contentMedias: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediavideos'] },
                      then: '$contentMedias_mediavideos',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediapicts'] },
                      then: '$contentMedias_mediapicts',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediadiaries'] },
                      then: '$contentMedias_mediadiaries',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediastories'] },
                      then: '$contentMedias_mediastories',
                    },
                  ],
                  default: [],
                },
              },
            },
          },
          count: { $sum: 1 },
        },
      },
      {
        $project: {
          _id: 0,
          count: '$count',
          content: '$log',
        },
      },
    ]).exec();
    return GetCount;
  }

  async newcontenMonetize(): Promise<Object> {
    var GetCount = this.PostsModel.aggregate([
      {
        $addFields: {
          contentMedias_id: '$contentMedias.$id',
          contentMedias_ref: { $arrayElemAt: ['$contentMedias.$ref', 0] },
          metadata_duration: '$metadata.duration',
          metadata_duration_second: {
            $floor: {
              $mod: ['$metadata.duration', 60],
            },
          },
          metadata_duration_minute: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 3600],
                },
                60,
              ],
            },
          },
          metadata_duration_hour: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 86400],
                },
                3600,
              ],
            },
          },
        },
      },
      {
        $sort: { createdAt: 1 },
      },
      {
        $match: {
          certified: true,
          active: true,
        },
      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediavideos',
        },
      },
      {
        $lookup: {
          from: 'mediapicts',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediapicts',
        },
      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediadiaries',
        },
      },
      {
        $lookup: {
          from: 'mediastories',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediastories',
        },
      },
      {
        $group: {
          _id: '$certified',
          log: {
            $push: {
              email: '$email',
              postType: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$postType', 'vid'] },
                      then: 'HyppeVid',
                    },
                    {
                      case: { $eq: ['$postType', 'pic'] },
                      then: 'HyppePic',
                    },
                    {
                      case: { $eq: ['$postType', 'diary'] },
                      then: 'HyppeDiary',
                    },
                    {
                      case: { $eq: ['$postType', 'story'] },
                      then: 'HyppeStory',
                    },
                  ],
                  default: [],
                },
              },
              duration: {
                $cond: {
                  if: { $ne: ['$metadata_duration_hour', 0] },
                  then: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                  else: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                },
              },
              description: '$description',
              visibility: '$visibility',
              tags: '$tags',
              allowComments: '$allowComments',
              metadata: '$metadata',
              likes: '$likes',
              views: '$views',
              shares: '$shares',
              comments: '$comments',
              reactions: '$reactions',
              // contentMedias_ref: '$contentMedias_ref',
              // contentMedias_id: '$contentMedias_id',
              // contentMedias_ref: '$customfield',
              // contentMedias_mediavideos: '$contentMedias_mediavideos',
              // contentMedias_mediapicts: '$contentMedias_mediavideos',
              // contentMedias_mediadiaries: '$contentMedias_mediavideos',
              // contentMedias_mediastories: '$contentMedias_mediastories',
              contentMedias: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediavideos'] },
                      then: '$contentMedias_mediavideos',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediapicts'] },
                      then: '$contentMedias_mediapicts',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediadiaries'] },
                      then: '$contentMedias_mediadiaries',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediastories'] },
                      then: '$contentMedias_mediastories',
                    },
                  ],
                  default: [],
                },
              },
            },
          },
          count: { $sum: 1 },
        },
      },
      {
        $project: {
          _id: 0,
          count: '$count',
          content: '$log',
        },
      },
    ]).exec();
    return GetCount;
  }

  async getContent(email: string, type: string): Promise<Object> {
    var GetCount = this.PostsModel.aggregate([
      {
        $addFields: {
          contentMedias_id: '$contentMedias.$id',
          contentMedias_ref: { $arrayElemAt: ['$contentMedias.$ref', 0] },
          metadata_duration: '$metadata.duration',
          metadata_duration_second: {
            $floor: {
              $mod: ['$metadata.duration', 60],
            },
          },
          metadata_duration_minute: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 3600],
                },
                60,
              ],
            },
          },
          metadata_duration_hour: {
            $floor: {
              $divide: [
                {
                  $mod: [{ $mod: ['$metadata.duration', 60] }, 86400],
                },
                3600,
              ],
            },
          },
        },
      },
      {
        $sort: { createdAt: 1 },
      },
      {
        $match: {
          email: email,
          //isCertified: false,
          //active: true,
        },
      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediavideos',
        },
      },
      {
        $lookup: {
          from: 'mediapicts',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediapicts',
        },
      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediadiaries',
        },
      },
      {
        $lookup: {
          from: 'mediastories',
          localField: 'contentMedias_id',
          foreignField: '_id',
          as: 'contentMedias_mediastories',
        },
      },
      {
        $group: {
          _id: '$certified',
          log: {
            $push: {
              email: '$email',
              postType: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$postType', 'vid'] },
                      then: 'HyppeVid',
                    },
                    {
                      case: { $eq: ['$postType', 'pic'] },
                      then: 'HyppePic',
                    },
                    {
                      case: { $eq: ['$postType', 'diary'] },
                      then: 'HyppeDiary',
                    },
                    {
                      case: { $eq: ['$postType', 'story'] },
                      then: 'HyppeStory',
                    },
                  ],
                  default: [],
                },
              },
              duration: {
                $cond: {
                  if: { $ne: ['$metadata_duration_hour', 0] },
                  then: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_hour',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                  else: {
                    $cond: {
                      if: { $lt: ['$metadata_duration_minute', 10] },
                      then: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              '0',
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                      else: {
                        $cond: {
                          if: { $lt: ['$metadata_duration_second', 10] },
                          then: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              '0',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                          else: {
                            $concat: [
                              {
                                $toString: '$metadata_duration_minute',
                              },
                              ':',
                              {
                                $toString: '$metadata_duration_second',
                              },
                            ],
                          },
                        },
                      },
                    },
                  },
                },
              },
              description: '$description',
              visibility: '$visibility',
              tags: '$tags',
              allowComments: '$allowComments',
              metadata: '$metadata',
              likes: '$likes',
              views: '$views',
              shares: '$shares',
              comments: '$comments',
              reactions: '$reactions',
              // contentMedias_ref: '$contentMedias_ref',
              // contentMedias_id: '$contentMedias_id',
              // contentMedias_ref: '$customfield',
              // contentMedias_mediavideos: '$contentMedias_mediavideos',
              // contentMedias_mediapicts: '$contentMedias_mediavideos',
              // contentMedias_mediadiaries: '$contentMedias_mediavideos',
              // contentMedias_mediastories: '$contentMedias_mediastories',
              contentMedias: {
                $switch: {
                  branches: [
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediavideos'] },
                      then: '$contentMedias_mediavideos',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediapicts'] },
                      then: '$contentMedias_mediapicts',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediadiaries'] },
                      then: '$contentMedias_mediadiaries',
                    },
                    {
                      case: { $eq: ['$contentMedias_ref', 'mediastories'] },
                      then: '$contentMedias_mediastories',
                    },
                  ],
                  default: [],
                },
              },
            },
          },
          count: { $sum: 1 },
        },
      },
      {
        $project: {
          _id: 0,
          count: '$count',
          content: '$log',
        },
      },
    ]).exec();
    return GetCount;
  }

  // generateUserPlaylist_(CreateUserplaylistDto_: CreateUserplaylistDto) {
  //   const job = this.generateUserPlaylistqueue.add('generate', {
  //     CreateUserplaylistDto_
  //   });
  //   return {
  //     jobId: job.id
  //   }
  // }

  async generateUserPlaylist(CreateUserplaylistDto_: CreateUserplaylistDto) {
    console.log("----------------------------------------" + new Date().toString() + "----------------------------------------");
    if (CreateUserplaylistDto_.userPostId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param userPostId is required',
      );
    }
    if (CreateUserplaylistDto_.mediaId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param mediaId is required',
      );
    }
    if (CreateUserplaylistDto_.postType == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param postType is required',
      );
    }

    var userPostId = CreateUserplaylistDto_.userPostId;
    var mediaId = CreateUserplaylistDto_.mediaId;
    var postType = CreateUserplaylistDto_.postType;

    var current_date = await this.utilsService.getDateTimeString();
    var data_userbasic_all = await this.userService.findAll();
    var data_media = null;

    if (postType == "vid") {
      data_media = await this.mediavideosService.findOne(mediaId.toString());
    } else if (postType == "pict") {
      data_media = await this.mediapictsService.findOne(mediaId.toString());
    } else if (postType == "diary") {
      data_media = await this.mediadiariesService.findOne(mediaId.toString());
    } else if (postType == "story") {
      data_media = await this.mediastoriesService.findOne(mediaId.toString());
    }

    if (!(await this.utilsService.ceckData(data_media))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_media not found',
      );
    }

    var data_userbasic = await this.userService.findbyid(userPostId.toString());
    var data_post = await this.findid(data_media.postID);

    if (!(await this.utilsService.ceckData(data_userbasic))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_userbasic not found',
      );
    }

    if (!(await this.utilsService.ceckData(data_post))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_post not found',
      );
    }

    data_userbasic_all.forEach(async element => {
      var post_array_interest = data_post.category;
      var user_array_interest = element.userInterests;

      var post_array_interest_toString = null;
      var post_array_interest_string = null;
      var user_array_interest_toString = null;
      var user_array_interest_string = null;

      var compare_interest = null;
      var Count_compare_interest = 0;

      if (post_array_interest.length > 0) {
        post_array_interest_toString = post_array_interest.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_string = JSON.parse("[" + post_array_interest_toString + "]");
      }
      if (user_array_interest.length > 0) {
        user_array_interest_toString = user_array_interest.map(function (item) {
          if ((JSON.parse(JSON.stringify(item)) != null)) {
            return '"' + JSON.parse(JSON.stringify(item)).$id + '"'
          }
        }).join(",");
        user_array_interest_string = JSON.parse("[" + user_array_interest_toString + "]");
      }
      if (post_array_interest_string != null && user_array_interest_string != null) {
        compare_interest = post_array_interest_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      //Compare Get Interes
      if (compare_interest != null) {
        Count_compare_interest = compare_interest.length;
      }

      var type = null;
      var ceckFriendFollowingFollower = await this.contentEventService.ceckFriendFollowingFollower(data_userbasic.email.toString(), element.email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower)) {
        if (ceckFriendFollowingFollower.length == 2) {
          type = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower[0].email == data_userbasic.email.toString()) {
            type = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower[0].email == element.email.toString()) {
              type = "FOLLOWING";
            } else {
              type = "PUBLIC";
            }
          }
        }
      } else {
        type = "PUBLIC";
      }

      var interest_db = [];
      if (Count_compare_interest > 0) {
        for (var i = 0; i < Count_compare_interest; i++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest[i]), "$db": "hyppe_infra_db" }
          interest_db.push(objintr)
        }
      }
      var isHidden_ = false;
      if (data_post.visibility != undefined) {
        if (data_post.visibility == "FRIEND") {
          if (type == data_post.visibility) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else if (data_post.visibility == "PRIVATE") {
          type = "PRIVATE";
          if (element._id.toString() == data_userbasic._id.toString()) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else {
          isHidden_ = false;
        }
      }

      var CreateUserplaylistDto_ = new CreateUserplaylistDto();
      CreateUserplaylistDto_.userId = Object(element._id);
      CreateUserplaylistDto_.interestId = interest_db;
      CreateUserplaylistDto_.interestIdCount = Count_compare_interest;
      CreateUserplaylistDto_.userPostId = Object(data_userbasic._id);
      CreateUserplaylistDto_.postType = postType;
      CreateUserplaylistDto_.mediaId = mediaId.toString();
      CreateUserplaylistDto_.type = type;
      CreateUserplaylistDto_.createAt = data_post.createdAt;
      CreateUserplaylistDto_.updatedAt = data_post.updatedAt;
      CreateUserplaylistDto_.isWatched = false;
      CreateUserplaylistDto_.isHidden = isHidden_;
      CreateUserplaylistDto_.postID = (data_post.postID != undefined) ? data_post.postID : "";
      CreateUserplaylistDto_.expiration = (data_post.expiration != undefined) ? Number(data_post.expiration) : 0;
      CreateUserplaylistDto_.description = (data_post.description != undefined) ? data_post.description : "";
      CreateUserplaylistDto_.userBasicData = Object(data_userbasic);
      CreateUserplaylistDto_.postData = Object(data_post);
      CreateUserplaylistDto_.mediaData = Object(data_media);
      CreateUserplaylistDto_.mediaData = Object(data_media); CreateUserplaylistDto_.FRIEND = (type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.FOLLOWER = (type == "FOLLOWER" || type == "FRIEND") ? true : false;;
      CreateUserplaylistDto_.FOLLOWING = (type == "FOLLOWING" || type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.PUBLIC = (type == "PUBLIC" || type == "FRIEND" || type == "FOLLOWER" || type == "FOLLOWING") ? true : false;
      CreateUserplaylistDto_.PRIVATE = (type == "PRIVATE") ? true : false;
      if (data_media.viewers != undefined) {
        CreateUserplaylistDto_.viewers = data_media.viewers;
      }
      if (await this.utilsService.ceckData(data_media)) {
        if (data_media.apsara != undefined) {
          CreateUserplaylistDto_.isApsara = data_media.apsara;
          if (!data_media.apsara) {
            if (data_media.mediaType != undefined) {
              if (data_media.mediaType == "video") {
                if (data_media.mediaThumb != undefined) {
                  CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
                }
                if (data_media.postID != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              } else if (data_media.mediaType == "image") {
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              }
            }
          }
        } else {
          CreateUserplaylistDto_.isApsara = false;
          if (data_media.mediaType != undefined) {
            if (data_media.mediaType == "video") {
              if (data_media.mediaThumb != undefined) {
                CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
              }
              if (data_media.postID != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            } else if (data_media.mediaType == "image") {
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            }
          }
        }
      }

      // const userId = element._id.toString();
      // const userIdPost = data_userbasic._id.toString();
      // const mediaId_ = mediaId.toString();
      // var ceckDataUser_ = await this.userplaylistModel.findOne({ userId: new Types.ObjectId(userId), userPostId: new Types.ObjectId(userIdPost), mediaId: mediaId_ }).clone().exec();

      //var ceckDataUser_ = await this.userplaylistService.findData(element._id.toString(), data_userbasic._id.toString(), mediaId.toString());

      // if (await this.utilsService.ceckData(ceckDataUser_)) {
      //   await this.userplaylistService.updateOne(ceckDataUser_[0]._id, CreateUserplaylistDto_);
      // } else {
      //   CreateUserplaylistDto_._id = new mongoose.Types.ObjectId();
      //   await this.userplaylistService.create(CreateUserplaylistDto_);
      // }
      CreateUserplaylistDto_._id = new mongoose.Types.ObjectId();
      await this.userplaylistService.create(CreateUserplaylistDto_);
      console.log("----------------------------------------" + new Date().toString() + "----------------------------------------");
    });
    console.log("----------------------------------------" + new Date().toString() + "----------------------------------------");
  }

  async updateGenerateUserPlaylist(oldUserPostID: mongoose.Types.ObjectId, CreateUserplaylistDto_: CreateUserplaylistDto) {
    if (CreateUserplaylistDto_.userPostId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param userPostId is required',
      );
    }
    if (CreateUserplaylistDto_.mediaId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param mediaId is required',
      );
    }
    if (CreateUserplaylistDto_.postType == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param postType is required',
      );
    }

    var userPostId = CreateUserplaylistDto_.userPostId;
    var mediaId = CreateUserplaylistDto_.mediaId;
    var postType = CreateUserplaylistDto_.postType;

    var current_date = await this.utilsService.getDateTimeString();
    var data_userbasic_all = await this.userService.findAll();
    var data_media = null;

    if (postType == "vid") {
      data_media = await this.mediavideosService.findOne(mediaId.toString());
    } else if (postType == "pict") {
      data_media = await this.mediapictsService.findOne(mediaId.toString());
    } else if (postType == "diary") {
      data_media = await this.mediadiariesService.findOne(mediaId.toString());
    } else if (postType == "story") {
      data_media = await this.mediastoriesService.findOne(mediaId.toString());
    }

    if (!(await this.utilsService.ceckData(data_media))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_media not found',
      );
    }

    var data_userbasic = await this.userService.findbyid(userPostId.toString());
    var data_post = await this.findid(data_media.postID);

    if (!(await this.utilsService.ceckData(data_userbasic))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_userbasic not found',
      );
    }

    if (!(await this.utilsService.ceckData(data_post))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_post not found',
      );
    }

    data_userbasic_all.forEach(async element => {
      var post_array_interest = data_post.category;
      var user_array_interest = element.userInterests;

      var post_array_interest_toString = null;
      var post_array_interest_string = null;
      var user_array_interest_toString = null;
      var user_array_interest_string = null;

      var compare_interest = null;
      var Count_compare_interest = 0;

      if (post_array_interest.length > 0) {
        post_array_interest_toString = post_array_interest.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_string = JSON.parse("[" + post_array_interest_toString + "]");
      }
      if (user_array_interest.length > 0) {
        user_array_interest_toString = user_array_interest.map(function (item) {
          if ((JSON.parse(JSON.stringify(item)) != null)) {
            return '"' + JSON.parse(JSON.stringify(item)).$id + '"'
          }
        }).join(",");
        user_array_interest_string = JSON.parse("[" + user_array_interest_toString + "]");
      }
      if (post_array_interest_string != null && user_array_interest_string != null) {
        compare_interest = post_array_interest_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      //Compare Get Interes
      if (compare_interest != null) {
        Count_compare_interest = compare_interest.length;
      }

      var type = null;
      var ceckFriendFollowingFollower = await this.contentEventService.ceckFriendFollowingFollower(data_userbasic.email.toString(), element.email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower)) {
        if (ceckFriendFollowingFollower.length == 2) {
          type = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower[0].email == data_userbasic.email.toString()) {
            type = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower[0].email == element.email.toString()) {
              type = "FOLLOWING";
            } else {
              type = "PUBLIC";
            }
          }
        }
      } else {
        type = "PUBLIC";
      }

      var interest_db = [];
      if (Count_compare_interest > 0) {
        for (var i = 0; i < Count_compare_interest; i++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest[i]), "$db": "hyppe_infra_db" }
          interest_db.push(objintr)
        }
      }
      var isHidden_ = false;
      if (data_post.visibility != undefined) {
        if (data_post.visibility == "FRIEND") {
          if (type == data_post.visibility) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else if (data_post.visibility == "PRIVATE") {
          type = "PRIVATE";
          if (element._id.toString() == data_userbasic._id.toString()) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else {
          isHidden_ = false;
        }
      }

      var CreateUserplaylistDto_ = new CreateUserplaylistDto();
      CreateUserplaylistDto_.userId = Object(element._id);
      CreateUserplaylistDto_.interestId = interest_db;
      CreateUserplaylistDto_.interestIdCount = Count_compare_interest;
      CreateUserplaylistDto_.userPostId = Object(data_userbasic._id);
      CreateUserplaylistDto_.postType = postType;
      CreateUserplaylistDto_.mediaId = mediaId.toString();
      CreateUserplaylistDto_.type = type;
      CreateUserplaylistDto_.createAt = data_post.createdAt;
      CreateUserplaylistDto_.updatedAt = data_post.updatedAt;
      CreateUserplaylistDto_.isWatched = false;
      CreateUserplaylistDto_.isHidden = isHidden_;
      CreateUserplaylistDto_.postID = (data_post.postID != undefined) ? data_post.postID : "";
      CreateUserplaylistDto_.expiration = (data_post.expiration != undefined) ? Number(data_post.expiration) : 0;
      CreateUserplaylistDto_.description = (data_post.description != undefined) ? data_post.description : "";
      CreateUserplaylistDto_.userBasicData = Object(data_userbasic);
      CreateUserplaylistDto_.postData = Object(data_post);
      CreateUserplaylistDto_.mediaData = Object(data_media);
      CreateUserplaylistDto_.mediaData = Object(data_media); CreateUserplaylistDto_.FRIEND = (type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.FOLLOWER = (type == "FOLLOWER" || type == "FRIEND") ? true : false;;
      CreateUserplaylistDto_.FOLLOWING = (type == "FOLLOWING" || type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.PUBLIC = (type == "PUBLIC" || type == "FRIEND" || type == "FOLLOWER" || type == "FOLLOWING") ? true : false;
      CreateUserplaylistDto_.PRIVATE = (type == "PRIVATE") ? true : false;
      if (data_media.viewers != undefined) {
        CreateUserplaylistDto_.viewers = data_media.viewers;
      }
      if (await this.utilsService.ceckData(data_media)) {
        if (data_media.apsara != undefined) {
          CreateUserplaylistDto_.isApsara = data_media.apsara;
          if (!data_media.apsara) {
            if (data_media.mediaType != undefined) {
              if (data_media.mediaType == "video") {
                if (data_media.mediaThumb != undefined) {
                  CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
                }
                if (data_media.postID != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              } else if (data_media.mediaType == "image") {
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              }
            }
          }
        } else {
          CreateUserplaylistDto_.isApsara = false;
          if (data_media.mediaType != undefined) {
            if (data_media.mediaType == "video") {
              if (data_media.mediaThumb != undefined) {
                CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
              }
              if (data_media.postID != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            } else if (data_media.mediaType == "image") {
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            }
          }
        }
      }

      var CreateUserplaylistDto_old = new CreateUserplaylistDto();
      CreateUserplaylistDto_old.userPostId = oldUserPostID;
      CreateUserplaylistDto_old.mediaId = mediaId.toString();
      CreateUserplaylistDto_old.userId = Object(element._id);
      // var ceckDataUser_ = await this.userplaylistService.findData(element._id.toString(), oldUserPostID.toString(), mediaId.toString());
      // if (await this.utilsService.ceckData(ceckDataUser_)) {
      //   await this.userplaylistService.updateOne(ceckDataUser_[0]._id, CreateUserplaylistDto_);
      // } 
      await this.userplaylistService.findOneAndUpdate(CreateUserplaylistDto_old, CreateUserplaylistDto_);
      //await this.userplaylistService.updateOne(ceckDataUser_[0]._id, CreateUserplaylistDto_);
    });
  }

  async updateGenerateUserPlaylist_(CreateUserplaylistDto_: CreateUserplaylistDto) {
    if (CreateUserplaylistDto_.userPostId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param userPostId is required',
      );
    }
    if (CreateUserplaylistDto_.mediaId == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param mediaId is required',
      );
    }
    if (CreateUserplaylistDto_.postType == undefined) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, param postType is required',
      );
    }

    var userPostId = CreateUserplaylistDto_.userPostId;
    var mediaId = CreateUserplaylistDto_.mediaId;
    var postType = CreateUserplaylistDto_.postType;

    var current_date = await this.utilsService.getDateTimeString();
    var data_userbasic_all = await this.userService.findAll();
    var data_media = null;

    if (postType == "vid") {
      data_media = await this.mediavideosService.findOne(mediaId.toString());
    } else if (postType == "pict") {
      data_media = await this.mediapictsService.findOne(mediaId.toString());
    } else if (postType == "diary") {
      data_media = await this.mediadiariesService.findOne(mediaId.toString());
    } else if (postType == "story") {
      data_media = await this.mediastoriesService.findOne(mediaId.toString());
    }

    if (!(await this.utilsService.ceckData(data_media))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_media not found',
      );
    }

    var data_userbasic = await this.userService.findbyid(userPostId.toString());
    var data_post = await this.findid(data_media.postID);

    if (!(await this.utilsService.ceckData(data_userbasic))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_userbasic not found',
      );
    }

    if (!(await this.utilsService.ceckData(data_post))) {
      await this.errorHandler.generateNotAcceptableException(
        'Unabled to proceed, data_post not found',
      );
    }

    data_userbasic_all.forEach(async element => {
      var post_array_interest = data_post.category;
      var user_array_interest = element.userInterests;

      var post_array_interest_toString = null;
      var post_array_interest_string = null;
      var user_array_interest_toString = null;
      var user_array_interest_string = null;

      var compare_interest = null;
      var Count_compare_interest = 0;

      if (post_array_interest.length > 0) {
        post_array_interest_toString = post_array_interest.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_string = JSON.parse("[" + post_array_interest_toString + "]");
      }
      if (user_array_interest.length > 0) {
        user_array_interest_toString = user_array_interest.map(function (item) {
          if ((JSON.parse(JSON.stringify(item)) != null)) {
            return '"' + JSON.parse(JSON.stringify(item)).$id + '"'
          }
        }).join(",");
        user_array_interest_string = JSON.parse("[" + user_array_interest_toString + "]");
      }
      if (post_array_interest_string != null && user_array_interest_string != null) {
        compare_interest = post_array_interest_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      //Compare Get Interes
      if (compare_interest != null) {
        Count_compare_interest = compare_interest.length;
      }

      var type = null;
      var ceckFriendFollowingFollower = await this.contentEventService.ceckFriendFollowingFollower(data_userbasic.email.toString(), element.email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower)) {
        if (ceckFriendFollowingFollower.length == 2) {
          type = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower[0].email == data_userbasic.email.toString()) {
            type = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower[0].email == element.email.toString()) {
              type = "FOLLOWING";
            } else {
              type = "PUBLIC";
            }
          }
        }
      } else {
        type = "PUBLIC";
      }

      var interest_db = [];
      if (Count_compare_interest > 0) {
        for (var i = 0; i < Count_compare_interest; i++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest[i]), "$db": "hyppe_infra_db" }
          interest_db.push(objintr)
        }
      }
      var isHidden_ = false;
      if (data_post.visibility != undefined) {
        if (data_post.visibility == "FRIEND") {
          if (type == data_post.visibility) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else if (data_post.visibility == "PRIVATE") {
          type = "PRIVATE";
          if (element._id.toString() == data_userbasic._id.toString()) {
            isHidden_ = false;
          } else {
            isHidden_ = true;
          }
        } else {
          isHidden_ = false;
        }
      }

      var CreateUserplaylistDto_ = new CreateUserplaylistDto();
      CreateUserplaylistDto_.userId = Object(element._id);
      CreateUserplaylistDto_.interestId = interest_db;
      CreateUserplaylistDto_.interestIdCount = Count_compare_interest;
      CreateUserplaylistDto_.userPostId = Object(data_userbasic._id);
      CreateUserplaylistDto_.postType = postType;
      CreateUserplaylistDto_.mediaId = mediaId.toString();
      CreateUserplaylistDto_.type = type;
      CreateUserplaylistDto_.createAt = data_post.createdAt;
      CreateUserplaylistDto_.updatedAt = data_post.updatedAt;
      CreateUserplaylistDto_.isWatched = false;
      CreateUserplaylistDto_.isHidden = isHidden_;
      CreateUserplaylistDto_.postID = (data_post.postID != undefined) ? data_post.postID : "";
      CreateUserplaylistDto_.expiration = (data_post.expiration != undefined) ? Number(data_post.expiration) : 0;
      CreateUserplaylistDto_.description = (data_post.description != undefined) ? data_post.description : "";
      CreateUserplaylistDto_.userBasicData = Object(data_userbasic);
      CreateUserplaylistDto_.postData = Object(data_post);
      CreateUserplaylistDto_.mediaData = Object(data_media); CreateUserplaylistDto_.FRIEND = (type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.FOLLOWER = (type == "FOLLOWER" || type == "FRIEND") ? true : false;;
      CreateUserplaylistDto_.FOLLOWING = (type == "FOLLOWING" || type == "FRIEND") ? true : false;
      CreateUserplaylistDto_.PUBLIC = (type == "PUBLIC" || type == "FRIEND" || type == "FOLLOWER" || type == "FOLLOWING") ? true : false;
      CreateUserplaylistDto_.PRIVATE = (type == "PRIVATE") ? true : false;
      if (data_media.viewers != undefined) {
        CreateUserplaylistDto_.viewers = data_media.viewers;
      }
      if (await this.utilsService.ceckData(data_media)) {
        if (data_media.apsara != undefined) {
          CreateUserplaylistDto_.isApsara = data_media.apsara;
          if (!data_media.apsara) {
            if (data_media.mediaType != undefined) {
              if (data_media.mediaType == "video") {
                if (data_media.mediaThumb != undefined) {
                  CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
                }
                if (data_media.postID != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              } else if (data_media.mediaType == "image") {
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
                }
                if (data_media.mediaUri != undefined) {
                  CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
                }
                CreateUserplaylistDto_.mediaType = data_media.mediaType;
              }
            }
          }
        } else {
          CreateUserplaylistDto_.isApsara = false;
          if (data_media.mediaType != undefined) {
            if (data_media.mediaType == "video") {
              if (data_media.mediaThumb != undefined) {
                CreateUserplaylistDto_.mediaThumbUri = data_media.mediaThumb;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/stream/" + data_media.mediaUri;
              }
              if (data_media.postID != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            } else if (data_media.mediaType == "image") {
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaEndpoint = "/pict" + data_media.mediaUri;
              }
              if (data_media.mediaUri != undefined) {
                CreateUserplaylistDto_.mediaThumbEndpoint = "/thumb/" + data_media.postID;
              }
              CreateUserplaylistDto_.mediaType = data_media.mediaType;
            }
          }
        }
      }

      var CreateUserplaylistDto_old = new CreateUserplaylistDto();
      CreateUserplaylistDto_old.userPostId = Object(data_userbasic._id);
      CreateUserplaylistDto_old.mediaId = mediaId.toString();
      CreateUserplaylistDto_old.userId = Object(element._id);
      // var ceckDataUser_ = await this.userplaylistService.findData(element._id.toString(), oldUserPostID.toString(), mediaId.toString());
      // if (await this.utilsService.ceckData(ceckDataUser_)) {
      //   await this.userplaylistService.updateOne(ceckDataUser_[0]._id, CreateUserplaylistDto_);
      // } 
      console.log(CreateUserplaylistDto_old);
      console.log(CreateUserplaylistDto_);
      await this.userplaylistService.findOneAndUpdate(CreateUserplaylistDto_old, CreateUserplaylistDto_);
      //await this.userplaylistService.updateOne(ceckDataUser_[0]._id, CreateUserplaylistDto_);
    });
  }

  async generateNewUserPlaylist(userId: string) {
    const limit = 20;
    const sort = -1;
    const data_user = await this.userService.findbyid(userId);
    const getPost_vid = await this.PostsModel.find({ postType: "vid" }).sort({ createdAt: sort }).limit(limit).exec();
    const getPost_pict = await this.PostsModel.find({ postType: "pict" }).sort({ createdAt: sort }).limit(limit).exec();
    const getPost_diary = await this.PostsModel.find({ postType: "diary" }).sort({ createdAt: sort }).limit(limit).exec();
    const getPost_story = await this.PostsModel.find({ postType: "story" }).sort({ createdAt: sort }).limit(limit).exec();

    var user_array_interest_string = null;
    var user_array_interest_toString = null;

    var user_array_interest = null;
    if (data_user.userInterests != undefined) {
      user_array_interest = data_user.userInterests;
    }

    if (user_array_interest.length > 0) {
      user_array_interest_toString = user_array_interest.map(function (item) {
        if ((JSON.parse(JSON.stringify(item)) != null)) {
          return '"' + JSON.parse(JSON.stringify(item)).$id + '"'
        }
      }).join(",");
      user_array_interest_string = JSON.parse("[" + user_array_interest_toString + "]");
    }

    for (var loopData = 0; loopData < limit; loopData++) {
      var email_post_vid = null;
      var email_post_pict = null;
      var email_post_diary = null;
      var email_post_story = null;

      var userbasic_post_vid = null;
      var userbasic_post_pict = null;
      var userbasic_post_diary = null;
      var userbasic_post_story = null;

      var id_user_post_vid = null;
      var id_user_post_pict = null;
      var id_user_post_diary = null;
      var id_user_post_story = null;

      var post_array_interest_vid_string = null;
      var post_array_interest_pict_string = null;
      var post_array_interest_diary_string = null;
      var post_array_interest_story_string = null;

      var post_array_interest_vid_toString = null;
      var post_array_interest_pict_toString = null;
      var post_array_interest_diary_toString = null;
      var post_array_interest_story_toString = null;

      var post_array_interest_vid = getPost_vid[loopData].category;
      var post_array_interest_pict = getPost_pict[loopData].category;
      var post_array_interest_diary = getPost_diary[loopData].category;
      var post_array_interest_story = getPost_story[loopData].category;

      email_post_vid = getPost_vid[loopData].email;
      email_post_pict = getPost_vid[loopData].email;
      email_post_diary = getPost_vid[loopData].email;
      email_post_story = getPost_vid[loopData].email;

      userbasic_post_vid = await this.userService.findOne(email_post_vid);
      userbasic_post_pict = await this.userService.findOne(email_post_vid);
      userbasic_post_diary = await this.userService.findOne(email_post_vid);
      userbasic_post_story = await this.userService.findOne(email_post_vid);

      id_user_post_vid = userbasic_post_vid._id.toString();
      id_user_post_pict = userbasic_post_pict._id.toString();
      id_user_post_diary = userbasic_post_diary._id.toString();
      id_user_post_story = userbasic_post_story._id.toString();

      var compare_interest_vid = null;
      var compare_interest_pict = null;
      var compare_interest_diary = null;
      var compare_interest_story = null;

      var Count_compare_interest_vid = 0;
      var Count_compare_interest_pict = 0;
      var Count_compare_interest_diary = 0;
      var Count_compare_interest_story = 0;

      if (post_array_interest_vid.length > 0) {
        post_array_interest_vid_toString = post_array_interest_vid.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_vid_string = JSON.parse("[" + post_array_interest_vid_toString + "]");
      }

      if (post_array_interest_vid_string != null && user_array_interest_string != null) {
        compare_interest_vid = post_array_interest_vid_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      if (post_array_interest_pict.length > 0) {
        post_array_interest_pict_toString = post_array_interest_pict.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_pict_string = JSON.parse("[" + post_array_interest_pict_toString + "]");
      }

      if (post_array_interest_pict_string != null && user_array_interest_string != null) {
        compare_interest_pict = post_array_interest_pict_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      if (post_array_interest_diary.length > 0) {
        post_array_interest_diary_toString = post_array_interest_diary.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_diary_string = JSON.parse("[" + post_array_interest_diary_toString + "]");
      }

      if (post_array_interest_diary_string != null && user_array_interest_string != null) {
        compare_interest_diary = post_array_interest_diary_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      if (post_array_interest_story.length > 0) {
        post_array_interest_story_toString = post_array_interest_story.map(function (item) { return '"' + JSON.parse(JSON.stringify(item)).$id + '"' }).join(",");
        post_array_interest_story_string = JSON.parse("[" + post_array_interest_story_toString + "]");
      }

      if (post_array_interest_story_string != null && user_array_interest_string != null) {
        compare_interest_story = post_array_interest_story_string.filter(function (obj) {
          return user_array_interest_string.indexOf(obj) !== -1;
        });
      }

      //Compare Get Interes
      if (compare_interest_vid != null) {
        Count_compare_interest_vid = compare_interest_vid.length;
      }
      if (compare_interest_pict != null) {
        Count_compare_interest_pict = compare_interest_pict.length;
      }
      if (compare_interest_diary != null) {
        Count_compare_interest_diary = compare_interest_diary.length;
      }
      if (compare_interest_story != null) {
        Count_compare_interest_story = compare_interest_story.length;
      }

      var interest_db_vid = [];
      if (Count_compare_interest_vid > 0) {
        for (var j = 0; j < Count_compare_interest_vid; j++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest_vid[j]), "$db": "hyppe_infra_db" }
          interest_db_vid.push(objintr)
        }
      }

      var interest_db_pict = [];
      if (Count_compare_interest_pict > 0) {
        for (var k = 0; k < Count_compare_interest_pict; k++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest_pict[k]), "$db": "hyppe_infra_db" }
          interest_db_pict.push(objintr)
        }
      }

      var interest_db_diary = [];
      if (Count_compare_interest_diary > 0) {
        for (var l = 0; l < Count_compare_interest_diary; l++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest_diary[l]), "$db": "hyppe_infra_db" }
          interest_db_diary.push(objintr)
        }
      }

      var interest_db_story = [];
      if (Count_compare_interest_story > 0) {
        for (var m = 0; m < Count_compare_interest_story; m++) {
          var objintr = { "$ref": "interests_repo", "$id": new mongoose.Types.ObjectId(compare_interest_story[m]), "$db": "hyppe_infra_db" }
          interest_db_story.push(objintr)
        }
      }

      //-------------------------------------------INSERT VID
      console.log("-------------------------------------------INSERT VID");

      var type_vid = null;
      var ceckFriendFollowingFollower_vid = await this.contentEventService.ceckFriendFollowingFollower(data_user.email.toString(), getPost_vid[loopData].email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower_vid)) {
        if (ceckFriendFollowingFollower_vid.length == 2) {
          type_vid = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower_vid[0].email == data_user.email.toString()) {
            type_vid = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower_vid[0].email == getPost_vid[loopData].email.toString()) {
              type_vid = "FOLLOWING";
            } else {
              type_vid = "PUBLIC";
            }
          }
        }
      } else {
        type_vid = "PUBLIC";
      }

      var isHidden_vid = false;
      if (getPost_vid[loopData].visibility != undefined) {
        if (getPost_vid[loopData].visibility == "FRIEND") {
          if (type_vid == getPost_vid[loopData].visibility) {
            isHidden_vid = false;
          } else {
            isHidden_vid = true;
          }
        } else if (getPost_vid[loopData].visibility == "PRIVATE") {
          type_vid = "PRIVATE";
          if (getPost_vid[loopData].email.toString() == data_user.email.toString()) {
            isHidden_vid = false;
          } else {
            isHidden_vid = true;
          }
        } else {
          isHidden_vid = false;
        }
      }

      var data_media_vid = await this.mediavideosService.findOnepostID(getPost_vid[loopData].postID.toString());
      if (await this.utilsService.ceckData(data_media_vid)) {
        //Insert Playlist Type Vid
        var CreateUserplaylistDto_vid = new CreateUserplaylistDto();
        CreateUserplaylistDto_vid.userId = Object(data_user._id);
        CreateUserplaylistDto_vid.interestId = interest_db_vid;
        CreateUserplaylistDto_vid.interestIdCount = Count_compare_interest_vid;
        CreateUserplaylistDto_vid.userPostId = Object(id_user_post_vid);
        CreateUserplaylistDto_vid.postType = getPost_vid[loopData].postType;
        CreateUserplaylistDto_vid.mediaId = data_media_vid.mediaID;
        CreateUserplaylistDto_vid.type = type_vid;
        CreateUserplaylistDto_vid.createAt = getPost_vid[loopData].createdAt;
        CreateUserplaylistDto_vid.updatedAt = getPost_vid[loopData].updatedAt;
        CreateUserplaylistDto_vid.isWatched = false;
        CreateUserplaylistDto_vid.isHidden = isHidden_vid;
        CreateUserplaylistDto_vid.postID = (getPost_vid[loopData].postID != undefined) ? getPost_vid[loopData].postID : "";
        CreateUserplaylistDto_vid.expiration = (getPost_vid[loopData].expiration != undefined) ? Number(getPost_vid[loopData].expiration) : 0;
        CreateUserplaylistDto_vid.description = (getPost_vid[loopData].description != undefined) ? getPost_vid[loopData].description : "";
        CreateUserplaylistDto_vid.userBasicData = Object(userbasic_post_vid);
        CreateUserplaylistDto_vid.postData = Object(getPost_vid[loopData]);
        CreateUserplaylistDto_vid.mediaData = Object(data_media_vid);
        CreateUserplaylistDto_vid.mediaData = Object(data_media_vid);
        CreateUserplaylistDto_vid.FRIEND = (type_vid == "FRIEND") ? true : false;
        CreateUserplaylistDto_vid.FOLLOWER = (type_vid == "FOLLOWER" || type_vid == "FRIEND") ? true : false;;
        CreateUserplaylistDto_vid.FOLLOWING = (type_vid == "FOLLOWING" || type_vid == "FRIEND") ? true : false;
        CreateUserplaylistDto_vid.PUBLIC = (type_vid == "PUBLIC" || type_vid == "FRIEND" || type_vid == "FOLLOWER" || type_vid == "FOLLOWING") ? true : false;
        CreateUserplaylistDto_vid.PRIVATE = (type_vid == "PRIVATE") ? true : false;
        if (data_media_vid.viewers != undefined) {
          CreateUserplaylistDto_vid.viewers = data_media_vid.viewers;
        }
        if (await this.utilsService.ceckData(data_media_vid)) {
          if (data_media_vid.apsara != undefined) {
            CreateUserplaylistDto_vid.isApsara = data_media_vid.apsara;
            if (!data_media_vid.apsara) {
              if (data_media_vid.mediaType != undefined) {
                if (data_media_vid.mediaType == "video") {
                  if (data_media_vid.mediaThumb != undefined) {
                    CreateUserplaylistDto_vid.mediaThumbUri = data_media_vid.mediaThumb;
                  }
                  if (data_media_vid.mediaUri != undefined) {
                    CreateUserplaylistDto_vid.mediaEndpoint = "/stream/" + data_media_vid.mediaUri;
                  }
                  if (data_media_vid.postID != undefined) {
                    CreateUserplaylistDto_vid.mediaThumbEndpoint = "/thumb/" + data_media_vid.postID;
                  }
                  CreateUserplaylistDto_vid.mediaType = data_media_vid.mediaType;
                } else if (data_media_vid.mediaType == "image") {
                  if (data_media_vid.mediaUri != undefined) {
                    CreateUserplaylistDto_vid.mediaEndpoint = "/pict" + data_media_vid.mediaUri;
                  }
                  if (data_media_vid.mediaUri != undefined) {
                    CreateUserplaylistDto_vid.mediaThumbEndpoint = "/thumb/" + data_media_vid.postID;
                  }
                  CreateUserplaylistDto_vid.mediaType = data_media_vid.mediaType;
                }
              }
            }
          } else {
            CreateUserplaylistDto_vid.isApsara = false;
            if (data_media_vid.mediaType != undefined) {
              if (data_media_vid.mediaType == "video") {
                if (data_media_vid.mediaThumb != undefined) {
                  CreateUserplaylistDto_vid.mediaThumbUri = data_media_vid.mediaThumb;
                }
                if (data_media_vid.mediaUri != undefined) {
                  CreateUserplaylistDto_vid.mediaEndpoint = "/stream/" + data_media_vid.mediaUri;
                }
                if (data_media_vid.postID != undefined) {
                  CreateUserplaylistDto_vid.mediaThumbEndpoint = "/thumb/" + data_media_vid.postID;
                }
                CreateUserplaylistDto_vid.mediaType = data_media_vid.mediaType;
              } else if (data_media_vid.mediaType == "image") {
                if (data_media_vid.mediaUri != undefined) {
                  CreateUserplaylistDto_vid.mediaEndpoint = "/pict" + data_media_vid.mediaUri;
                }
                if (data_media_vid.mediaUri != undefined) {
                  CreateUserplaylistDto_vid.mediaThumbEndpoint = "/thumb/" + data_media_vid.postID;
                }
                CreateUserplaylistDto_vid.mediaType = data_media_vid.mediaType;
              }
            }
          }
        }
        CreateUserplaylistDto_vid._id = new mongoose.Types.ObjectId();
        await this.userplaylistService.create(CreateUserplaylistDto_vid);
      }

      //-------------------------------------------INSERT PICT
      console.log("-------------------------------------------INSERT PICT");

      var type_pict = null;
      var ceckFriendFollowingFollower_pict = await this.contentEventService.ceckFriendFollowingFollower(data_user.email.toString(), getPost_pict[loopData].email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower_pict)) {
        if (ceckFriendFollowingFollower_pict.length == 2) {
          type_pict = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower_pict[0].email == data_user.email.toString()) {
            type_pict = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower_pict[0].email == getPost_pict[loopData].email.toString()) {
              type_pict = "FOLLOWING";
            } else {
              type_pict = "PUBLIC";
            }
          }
        }
      } else {
        type_pict = "PUBLIC";
      }

      var isHidden_pict = false;
      if (getPost_pict[loopData].visibility != undefined) {
        if (getPost_pict[loopData].visibility == "FRIEND") {
          if (type_pict == getPost_pict[loopData].visibility) {
            isHidden_pict = false;
          } else {
            isHidden_pict = true;
          }
        } else if (getPost_pict[loopData].visibility == "PRIVATE") {
          type_pict = "PRIVATE";
          if (getPost_pict[loopData].email.toString() == data_user.email.toString()) {
            isHidden_pict = false;
          } else {
            isHidden_pict = true;
          }
        } else {
          isHidden_pict = false;
        }
      }

      var data_media_pict = await this.mediapictsService.findOnepostID(getPost_pict[loopData].postID.toString());
      if (await this.utilsService.ceckData(data_media_pict)) {
        //Insert Playlist Type Vid
        var CreateUserplaylistDto_pict = new CreateUserplaylistDto();
        CreateUserplaylistDto_pict.userId = Object(data_user._id);
        CreateUserplaylistDto_pict.interestId = interest_db_pict;
        CreateUserplaylistDto_pict.interestIdCount = Count_compare_interest_pict;
        CreateUserplaylistDto_pict.userPostId = Object(id_user_post_pict);
        CreateUserplaylistDto_pict.postType = getPost_pict[loopData].postType;
        CreateUserplaylistDto_pict.mediaId = data_media_pict.mediaID;
        CreateUserplaylistDto_pict.type = type_pict;
        CreateUserplaylistDto_pict.createAt = getPost_pict[loopData].createdAt;
        CreateUserplaylistDto_pict.updatedAt = getPost_pict[loopData].updatedAt;
        CreateUserplaylistDto_pict.isWatched = false;
        CreateUserplaylistDto_pict.isHidden = isHidden_pict;
        CreateUserplaylistDto_pict.postID = (getPost_pict[loopData].postID != undefined) ? getPost_pict[loopData].postID : "";
        CreateUserplaylistDto_pict.expiration = (getPost_pict[loopData].expiration != undefined) ? Number(getPost_pict[loopData].expiration) : 0;
        CreateUserplaylistDto_pict.description = (getPost_pict[loopData].description != undefined) ? getPost_pict[loopData].description : "";
        CreateUserplaylistDto_pict.userBasicData = Object(userbasic_post_pict);
        CreateUserplaylistDto_pict.postData = Object(getPost_pict[loopData]);
        CreateUserplaylistDto_pict.mediaData = Object(data_media_pict);
        CreateUserplaylistDto_pict.mediaData = Object(data_media_pict);
        CreateUserplaylistDto_pict.FRIEND = (type_pict == "FRIEND") ? true : false;
        CreateUserplaylistDto_pict.FOLLOWER = (type_pict == "FOLLOWER" || type_pict == "FRIEND") ? true : false;;
        CreateUserplaylistDto_pict.FOLLOWING = (type_pict == "FOLLOWING" || type_pict == "FRIEND") ? true : false;
        CreateUserplaylistDto_pict.PUBLIC = (type_pict == "PUBLIC" || type_pict == "FRIEND" || type_pict == "FOLLOWER" || type_pict == "FOLLOWING") ? true : false;
        CreateUserplaylistDto_pict.PRIVATE = (type_pict == "PRIVATE") ? true : false;
        if (data_media_pict.viewers != undefined) {
          CreateUserplaylistDto_pict.viewers = data_media_pict.viewers;
        }
        if (await this.utilsService.ceckData(data_media_pict)) {
          if (data_media_pict.apsara != undefined) {
            CreateUserplaylistDto_pict.isApsara = data_media_pict.apsara;
            if (!data_media_pict.apsara) {
              if (data_media_pict.mediaType != undefined) {
                if (data_media_pict.mediaType == "video") {
                  if (data_media_pict.mediaUri != undefined) {
                    CreateUserplaylistDto_pict.mediaEndpoint = "/stream/" + data_media_pict.mediaUri;
                  }
                  if (data_media_pict.postID != undefined) {
                    CreateUserplaylistDto_pict.mediaThumbEndpoint = "/thumb/" + data_media_pict.postID;
                  }
                  CreateUserplaylistDto_pict.mediaType = data_media_pict.mediaType;
                } else if (data_media_pict.mediaType == "image") {
                  if (data_media_pict.mediaUri != undefined) {
                    CreateUserplaylistDto_pict.mediaEndpoint = "/pict" + data_media_pict.mediaUri;
                  }
                  if (data_media_pict.mediaUri != undefined) {
                    CreateUserplaylistDto_pict.mediaThumbEndpoint = "/thumb/" + data_media_pict.postID;
                  }
                  CreateUserplaylistDto_pict.mediaType = data_media_pict.mediaType;
                }
              }
            }
          } else {
            CreateUserplaylistDto_pict.isApsara = false;
            if (data_media_pict.mediaType != undefined) {
              if (data_media_pict.mediaType == "video") {
                if (data_media_pict.mediaUri != undefined) {
                  CreateUserplaylistDto_pict.mediaEndpoint = "/stream/" + data_media_pict.mediaUri;
                }
                if (data_media_pict.postID != undefined) {
                  CreateUserplaylistDto_pict.mediaThumbEndpoint = "/thumb/" + data_media_pict.postID;
                }
                CreateUserplaylistDto_pict.mediaType = data_media_pict.mediaType;
              } else if (data_media_pict.mediaType == "image") {
                if (data_media_pict.mediaUri != undefined) {
                  CreateUserplaylistDto_pict.mediaEndpoint = "/pict" + data_media_pict.mediaUri;
                }
                if (data_media_pict.mediaUri != undefined) {
                  CreateUserplaylistDto_pict.mediaThumbEndpoint = "/thumb/" + data_media_pict.postID;
                }
                CreateUserplaylistDto_pict.mediaType = data_media_pict.mediaType;
              }
            }
          }
        }
        CreateUserplaylistDto_pict._id = new mongoose.Types.ObjectId();
        await this.userplaylistService.create(CreateUserplaylistDto_pict);

      }

      //-------------------------------------------INSERT DIARY
      console.log("-------------------------------------------INSERT DIARY");

      var type_diary = null;
      var ceckFriendFollowingFollower_diary = await this.contentEventService.ceckFriendFollowingFollower(data_user.email.toString(), getPost_diary[loopData].email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower_diary)) {
        if (ceckFriendFollowingFollower_diary.length == 2) {
          type_diary = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower_diary[0].email == data_user.email.toString()) {
            type_diary = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower_diary[0].email == getPost_diary[loopData].email.toString()) {
              type_diary = "FOLLOWING";
            } else {
              type_diary = "PUBLIC";
            }
          }
        }
      } else {
        type_diary = "PUBLIC";
      }

      var isHidden_diary = false;
      if (getPost_diary[loopData].visibility != undefined) {
        if (getPost_diary[loopData].visibility == "FRIEND") {
          if (type_diary == getPost_diary[loopData].visibility) {
            isHidden_diary = false;
          } else {
            isHidden_diary = true;
          }
        } else if (getPost_diary[loopData].visibility == "PRIVATE") {
          type_diary = "PRIVATE";
          if (getPost_diary[loopData].email.toString() == data_user.email.toString()) {
            isHidden_diary = false;
          } else {
            isHidden_diary = true;
          }
        } else {
          isHidden_diary = false;
        }
      }

      var data_media_diary = await this.mediadiariesService.findOnepostID(getPost_diary[loopData].postID.toString());
      if (await this.utilsService.ceckData(data_media_diary)) {
        //Insert Playlist Type Vid
        var CreateUserplaylistDto_diary = new CreateUserplaylistDto();
        CreateUserplaylistDto_diary.userId = Object(data_user._id);
        CreateUserplaylistDto_diary.interestId = interest_db_diary;
        CreateUserplaylistDto_diary.interestIdCount = Count_compare_interest_diary;
        CreateUserplaylistDto_diary.userPostId = Object(id_user_post_diary);
        CreateUserplaylistDto_diary.postType = getPost_diary[loopData].postType;
        CreateUserplaylistDto_diary.mediaId = data_media_diary.mediaID;
        CreateUserplaylistDto_diary.type = type_diary;
        CreateUserplaylistDto_diary.createAt = getPost_diary[loopData].createdAt;
        CreateUserplaylistDto_diary.updatedAt = getPost_diary[loopData].updatedAt;
        CreateUserplaylistDto_diary.isWatched = false;
        CreateUserplaylistDto_diary.isHidden = isHidden_diary;
        CreateUserplaylistDto_diary.postID = (getPost_diary[loopData].postID != undefined) ? getPost_diary[loopData].postID : "";
        CreateUserplaylistDto_diary.expiration = (getPost_diary[loopData].expiration != undefined) ? Number(getPost_diary[loopData].expiration) : 0;
        CreateUserplaylistDto_diary.description = (getPost_diary[loopData].description != undefined) ? getPost_diary[loopData].description : "";
        CreateUserplaylistDto_diary.userBasicData = Object(userbasic_post_diary);
        CreateUserplaylistDto_diary.postData = Object(getPost_diary[loopData]);
        CreateUserplaylistDto_diary.mediaData = Object(data_media_diary);
        CreateUserplaylistDto_diary.mediaData = Object(data_media_diary);
        CreateUserplaylistDto_diary.FRIEND = (type_diary == "FRIEND") ? true : false;
        CreateUserplaylistDto_diary.FOLLOWER = (type_diary == "FOLLOWER" || type_diary == "FRIEND") ? true : false;;
        CreateUserplaylistDto_diary.FOLLOWING = (type_diary == "FOLLOWING" || type_diary == "FRIEND") ? true : false;
        CreateUserplaylistDto_diary.PUBLIC = (type_diary == "PUBLIC" || type_diary == "FRIEND" || type_diary == "FOLLOWER" || type_diary == "FOLLOWING") ? true : false;
        CreateUserplaylistDto_diary.PRIVATE = (type_diary == "PRIVATE") ? true : false;
        if (data_media_diary.viewers != undefined) {
          CreateUserplaylistDto_diary.viewers = data_media_diary.viewers;
        }
        if (await this.utilsService.ceckData(data_media_diary)) {
          if (data_media_diary.apsara != undefined) {
            CreateUserplaylistDto_diary.isApsara = data_media_diary.apsara;
            if (!data_media_diary.apsara) {
              if (data_media_diary.mediaType != undefined) {
                if (data_media_diary.mediaType == "video") {
                  if (data_media_diary.mediaThumb != undefined) {
                    CreateUserplaylistDto_diary.mediaThumbUri = data_media_diary.mediaThumb;
                  }
                  if (data_media_diary.mediaUri != undefined) {
                    CreateUserplaylistDto_diary.mediaEndpoint = "/stream/" + data_media_diary.mediaUri;
                  }
                  if (data_media_diary.postID != undefined) {
                    CreateUserplaylistDto_diary.mediaThumbEndpoint = "/thumb/" + data_media_diary.postID;
                  }
                  CreateUserplaylistDto_diary.mediaType = data_media_diary.mediaType;
                } else if (data_media_diary.mediaType == "image") {
                  if (data_media_diary.mediaUri != undefined) {
                    CreateUserplaylistDto_diary.mediaEndpoint = "/pict" + data_media_diary.mediaUri;
                  }
                  if (data_media_diary.mediaUri != undefined) {
                    CreateUserplaylistDto_diary.mediaThumbEndpoint = "/thumb/" + data_media_diary.postID;
                  }
                  CreateUserplaylistDto_diary.mediaType = data_media_diary.mediaType;
                }
              }
            }
          } else {
            CreateUserplaylistDto_diary.isApsara = false;
            if (data_media_diary.mediaType != undefined) {
              if (data_media_diary.mediaType == "video") {
                if (data_media_diary.mediaThumb != undefined) {
                  CreateUserplaylistDto_diary.mediaThumbUri = data_media_diary.mediaThumb;
                }
                if (data_media_diary.mediaUri != undefined) {
                  CreateUserplaylistDto_diary.mediaEndpoint = "/stream/" + data_media_diary.mediaUri;
                }
                if (data_media_diary.postID != undefined) {
                  CreateUserplaylistDto_diary.mediaThumbEndpoint = "/thumb/" + data_media_diary.postID;
                }
                CreateUserplaylistDto_diary.mediaType = data_media_diary.mediaType;
              } else if (data_media_diary.mediaType == "image") {
                if (data_media_diary.mediaUri != undefined) {
                  CreateUserplaylistDto_diary.mediaEndpoint = "/pict" + data_media_diary.mediaUri;
                }
                if (data_media_diary.mediaUri != undefined) {
                  CreateUserplaylistDto_diary.mediaThumbEndpoint = "/thumb/" + data_media_diary.postID;
                }
                CreateUserplaylistDto_diary.mediaType = data_media_diary.mediaType;
              }
            }
          }
        }
        CreateUserplaylistDto_diary._id = new mongoose.Types.ObjectId();
        await this.userplaylistService.create(CreateUserplaylistDto_diary);
      }

      //-------------------------------------------INSERT STORY
      console.log("-------------------------------------------INSERT STORY");

      var type_story = null;
      var ceckFriendFollowingFollower_story = await this.contentEventService.ceckFriendFollowingFollower(data_user.email.toString(), getPost_story[loopData].email.toString());
      if (await this.utilsService.ceckData(ceckFriendFollowingFollower_story)) {
        if (ceckFriendFollowingFollower_story.length == 2) {
          type_story = "FRIEND";
        } else {
          if (ceckFriendFollowingFollower_story[0].email == data_user.email.toString()) {
            type_story = "FOLLOWER";
          } else {
            if (ceckFriendFollowingFollower_story[0].email == getPost_story[loopData].email.toString()) {
              type_story = "FOLLOWING";
            } else {
              type_story = "PUBLIC";
            }
          }
        }
      } else {
        type_story = "PUBLIC";
      }

      var isHidden_story = false;
      if (getPost_story[loopData].visibility != undefined) {
        if (getPost_story[loopData].visibility == "FRIEND") {
          if (type_story == getPost_story[loopData].visibility) {
            isHidden_story = false;
          } else {
            isHidden_story = true;
          }
        } else if (getPost_story[loopData].visibility == "PRIVATE") {
          type_story = "PRIVATE";
          if (getPost_story[loopData].email.toString() == data_user.email.toString()) {
            isHidden_story = false;
          } else {
            isHidden_story = true;
          }
        } else {
          isHidden_story = false;
        }
      }

      var data_media_story = await this.mediastoriesService.findOnepostID(getPost_story[loopData].postID.toString());
      if (await this.utilsService.ceckData(data_media_story)) {
        //Insert Playlist Type Vid
        var CreateUserplaylistDto_story = new CreateUserplaylistDto();
        CreateUserplaylistDto_story.userId = Object(data_user._id);
        CreateUserplaylistDto_story.interestId = interest_db_story;
        CreateUserplaylistDto_story.interestIdCount = Count_compare_interest_story;
        CreateUserplaylistDto_story.userPostId = Object(id_user_post_story);
        CreateUserplaylistDto_story.postType = getPost_story[loopData].postType;
        CreateUserplaylistDto_story.mediaId = data_media_story.mediaID;
        CreateUserplaylistDto_story.type = type_story;
        CreateUserplaylistDto_story.createAt = getPost_story[loopData].createdAt;
        CreateUserplaylistDto_story.updatedAt = getPost_story[loopData].updatedAt;
        CreateUserplaylistDto_story.isWatched = false;
        CreateUserplaylistDto_story.isHidden = isHidden_story;
        CreateUserplaylistDto_story.postID = (getPost_story[loopData].postID != undefined) ? getPost_story[loopData].postID : "";
        CreateUserplaylistDto_story.expiration = (getPost_story[loopData].expiration != undefined) ? Number(getPost_story[loopData].expiration) : 0;
        CreateUserplaylistDto_story.description = (getPost_story[loopData].description != undefined) ? getPost_story[loopData].description : "";
        CreateUserplaylistDto_story.userBasicData = Object(userbasic_post_story);
        CreateUserplaylistDto_story.postData = Object(getPost_story[loopData]);
        CreateUserplaylistDto_story.mediaData = Object(data_media_story);
        CreateUserplaylistDto_story.mediaData = Object(data_media_story);
        CreateUserplaylistDto_story.FRIEND = (type_story == "FRIEND") ? true : false;
        CreateUserplaylistDto_story.FOLLOWER = (type_story == "FOLLOWER" || type_story == "FRIEND") ? true : false;;
        CreateUserplaylistDto_story.FOLLOWING = (type_story == "FOLLOWING" || type_story == "FRIEND") ? true : false;
        CreateUserplaylistDto_story.PUBLIC = (type_story == "PUBLIC" || type_story == "FRIEND" || type_story == "FOLLOWER" || type_story == "FOLLOWING") ? true : false;
        CreateUserplaylistDto_story.PRIVATE = (type_story == "PRIVATE") ? true : false;
        if (data_media_story.viewers != undefined) {
          CreateUserplaylistDto_story.viewers = data_media_story.viewers;
        }
        if (await this.utilsService.ceckData(data_media_story)) {
          if (data_media_story.apsara != undefined) {
            CreateUserplaylistDto_story.isApsara = data_media_story.apsara;
            if (!data_media_story.apsara) {
              if (data_media_story.mediaType != undefined) {
                if (data_media_story.mediaType == "video") {
                  if (data_media_story.mediaThumb != undefined) {
                    CreateUserplaylistDto_story.mediaThumbUri = data_media_story.mediaThumb;
                  }
                  if (data_media_story.mediaUri != undefined) {
                    CreateUserplaylistDto_story.mediaEndpoint = "/stream/" + data_media_story.mediaUri;
                  }
                  if (data_media_story.postID != undefined) {
                    CreateUserplaylistDto_story.mediaThumbEndpoint = "/thumb/" + data_media_story.postID;
                  }
                  CreateUserplaylistDto_story.mediaType = data_media_story.mediaType;
                } else if (data_media_story.mediaType == "image") {
                  if (data_media_story.mediaUri != undefined) {
                    CreateUserplaylistDto_story.mediaEndpoint = "/pict" + data_media_story.mediaUri;
                  }
                  if (data_media_story.mediaUri != undefined) {
                    CreateUserplaylistDto_story.mediaThumbEndpoint = "/thumb/" + data_media_story.postID;
                  }
                  CreateUserplaylistDto_story.mediaType = data_media_story.mediaType;
                }
              }
            }
          } else {
            CreateUserplaylistDto_story.isApsara = false;
            if (data_media_story.mediaType != undefined) {
              if (data_media_story.mediaType == "video") {
                if (data_media_story.mediaThumb != undefined) {
                  CreateUserplaylistDto_story.mediaThumbUri = data_media_story.mediaThumb;
                }
                if (data_media_story.mediaUri != undefined) {
                  CreateUserplaylistDto_story.mediaEndpoint = "/stream/" + data_media_story.mediaUri;
                }
                if (data_media_story.postID != undefined) {
                  CreateUserplaylistDto_story.mediaThumbEndpoint = "/thumb/" + data_media_story.postID;
                }
                CreateUserplaylistDto_story.mediaType = data_media_story.mediaType;
              } else if (data_media_story.mediaType == "image") {
                if (data_media_story.mediaUri != undefined) {
                  CreateUserplaylistDto_story.mediaEndpoint = "/pict" + data_media_story.mediaUri;
                }
                if (data_media_story.mediaUri != undefined) {
                  CreateUserplaylistDto_story.mediaThumbEndpoint = "/thumb/" + data_media_story.postID;
                }
                CreateUserplaylistDto_story.mediaType = data_media_story.mediaType;
              }
            }
          }
        }
        CreateUserplaylistDto_story._id = new mongoose.Types.ObjectId();
        await this.userplaylistService.create(CreateUserplaylistDto_story);
      }
    }
  }

  async findcontentfilters(keys: string, postType: string, skip: number, limit: number, email: string) {

    if (keys !== undefined) {
      const query = await this.PostsModel.aggregate([

        // {
        //   $lookup: {
        //     from: "userbasics",
        //     as: "ubasic",
        //     let: {
        //       local_id: '$reportedUser.email'
        //     },
        //     pipeline: [
        //       {
        //         $match: {
        //           $expr: {
        //             $and: [
        //               {
        //                 $in: ['$email', {
        //                   $ifNull: ['$$local_id', []]
        //                 }]
        //               },

        //             ]
        //           }
        //         }
        //       },
        //       {
        //         $project: {
        //           fullName: 1,
        //           email: 1
        //         }
        //       },

        //     ],

        //   }
        // },


        {
          $addFields: {

            salePrice: { $cmp: ["$saleAmount", 0] }

          },
        },


        {
          $project: {
            refs: { $arrayElemAt: ['$contentMedias', 0] },
            createdAt: 1,
            reportedStatus: 1,
            reportedUserCount: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            likes: 1,
            shares: 1,
            reaction: 1,
            comments: 1,
            isOwned: 1,
            views: 1,
            visibility: 1,
            allowComments: 1,
            certified: 1,
            isViewed:
            {
              $cond: { if: { $eq: ["$views", 0] }, then: false, else: true }
            },

            saleLike: {
              $cond: { if: { $eq: ["$saleLike", -1] }, then: false, else: "$saleLike" }
            },
            saleView: {
              $cond: { if: { $eq: ["$saleView", -1] }, then: false, else: "$saleView" }
            },
            saleAmount: {
              $cond: { if: { $eq: ["$salePrice", -1] }, then: 0, else: "$saleAmount" }
            },
            monetize: {
              $cond: {
                if: {
                  $or: [{
                    $eq: ["$salePrice", -1]
                  }, {
                    $eq: ["$salePrice", 0]
                  },]
                },
                then: false,
                else: true
              },

            },


          }
        },
        {
          $project: {
            refs: '$refs.$ref',
            idmedia: '$refs.$id',
            reportedStatus: 1,
            reportedUserCount: 1,
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            refe: '$refs.ref',
            insight: {
              shares: '$shares',
              comments: '$comments',
              reaction: '$reaction',
              views: '$views',
              likes: '$likes',
            },
          }
        },

        {
          $lookup: {
            from: 'mediapicts',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediaPict_data',
          },
        },
        {
          $lookup: {
            from: 'mediadiaries',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediadiaries_data',
          },
        },
        {
          $lookup: {
            from: 'mediavideos',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediavideos_data',
          },
        },
        {
          $project: {
            mediapict: { $arrayElemAt: ['$mediaPict_data', 0] },
            mediadiaries: { $arrayElemAt: ['$mediadiaries_data', 0] },
            mediavideos: { $arrayElemAt: ['$mediavideos_data', 0] },
            mediapictPath: '$mediapict.mediaBasePath',
            mediadiariPath: '$mediadiaries.mediaBasePath',
            mediavideoPath: '$mediavideos.mediaBasePath',
            refs: 1,
            reportedStatus: 1,
            reportedUserCount: 1,
            idmedia: 1,
            rotate: '$mediadiaries.rotate',
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            privacy: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            insight: 1,



          }
        },

        {
          $addFields: {

            concats: '/profilepict',
            pict: { $replaceOne: { input: "$profilpict.mediaUri", find: "_0001.jpeg", replacement: "" } },
            concatmediapict: '/pict',
            media_pict: { $replaceOne: { input: "$mediapict.mediaUri", find: "_0001.jpeg", replacement: "" } },


            concatmediadiari: '/stream',
            concatthumbdiari: '/thumb',
            media_diari: '$mediadiaries.mediaUri',

            concatmediavideo: '/stream',
            concatthumbvideo: '/thumb',
            media_video: '$mediavideos.mediaUri'
          },
        },
        {
          $project: {
            rotate: '$mediadiaries.rotate',
            mediaBasePath: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaBasePath' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaBasePath' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaBasePath' }
                ],
                default: ''
              }
            },
            mediaUri: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaUri' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaUri' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaUri' }
                ],
                default: ''
              }
            },
            mediaType: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaType' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaType' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaType' }
                ],
                default: ''
              }
            },

            mediaThumbEndpoint: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatthumbdiari", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatthumbvideo", "/", "$postID"] }, }
                ],
                default: ''
              }
            },

            mediaEndpoint: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': { $concat: ["$concatmediapict", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatmediadiari", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatmediavideo", "/", "$postID"] }, }
                ],
                default: ''
              }
            },

            mediaThumbUri: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaThumb' }
                ],
                default: ''
              }
            },
            apsaraId: {
              $switch: {
                branches: [
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediapicts"
                      ]
                    },
                    then: "$mediapict.apsaraId"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediadiaries"
                      ]
                    },
                    then: "$mediadiaries.apsaraId"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediavideos"
                      ]
                    },
                    then: "$mediavideos.apsaraId"
                  }
                ],
                default: false
              }
            },
            apsara: {
              $switch: {
                branches: [
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediapicts"
                      ]
                    },
                    then: "$mediapict.apsara"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediadiaries"
                      ]
                    },
                    then: "$mediadiaries.apsara"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediavideos"
                      ]
                    },
                    then: "$mediavideos.apsara"
                  }
                ],
                default: false
              }
            },
            reportedStatus: 1,
            reportedUserCount: 1,
            fullName: 1,
            username: '$auth.username',
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            privacy: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            insight: 1,

          }
        },

        {
          $match: {

            description: {
              $regex: keys, $options: 'i'
            }, postType: postType, visibility: "PUBLIC", active: true, reportedStatus: { $ne: "OWNED" }, $or: [
              {
                "reportedUser": {
                  "$elemMatch": {
                    "email": email,
                    "active": false,

                  }
                }
              },
              {
                "reportedUser.email": {
                  $not: {
                    $regex: email
                  }
                }
              },

            ]
          }
        },
        { $sort: { description: -1 }, },
        { $skip: skip },
        { $limit: limit },
      ]);

      return query;
    }
    else {
      const query = await this.PostsModel.aggregate([


        // {
        //   $lookup: {
        //     from: "userbasics",
        //     as: "ubasic",
        //     let: {
        //       local_id: '$reportedUser.email'
        //     },
        //     pipeline: [
        //       {
        //         $match: {
        //           $expr: {
        //             $and: [
        //               {
        //                 $in: ['$email', {
        //                   $ifNull: ['$$local_id', []]
        //                 }]
        //               },

        //             ]
        //           }
        //         }
        //       },
        //       {
        //         $project: {
        //           fullName: 1,
        //           email: 1
        //         }
        //       },

        //     ],

        //   }
        // },
        {
          $addFields: {

            salePrice: { $cmp: ["$saleAmount", 0] }

          },
        },


        {
          $project: {
            refs: { $arrayElemAt: ['$contentMedias', 0] },
            createdAt: 1,
            reportedStatus: 1,
            reportedUserCount: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            likes: 1,
            shares: 1,
            reaction: 1,
            comments: 1,
            isOwned: 1,
            views: 1,
            visibility: 1,
            allowComments: 1,
            certified: 1,
            isViewed:
            {
              $cond: { if: { $eq: ["$views", 0] }, then: false, else: true }
            },

            saleLike: {
              $cond: { if: { $eq: ["$saleLike", -1] }, then: false, else: "$saleLike" }
            },
            saleView: {
              $cond: { if: { $eq: ["$saleView", -1] }, then: false, else: "$saleView" }
            },
            saleAmount: {
              $cond: { if: { $eq: ["$salePrice", -1] }, then: 0, else: "$saleAmount" }
            },
            monetize: {
              $cond: {
                if: {
                  $or: [{
                    $eq: ["$salePrice", -1]
                  }, {
                    $eq: ["$salePrice", 0]
                  },]
                },
                then: false,
                else: true
              },

            },



          }
        },
        {
          $project: {
            refs: '$refs.$ref',
            idmedia: '$refs.$id',
            reportedStatus: 1,
            reportedUserCount: 1,
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            refe: '$refs.ref',
            insight: {
              shares: '$shares',
              comments: '$comments',
              reaction: '$reaction',
              views: '$views',
              likes: '$likes',
            },
          }
        },

        {
          $lookup: {
            from: 'mediapicts',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediaPict_data',
          },
        },
        {
          $lookup: {
            from: 'mediadiaries',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediadiaries_data',
          },
        },
        {
          $lookup: {
            from: 'mediavideos',
            localField: 'idmedia',
            foreignField: '_id',
            as: 'mediavideos_data',
          },
        },
        {
          $project: {
            mediapict: { $arrayElemAt: ['$mediaPict_data', 0] },
            mediadiaries: { $arrayElemAt: ['$mediadiaries_data', 0] },
            mediavideos: { $arrayElemAt: ['$mediavideos_data', 0] },
            mediapictPath: '$mediapict.mediaBasePath',
            mediadiariPath: '$mediadiaries.mediaBasePath',
            mediavideoPath: '$mediavideos.mediaBasePath',
            refs: 1,
            reportedStatus: 1,
            reportedUserCount: 1,
            idmedia: 1,
            rotate: '$mediadiaries.rotate',
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            privacy: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            insight: 1,



          }
        },

        {
          $addFields: {

            concats: '/profilepict',
            pict: { $replaceOne: { input: "$profilpict.mediaUri", find: "_0001.jpeg", replacement: "" } },
            concatmediapict: '/pict',
            media_pict: { $replaceOne: { input: "$mediapict.mediaUri", find: "_0001.jpeg", replacement: "" } },


            concatmediadiari: '/stream',
            concatthumbdiari: '/thumb',
            media_diari: '$mediadiaries.mediaUri',

            concatmediavideo: '/stream',
            concatthumbvideo: '/thumb',
            media_video: '$mediavideos.mediaUri'
          },
        },
        {
          $project: {
            rotate: '$mediadiaries.rotate',
            mediaBasePath: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaBasePath' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaBasePath' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaBasePath' }
                ],
                default: ''
              }
            },
            mediaUri: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaUri' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaUri' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaUri' }
                ],
                default: ''
              }
            },
            mediaType: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaType' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaType' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaType' }
                ],
                default: ''
              }
            },

            mediaThumbEndpoint: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatthumbdiari", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatthumbvideo", "/", "$postID"] }, }
                ],
                default: ''
              }
            },

            mediaEndpoint: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': { $concat: ["$concatmediapict", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatmediadiari", "/", "$postID"] }, },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatmediavideo", "/", "$postID"] }, }
                ],
                default: ''
              }
            },

            mediaThumbUri: {
              $switch: {
                branches: [
                  { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaThumb' },
                  { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaThumb' }
                ],
                default: ''
              }
            },
            apsaraId: {
              $switch: {
                branches: [
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediapicts"
                      ]
                    },
                    then: "$mediapict.apsaraId"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediadiaries"
                      ]
                    },
                    then: "$mediadiaries.apsaraId"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediavideos"
                      ]
                    },
                    then: "$mediavideos.apsaraId"
                  }
                ],
                default: false
              }
            },
            apsara: {
              $switch: {
                branches: [
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediapicts"
                      ]
                    },
                    then: "$mediapict.apsara"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediadiaries"
                      ]
                    },
                    then: "$mediadiaries.apsara"
                  },
                  {
                    case: {
                      $eq: [
                        "$refs",
                        "mediavideos"
                      ]
                    },
                    then: "$mediavideos.apsara"
                  }
                ],
                default: false
              }
            },
            reportedStatus: 1,
            reportedUserCount: 1,
            fullName: 1,
            username: '$auth.username',
            createdAt: 1,
            updatedAt: 1,
            postID: 1,
            email: 1,
            postType: 1,
            description: 1,
            title: 1,
            active: 1,
            metadata: 1,
            location: 1,
            tags: 1,
            isOwned: 1,
            visibility: 1,
            privacy: 1,
            isViewed: 1,
            allowComments: 1,
            certified: 1,
            saleLike: 1,
            saleView: 1,
            saleAmount: 1,
            monetize: 1,
            insight: 1,

          }
        },
        {
          $match: {

            postType: postType, visibility: "PUBLIC", active: true, reportedStatus: { $ne: "OWNED" }, $or: [
              {
                "reportedUser": {
                  "$elemMatch": {
                    "email": email,
                    "active": false,

                  }
                }
              },
              {
                "reportedUser.email": {
                  $not: {
                    $regex: email
                  }
                }
              },

            ]

          }
        },
        { $sort: { description: -1 }, },
        { $skip: skip },
        { $limit: limit },
      ]);

      return query;
    }

  }
  async findcontentfilterTags(keys: string, skip: number, limit: number) {

    const query = await this.PostsModel.aggregate([
      {
        $match: {

          tags: {
            $regex: keys, $options: 'i'
          }

        }
      },
      { $sort: { tags: 1 }, },
      { $skip: skip },
      { $limit: limit },
      {
        $group: {
          _id: '$tags',
          total: {
            $sum: 1
          }
        }
      }
    ]);
    return query;
  }
  async findcountfilteTag(keys: string) {
    const query = await this.PostsModel.aggregate([
      {
        $match: {

          tags: {
            $regex: keys, $options: 'i'
          }


        }
      },
      {
        $group: {
          _id: null,
          totalpost: {
            $sum: 1
          }
        }
      }
    ]);
    return query;
  }
  async findcontentAllTags(skip: number, limit: number) {

    const query = await this.PostsModel.aggregate([


      {
        $group: {
          _id: '$tags',
          total: {
            $sum: 1
          }
        }
      },
      { $sort: { tags: 1 }, },
      { $skip: skip },
      { $limit: limit },
    ]);
    return query;
  }
  async findcountfilteTagAll() {
    const query = await this.PostsModel.aggregate([
      {
        $group: {
          _id: null,
          totalpost: {
            $sum: 1
          }
        }
      }
    ]);
    return query;
  }
  async findcountfilterall(keys: string, postType: string, email: string) {

    if (keys !== undefined) {
      const query = await this.PostsModel.aggregate([
        {
          $match: {

            description: {
              $regex: keys, $options: 'i'
            }, postType: postType, visibility: "PUBLIC", active: true, reportedStatus: { $ne: "OWNED" }, 'ubasic.email': {
              $ne: email
            },
          }
        },
        {
          $group: {
            _id: null,
            totalpost: {
              $sum: 1
            }
          }
        }
      ]);
      return query;
    } else {
      const query = await this.PostsModel.aggregate([
        {
          $match: {

            postType: postType, visibility: "PUBLIC", active: true, reportedStatus: { $ne: "OWNED" }, 'ubasic.email': {
              $ne: email
            },

          }
        },
        {
          $group: {
            _id: null,
            totalpost: {
              $sum: 1
            }
          }
        }
      ]);
      return query;
    }
  }

  async findhistorySell(postID: string) {

    const query = await this.PostsModel.aggregate([
      {
        $match: {
          postID: postID

        }
      },
      {
        $addFields: {

          salePrice: { $cmp: ["$saleAmount", 0] }

        },
      },


      {
        $project: {
          refs: { $arrayElemAt: ['$contentMedias', 0] },
          createdAt: '$createdAt',
          updatedAt: '$updatedAt',
          postID: '$postID',
          email: '$email',
          postType: '$postType',
          description: '$description',
          title: '$description',
          active: '$active',
          metadata: '$metadata',
          location: '$location',
          tags: '$tags',
          likes: '$likes',
          shares: '$shares',
          reaction: '$reaction',
          comments: '$comments',
          isOwned: '$isOwned',
          views: '$views',
          visibility: '$visibility',
          isViewed:
          {
            $cond: { if: { $eq: ["$views", 0] }, then: false, else: true }
          },
          allowComments: '$allowComments',
          certified: '$certified',
          saleLike: {
            $cond: { if: { $eq: ["$saleLike", -1] }, then: false, else: "$saleLike" }
          },
          saleView: {
            $cond: { if: { $eq: ["$saleView", -1] }, then: false, else: "$saleView" }
          },
          saleAmount: {
            $cond: { if: { $eq: ["$salePrice", -1] }, then: 0, else: "$saleAmount" }
          },
          monetize: {
            $cond: { if: { $eq: ["$salePrice", -1] }, then: false, else: true }
          },


        }
      },
      {
        $project: {
          refs: '$refs.$ref',
          idmedia: '$refs.$id',
          createdAt: '$createdAt',
          updatedAt: '$updatedAt',
          postID: '$postID',
          email: '$email',
          postType: '$postType',
          description: '$description',
          title: '$description',
          active: '$active',
          metadata: '$metadata',
          location: '$location',
          tags: '$tags',
          isOwned: '$isOwned',
          visibility: '$visibility',
          isViewed: '$isViewed',
          allowComments: '$allowComments',
          certified: '$certified',
          saleLike: '$saleLike',
          saleView: '$saleView',
          saleAmount: '$saleAmount',
          monetize: '$monetize',
          refe: '$refs.ref',
          insight: {
            shares: '$shares',
            comments: '$comments',
            reaction: '$reaction',
            views: '$views',
            likes: '$likes',
          },
        }
      },

      {
        $lookup: {
          from: 'mediapicts',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediaPict_data',
        },
      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediadiaries_data',
        },
      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediavideos_data',
        },
      },
      {
        $project: {
          mediapict: { $arrayElemAt: ['$mediaPict_data', 0] },
          mediadiaries: { $arrayElemAt: ['$mediadiaries_data', 0] },
          mediavideos: { $arrayElemAt: ['$mediavideos_data', 0] },
          mediapictPath: '$mediapict.mediaBasePath',
          mediadiariPath: '$mediadiaries.mediaBasePath',
          mediavideoPath: '$mediavideos.mediaBasePath',
          refs: '$refs',
          idmedia: '$idmedia',
          rotate: '$mediadiaries.rotate',
          createdAt: '$createdAt',
          updatedAt: '$updatedAt',
          postID: '$postID',
          email: '$email',
          postType: '$postType',
          description: '$description',
          title: '$description',
          active: '$active',
          metadata: '$metadata',
          location: '$location',
          tags: '$tags',
          isOwned: '$isOwned',
          visibility: '$visibility',
          privacy: '$privacy',
          isViewed: '$isViewed',
          allowComments: '$allowComments',
          certified: '$certified',
          saleLike: '$saleLike',
          saleView: '$saleView',
          saleAmount: '$saleAmount',
          monetize: '$monetize',
          insight: '$insight',



        }
      },

      {
        $addFields: {

          concats: '/profilepict',
          pict: { $replaceOne: { input: "$profilpict.mediaUri", find: "_0001.jpeg", replacement: "" } },
          concatmediapict: '/pict',
          media_pict: { $replaceOne: { input: "$mediapict.mediaUri", find: "_0001.jpeg", replacement: "" } },


          concatmediadiari: '/stream',
          concatthumbdiari: '/thumb',
          media_diari: '$mediadiaries.mediaUri',

          concatmediavideo: '/stream',
          concatthumbvideo: '/thumb',
          media_video: '$mediavideos.mediaUri'
        },
      },
      {
        $project: {
          rotate: '$mediadiaries.rotate',
          mediaBasePath: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaBasePath' },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaBasePath' },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaBasePath' }
              ],
              default: ''
            }
          },
          mediaUri: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaUri' },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaUri' },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaUri' }
              ],
              default: ''
            }
          },
          mediaType: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediapict.mediaType' },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaType' },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaType' }
              ],
              default: ''
            }
          },

          mediaThumbEndpoint: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatthumbdiari", "/", "$postID"] }, },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatthumbvideo", "/", "$postID"] }, }
              ],
              default: ''
            }
          },

          mediaEndpoint: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': { $concat: ["$concatmediapict", "/", "$postID"] }, },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': { $concat: ["$concatmediadiari", "/", "$postID"] }, },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': { $concat: ["$concatmediavideo", "/", "$postID"] }, }
              ],
              default: ''
            }
          },

          mediaThumbUri: {
            $switch: {
              branches: [
                { 'case': { '$eq': ['$refs', 'mediapicts'] }, 'then': '$mediadiaries.mediaThumb' },
                { 'case': { '$eq': ['$refs', 'mediadiaries'] }, 'then': '$mediadiaries.mediaThumb' },
                { 'case': { '$eq': ['$refs', 'mediavideos'] }, 'then': '$mediavideos.mediaThumb' }
              ],
              default: ''
            }
          },
          apsaraId: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsaraId"
                }
              ],
              default: false
            }
          },
          apsara: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsara"
                }
              ],
              default: false
            }
          },
          fullName: '$fullName',
          username: '$auth.username',
          createdAt: '$createdAt',
          updatedAt: '$updatedAt',
          postID: '$postID',
          email: '$email',
          postType: '$postType',
          description: '$description',
          title: '$description',
          active: '$active',
          metadata: '$metadata',
          location: '$location',
          tags: '$tags',
          isOwned: '$isOwned',
          visibility: '$visibility',
          privacy: '$privacy',
          isViewed: '$isViewed',
          allowComments: '$allowComments',
          certified: '$certified',
          saleLike: '$saleLike',
          saleView: '$saleView',
          saleAmount: '$saleAmount',
          monetize: '$monetize',
          insight: '$insight',

        }
      },
      { $sort: { createdAt: -1 }, },

    ]);
    return query;
  }

  async findreport(keys: string, postType: string, startdate: string, enddate: string, page: number, limit: number, startreport: number, endreport: number, status: any[], reason: any[], descending: boolean, reasonAppeal: any[], username: string, jenis: string, email: string) {
    try {
      var currentdate = new Date(new Date(enddate).setDate(new Date(enddate).getDate() + 1));

      var dateend = currentdate.toISOString();
    } catch (e) {
      dateend = "";
    }
    const mongoose = require('mongoose');
    var ObjectId = require('mongodb').ObjectId;
    var order = null;

    if (descending === true) {
      order = -1;
    } else {
      order = 1;
    }
    var pipeline = [];


    pipeline = [
      {
        $lookup: {
          from: 'userbasics',
          localField: 'email',
          foreignField: 'email',
          as: 'basicdata',

        }
      },

      {
        $addFields: {

          'profilepictid': {
            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
          },
          'userAuth_id': { $arrayElemAt: ['$basicdata.userAuth.$id', 0] }

        }
      },
      {
        $lookup: {
          from: 'mediaprofilepicts',
          localField: 'profilepictid',
          foreignField: '_id',
          as: 'avatardata',

        }
      },
      {
        $lookup: {
          from: 'userauths',
          localField: 'userAuth_id',
          foreignField: '_id',
          as: 'userAuth_data',
        },
      },
      {
        $addFields: {
          'avatar': {
            $arrayElemAt: ['$avatardata', 0]
          },
          'basic': {
            $arrayElemAt: ['$basicdata', 0]
          },
          'auth': {
            $arrayElemAt: ['$userAuth_data', 0]
          },

        }
      },
      {
        $project: {
          refs: {
            $arrayElemAt: ['$contentMedias', 0]
          },
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUserHandle: 1,
          reportedUser: 1,
          fullName: '$basic.fullName',
          username: '$auth.username',
          avatar: {
            mediaBasePath: '$avatar.mediaBasePath',
            mediaUri: '$avatar.mediaUri',
            mediaType: '$avatar.mediaType',
            mediaEndpoint: '$avatar.fsTargetUri',
            medreplace: {
              $replaceOne: {
                input: "$avatar.mediaUri",
                find: "_0001.jpeg",
                replacement: ""
              }
            },

          },
        }
      },
      {
        $project: {
          refs: '$refs.$ref',
          idmedia: '$refs.$id',
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          fullName: 1,
          username: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUserHandle: 1,
          reportedUser: 1,
          avatar: 1
        }
      },
      {
        $addFields: {

          concat: '/profilepict',
          pict: { $replaceOne: { input: "$avatar.mediaUri", find: "_0001.jpeg", replacement: "" } },
        },
      },
      {
        $lookup: {
          from: 'mediapicts',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediaPict_data',

        },

      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediadiaries_data',

        },

      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'idmedia',
          foreignField: '_id',
          as: 'mediavideos_data',

        },

      },
      {
        $project: {
          mediapict: {
            $arrayElemAt: ['$mediaPict_data', 0]
          },
          mediadiaries: {
            $arrayElemAt: ['$mediadiaries_data', 0]
          },
          mediavideos: {
            $arrayElemAt: ['$mediavideos_data', 0]
          },
          mediapictPath: '$mediapict.mediaBasePath',
          mediadiariPath: '$mediadiaries.mediaBasePath',
          mediavideoPath: '$mediavideos.mediaBasePath',
          refs: '$refs',
          idmedia: 1,
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          fullName: 1,
          username: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUserHandle: 1,
          reportedUser: 1,
          avatar: {
            mediaBasePath: '$profilpict.mediaBasePath',
            mediaUri: '$profilpict.mediaUri',
            mediaType: '$profilpict.mediaType',
            mediaEndpoint: { $concat: ["$concat", "/", "$pict"] },

          },
        }
      },
      {
        $addFields: {

          concatmediapict: '/pict',
          media_pict: {
            $replaceOne: {
              input: "$mediapict.mediaUri",
              find: "_0001.jpeg",
              replacement: ""
            }
          },
          concatmediadiari: '/stream',
          concatthumbdiari: '/thumb',
          media_diari: '$mediadiaries.mediaUri',
          concatmediavideo: '/stream',
          concatthumbvideo: '/thumb',
          media_video: '$mediavideos.mediaUri'
        },

      },
      {
        $project: {
          rotate: '$mediadiaries.rotate',
          mediaBasePath: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': '$mediapict.mediaBasePath'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': '$mediadiaries.mediaBasePath'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': '$mediavideos.mediaBasePath'
                }
              ],
              default: ''
            }
          },
          mediaUri: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': '$mediapict.mediaUri'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': '$mediadiaries.mediaUri'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': '$mediavideos.mediaUri'
                }
              ],
              default: ''
            }
          },
          mediaType: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': '$mediapict.mediaType'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': '$mediadiaries.mediaType'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': '$mediavideos.mediaType'
                }
              ],
              default: ''
            }
          },
          mediaThumbEndpoint: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': '$mediadiaries.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': {
                    $concat: ["$concatthumbdiari", "/", "$postID"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': {
                    $concat: ["$concatthumbvideo", "/", "$postID"]
                  },

                }
              ],
              default: ''
            }
          },
          mediaEndpoint: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': {
                    $concat: ["$concatmediapict", "/", "$postID"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': {
                    $concat: ["$concatmediadiari", "/", "$postID"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': {
                    $concat: ["$concatmediavideo", "/", "$postID"]
                  },

                }
              ],
              default: ''
            }
          },
          mediaThumbUri: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$refs', 'mediapicts']
                  },
                  'then': '$mediadiaries.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediadiaries']
                  },
                  'then': '$mediadiaries.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$refs', 'mediavideos']
                  },
                  'then': '$mediavideos.mediaThumb'
                }
              ],
              default: ''
            }
          },
          apsaraId: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsaraId"
                }
              ],
              default: ""
            }
          },
          idmedia: '$idmedia',
          apsara: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsara"
                }
              ],
              default: false
            }
          },
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          fullName: 1,
          username: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUser: 1,
          avatar: 1,
          reportedUserHandle: 1,
          reportReasonIdLast: {
            $last: "$reportedUser.reportReasonId"
          },
          reasonLast: {
            $last: "$reportedUser.description"
          },
          lastAppeal: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                }, {
                  $eq: ["$reportedUserHandle", "Lainnya"]
                }]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reason"
              }
            },

          },
          createdAtReportLast: {
            $last: "$reportedUser.createdAt"
          },
          createdAtAppealLast: {
            $last: "$reportedUserHandle.createdAt"
          },
          statusLast: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                }]
              },
              then: "BARU",
              else: {
                $last: "$reportedUserHandle.status"
              }
            },

          },

        }
      },
      {
        $project: {
          rotate: 1,
          mediaBasePath: 1,
          mediaUri: 1,
          mediaType: 1,
          mediaThumbEndpoint: 1,
          mediaEndpoint: 1,
          mediaThumbUri: 1,
          apsaraId: 1,
          idmedia: 1,
          apsara: 1,
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          fullName: 1,
          username: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUser: 1,
          avatar: 1,
          reportedUserHandle: 1,
          reportReasonIdLast: 1,
          reasonLast: 1,
          createdAtReportLast: 1,
          createdAtAppealLast: 1,
          statusLast: 1,
          lastAppeal: 1,
          reasonLastAppeal: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$lastAppeal", null]
                }, {
                  $eq: ["$lastAppeal", ""]
                }, {
                  $eq: ["$lastAppeal", "Lainnya"]
                }]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reason"
              }
            },

          },
          reportStatusLast: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$statusLast", null]
                }, {
                  $eq: ["$statusLast", ""]
                }, {
                  $eq: ["$statusLast", []]
                }, {
                  $eq: ["$statusLast", "BARU"]
                }]
              },
              then: "BARU",
              else: {
                $last: "$reportedUserHandle.status"
              }
            },

          },

        }
      },
      {
        $project: {
          rotate: 1,
          mediaBasePath: 1,
          mediaUri: 1,
          mediaType: 1,
          mediaThumbEndpoint: 1,
          mediaEndpoint: 1,
          mediaThumbUri: 1,
          apsaraId: 1,
          idmedia: 1,
          apsara: 1,
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          fullName: 1,
          username: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          contentModeration: 1,
          contentModerationResponse: 1,
          reportedStatus: 1,
          reportedUserCount: 1,
          reportedUser: 1,
          reportedUserHandle: 1,
          reportReasonIdLast: 1,
          reasonLast: 1,
          createdAtReportLast: 1,
          createdAtAppealLast: 1,
          statusLast: 1,
          reportStatusLast: 1,
          reasonLastAppeal: 1,
          avatar: 1,


        }
      },



    ];

    if (jenis === "report") {
      pipeline.push(
        {
          $match: {
            $and: [
              {
                reportedUser: {
                  $ne: null
                }, active: true
              },
              {
                reportedUser: {
                  $ne: []
                }, active: true
              },

            ]
          }
        },

      );
    } else if (jenis === "appeal") {
      pipeline.push({
        $match: {
          $and: [
            {
              reportedUserHandle: {
                $ne: null
              }, active: true
            },
            {
              reportedUserHandle: {
                $ne: []
              }, active: true
            },

          ]
        }
      },);
    }

    if (email && email !== undefined) {
      pipeline.push({ $match: { email: email } });
    }
    if (keys && keys !== undefined) {

      pipeline.push({
        $match: {
          description: {
            $regex: keys,
            $options: 'i'
          },

        }
      },);

    }
    if (username && username !== undefined) {

      pipeline.push({
        $match: {
          username: {
            $regex: username,
            $options: 'i'
          },

        }
      },);

    }

    if (postType && postType !== undefined) {
      pipeline.push({
        $match: {
          postType: postType

        }
      },);
    }
    if (startdate && startdate !== undefined) {
      if (jenis === "report") {
        pipeline.push({ $match: { createdAtReportLast: { "$gte": startdate } } });
      }
      else if (jenis === "appeal") {
        pipeline.push({ $match: { createdAtAppealLast: { "$gte": startdate } } });
      }
    }
    if (enddate && enddate !== undefined) {


      if (jenis === "report") {
        pipeline.push({ $match: { createdAtReportLast: { "$lte": dateend } } });
      }
      else if (jenis === "appeal") {
        pipeline.push({ $match: { createdAtAppealLast: { "$lte": dateend } } });
      }
    }
    if (startreport && startreport !== undefined) {
      pipeline.push({ $match: { reportedUserCount: { "$gte": startreport } } });
    }
    if (endreport && endreport !== undefined) {
      pipeline.push({ $match: { reportedUserCount: { "$lte": endreport } } });
    }

    if (status && status !== undefined) {

      pipeline.push(
        {
          $match: {
            $or: [
              {
                reportStatusLast: {
                  $in: status
                }
              },

            ]
          }
        },
      );

    }
    if (reason && reason !== undefined) {

      let reasonsleng = reason.length;
      let arrayReason = [];
      for (var i = 0; i < reasonsleng; i++) {
        var id = reason[i];
        var idreason = mongoose.Types.ObjectId(id);
        arrayReason.push(idreason);
      }
      pipeline.push(
        {
          $match: {
            $or: [
              {
                reportReasonIdLast: {
                  $in: arrayReason
                }
              },

            ]
          }
        });

    }
    if (reasonAppeal && reasonAppeal !== undefined) {

      pipeline.push(
        {
          $match: {
            $or: [
              {
                reasonLastAppeal: {
                  $in: reasonAppeal
                }
              },

            ]
          }
        });

    }
    if (jenis === "report") {
      pipeline.push({
        $sort: {
          createdAtReportLast: order
        },

      });
    }
    else if (jenis === "appeal") {
      pipeline.push({
        $sort: {
          createdAtAppealLast: order
        },

      });
    }
    if (page > 0) {
      pipeline.push({ $skip: (page * limit) });
    }
    if (limit > 0) {
      pipeline.push({ $limit: limit });
    }
    let query = await this.PostsModel.aggregate(pipeline);

    return query;
  }


  async findreportdetail(postID: string, iduser: string) {

    let query = await this.PostsModel.aggregate([

      {
        $match: {
          iduserbuyer: iduser,
          postID: postID
        }
      },

      {
        $addFields: {
          type: 'Buy',
          jenis: "$type",

        },
      },
      {
        $lookup: {
          from: "userbasics",
          localField: "iduserbuyer",
          foreignField: "_id",
          as: "userbasics_data"
        }
      }, {
        $lookup: {
          from: "posts",
          localField: "postid",
          foreignField: "postID",
          as: "post_data"
        }
      }, {
        $lookup: {
          from: "mediapicts",
          localField: "post_data.contentMedias.$id",
          foreignField: "_id",
          as: "mediaPict_data"
        }
      }, {
        $lookup: {
          from: "mediadiaries",
          localField: "post_data.contentMedias.$id",
          foreignField: "_id",
          as: "mediadiaries_data"
        }
      }, {
        $lookup: {
          from: "mediavideos",
          localField: "post_data.contentMedias.$id",
          foreignField: "_id",
          as: "mediavideos_data"
        }
      },
      {
        $lookup: {
          from: "userbasics",
          localField: "idusersell",
          foreignField: "_id",
          as: "userbasics_sell"
        }
      },
      {
        $project: {
          iduser: "$iduserbuyer",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          user: {
            $arrayElemAt: [
              "$userbasics_data",
              0
            ]
          },
          usersell: {
            $arrayElemAt: [
              "$userbasics_sell",
              0
            ]
          },
          postdata: {
            $arrayElemAt: [
              "$post_data",
              0
            ]
          },
          mediapict: {
            $arrayElemAt: [
              "$mediaPict_data",
              0
            ]
          },
          mediadiaries: {
            $arrayElemAt: [
              "$mediadiaries_data",
              0
            ]
          },
          mediavideos: {
            $arrayElemAt: [
              "$mediavideos_data",
              0
            ]
          }
        }
      }, {
        $project: {
          contentMedias: "$postdata.contentMedias",
          iduser: "$iduser",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          fullName: "$user.fullName",
          email: "$user.email",
          penjual: "$usersell.fullName",
          emailpenjual: "$usersell.email",
          postID: "$postdata.postID",
          postType: "$postdata.postType",
          descriptionContent: '$postdata.description',
          title: '$postdata.description',
          mediapict: "$mediapict",
          mediadiaries: "$mediadiaries",
          mediavideos: "$mediavideos",
          mediapictPath: "$mediapict.mediaBasePath",
          mediadiariPath: "$mediadiaries.mediaBasePath",
          mediavideoPath: "$mediavideos.mediaBasePath"
        }
      }, {
        $project: {
          refs: {
            $arrayElemAt: [
              "$contentMedias",
              0
            ]
          },
          iduser: "$iduser",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          fullName: "$fullName",
          email: "$email",
          penjual: "$penjual",
          emailpenjual: "$emailpenjual",
          postID: "$postID",
          postType: "$postType",
          descriptionContent: '$descriptionContent',
          title: '$title',
          mediapict: "$mediapict",
          mediadiaries: "$mediadiaries",
          mediavideos: "$mediavideos",
          mediapictPath: "$mediapictPath",
          mediadiariPath: "$mediadiariPath",
          mediavideoPath: "$mediavideoPath"
        }
      }, {
        $project: {
          refs: "$refs.$ref",
          iduser: "$iduser",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          fullName: "$fullName",
          email: "$email",
          penjual: "$penjual",
          emailpenjual: "$emailpenjual",
          postID: "$postID",
          postType: "$postType",
          descriptionContent: '$descriptionContent',
          title: '$title',
          mediapict: "$mediapict",
          mediadiaries: "$mediadiaries",
          mediavideos: "$mediavideos",
          mediapictPath: "$mediapictPath",
          mediadiariPath: "$mediadiariPath",
          mediavideoPath: "$mediavideoPath"
        }
      }, {
        $project: {
          refs: "$refs",
          iduser: "$iduser",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          fullName: "$fullName",
          email: "$email",
          penjual: "$penjual",
          emailpenjual: "$emailpenjual",
          postID: "$postID",
          postType: "$postType",
          descriptionContent: '$descriptionContent',
          title: '$title',
          mediapict: "$mediapict",
          mediadiaries: "$mediadiaries",
          mediavideos: "$mediavideos",
          mediapictPath: "$mediapictPath",
          mediadiariPath: "$mediadiariPath",
          mediavideoPath: "$mediavideoPath"
        }
      }, {
        $addFields: {
          concatmediapict: "/pict",
          "media_pict": {
            $replaceOne: {
              input: "$mediapict.mediaUri",
              find: "_0001.jpeg",
              replacement: ""
            }
          },
          concatmediadiari: "/stream",
          concatthumbdiari: "/thumb",
          "media_diari": "$mediadiaries.mediaUri",
          concatmediavideo: "/stream",
          concatthumbvideo: "/thumb",
          "media_video": "$mediavideos.mediaUri"
        }
      }, {
        $project: {

          iduser: "$iduser",
          type: "$type",
          jenis: "$jenis",
          timestamp: "$timestamp",
          description: "$description",
          noinvoice: "$noinvoice",
          nova: "$nova",
          expiredtimeva: "$expiredtimeva",
          salelike: "$salelike",
          saleview: "$saleview",
          bank: "$bank",
          amount: "$amount",
          totalamount: "$totalamount",
          status: "$status",
          fullName: "$fullName",
          email: "$email",
          penjual: "$penjual",
          emailpenjual: "$emailpenjual",
          postID: "$postID",
          postType: "$postType",
          descriptionContent: '$descriptionContent',
          title: '$title',
          mediaBasePath: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.mediaBasePath"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.mediaBasePath"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.mediaBasePath"
                }
              ],
              default: ""
            }
          },
          mediaUri: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.mediaUri"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.mediaUri"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.mediaUri"
                }
              ],
              default: ""
            }
          },
          mediaType: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.mediaType"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.mediaType"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.mediaType"
                }
              ],
              default: ""
            }
          },
          mediaThumbEndpoint: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediadiaries.mediaThumb"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: {
                    $concat: [
                      "$concatthumbdiari",
                      "/",
                      "$postID"
                    ]
                  }
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: {
                    $concat: [
                      "$concatthumbvideo",
                      "/",
                      "$postID"
                    ]
                  }
                }
              ],
              default: ""
            }
          },
          mediaEndpoint: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: {
                    $concat: [
                      "$concatmediapict",
                      "/",
                      "$postID"
                    ]
                  }
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: {
                    $concat: [
                      "$concatmediadiari",
                      "/",
                      "$postID"
                    ]
                  }
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: {
                    $concat: [
                      "$concatmediavideo",
                      "/",
                      "$postID"
                    ]
                  }
                }
              ],
              default: ""
            }
          },
          mediaThumbUri: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediadiaries.mediaThumb"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.mediaThumb"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.mediaThumb"
                }
              ],
              default: ""
            }
          },
          apsaraId: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsaraId"
                }
              ],
              default: ""
            }
          },
          apsara: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediapicts"
                    ]
                  },
                  then: "$mediapict.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediadiaries"
                    ]
                  },
                  then: "$mediadiaries.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$refs",
                      "mediavideos"
                    ]
                  },
                  then: "$mediavideos.apsara"
                }
              ],
              default: false
            }
          },
        }
      },

    ]);

    return query;
  }


  async findreportuserdetail(postID: string) {
    let query = await this.PostsModel.aggregate([

      {
        $lookup: {
          from: 'userbasics',
          localField: 'email',
          foreignField: 'email',
          as: 'basicdata',

        }
      },
      {
        $lookup: {
          from: 'userauths',
          localField: 'email',
          foreignField: 'email',
          as: 'authdata',

        }
      },

      {
        $addFields: {
          'salePrice': {
            $cmp: ["$saleAmount", 0]
          },
          'komen': {
            $cmp: ["$comments", 0]
          },
          'auth': {
            $arrayElemAt: ['$authdata', 0]
          },
          'basic': {
            $arrayElemAt: ['$basicdata', 0]
          },
          'profilepictid': {
            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
          },
          'proofpictid': {
            $arrayElemAt: ['$basicdata.proofPict.$id', 0]
          },
          'insightid': {
            $arrayElemAt: ['$basicdata.insight.$id', 0]
          },
          'mediaid': {
            $arrayElemAt: ['$contentMedias.$id', 0]
          },
          'mediaref': {
            $arrayElemAt: ['$contentMedias.$ref', 0]
          },
          'isViewed': {
            '$cond': {
              if: {
                '$eq': ['$views', 0]
              },
              then: false,
              else: true
            }
          },

        }
      },
      {
        $lookup: {
          from: 'mediaprofilepicts',
          localField: 'profilepictid',
          foreignField: '_id',
          as: 'avatardata',

        }
      },
      {
        "$lookup": {
          from: "mediaproofpicts",
          as: "proofpict",
          let: {
            local_id: '$proofpictid'
          },
          pipeline: [
            {
              $match:
              {


                $expr: {
                  $eq: ['$_id', '$$local_id']
                }
              }
            },
            {
              $project: {
                createdAt: '$createdAt',
                nama: '$nama'
              }
            }
          ],

        }
      },
      {
        $lookup: {
          from: 'insights',
          localField: 'insightid',
          foreignField: '_id',
          as: 'insightdata',

        }
      },
      {
        $lookup: {
          from: 'mediapicts',
          localField: 'mediaid',
          foreignField: '_id',
          as: 'picturedata',

        }
      },
      {
        $lookup: {
          from: 'mediadiaries',
          localField: 'mediaid',
          foreignField: '_id',
          as: 'diarydata',

        }
      },
      {
        $lookup: {
          from: 'mediavideos',
          localField: 'mediaid',
          foreignField: '_id',
          as: 'videodata',

        }
      },
      {
        $addFields: {
          'avatar': {
            $arrayElemAt: ['$avatardata', 0]
          },
          'basic': {
            $arrayElemAt: ['$basicdata', 0]
          },
          'insight': {
            $arrayElemAt: ['$insightdata', 0]
          },
          'picture': {
            $arrayElemAt: ['$picturedata', 0]
          },
          'diary': {
            $arrayElemAt: ['$diarydata', 0]
          },
          'video': {
            $arrayElemAt: ['$videodata', 0]
          },

        }
      },
      {
        $addFields: {
          pathavatar: '/profilepict',
          pathpicture: '/pict',
          mediapicture: {
            $replaceOne: {
              input: "$picture.mediaUri",
              find: "_0001.jpeg",
              replacement: ""
            }
          },
          pathdiary: '/stream',
          paththumbdiary: '/thumb',
          mediadiary: '$diary.mediaUri',
          pathvideo: '/stream',
          paththumbvideo: '/thumb',
          mediavideo: '$video.mediaUri'
        }
      },
      {
        $project: {
          _id: 1,
          insight: {
            shares: '$insight.shares',
            followers: '$insight.followers',
            comments: '$insight.comments',
            followings: '$insight.followings',
            reactions: '$insight.reactions',
            posts: '$insight.posts',
            views: '$insight.views',
            likes: '$insight.likes'
          },
          avatar: {
            mediaBasePath: '$avatar.mediaBasePath',
            mediaUri: '$avatar.mediaUri',
            mediaType: '$avatar.mediaType',
            mediaEndpoint: '$avatar.fsTargetUri',
            medreplace: {
              $replaceOne: {
                input: "$avatar.mediaUri",
                find: "_0001.jpeg",
                replacement: ""
              }
            },

          },
          fullName: "$basic.fullName",
          proofpict: 1,
          username: "$auth.username",
          privacy: {
            isPostPrivate: '$basic.isPostPrivate',
            isCelebrity: '$basic.isCelebrity',
            isPrivate: '$basic.isPrivate'
          },
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          metadata: 1,
          location: 1,
          visibility: 1,
          tags: 1,
          likes: 1,
          views: 1,
          shares: 1,
          komen: 1,
          isOwned: 1,
          tagPeople: 1,
          reportedUserCount: 1,
          reportedUser: 1,
          isIdVerified: '$basic.isIdVerified',
          reportedUserHandle: 1,
          reportedStatus: 1,
          statusUser:
          {
            $cond: {
              if: {
                $eq: ["$basic.isIdVerified", true]
              },
              then: "PREMIUM",
              else: "BASIC"
            }
          },

          isViewed: '$isViewed',
          allowComments: 1,
          isSafe: 1,
          saleLike: 1,
          saleView: 1,
          monetize: {
            $cond: {
              if: {
                $eq: ["$salePrice", - 1]
              },
              then: false,
              else: true
            }
          },
          comments: {
            $cond: {
              if: {
                $eq: ["$komen", - 1]
              },
              then: 0,
              else: '$comments'
            }
          },
          salePrice: '$salePrice',
          saleAmount: {
            $cond: {
              if: {
                $eq: ["$salePrice", - 1]
              },
              then: 0,
              else: "$saleAmount"
            }
          },
          mediaref: "$mediaref",
          rotate: '$diary.rotate',
          mediaBasePath: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': '$picture.mediaBasePath'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': '$diary.mediaBasePath'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': '$video.mediaBasePath'
                }
              ],
              default: ''
            }
          },
          mediaUri: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': '$picture.mediaUri'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': '$diary.mediaUri'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': '$video.mediaUri'
                }
              ],
              default: ''
            }
          },
          mediaType: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': '$picture.mediaType'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': '$diary.mediaType'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': '$video.mediaType'
                }
              ],
              default: ''
            }
          },
          mediaThumbEndpoint: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': '$picture.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': {
                    $concat: ["$paththumbdiary", "/", "$mediadiary"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': {
                    $concat: ["$paththumbvideo", "/", "$mediavideo"]
                  },

                }
              ],
              default: ''
            }
          },
          mediaEndpoint: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': {
                    $concat: ["$pathpicture", "/", "$mediapicture"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': {
                    $concat: ["$pathdiary", "/", "$mediadiary"]
                  },

                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': {
                    $concat: ["$pathvideo", "/", "$mediavideo"]
                  },

                }
              ],
              default: ''
            }
          },
          mediaThumbUri: {
            $switch: {
              branches: [
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediapicts']
                  },
                  'then': '$diary.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediadiaries']
                  },
                  'then': '$diary.mediaThumb'
                },
                {
                  'case': {
                    '$eq': ['$mediaref', 'mediavideos']
                  },
                  'then': '$video.mediaThumb'
                }
              ],
              default: ''
            }
          },
          apsaraId: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediapicts"
                    ]
                  },
                  then: "$picture.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediadiaries"
                    ]
                  },
                  then: "$diary.apsaraId"
                },
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediavideos"
                    ]
                  },
                  then: "$video.apsaraId"
                }
              ],
              default: ""
            }
          },
          apsara: {
            $switch: {
              branches: [
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediapicts"
                    ]
                  },
                  then: "$picture.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediadiaries"
                    ]
                  },
                  then: "$diary.apsara"
                },
                {
                  case: {
                    $eq: [
                      "$mediaref",
                      "mediavideos"
                    ]
                  },
                  then: "$video.apsara"
                }
              ],
              default: false
            }
          },

        }
      },

      {
        $project: {
          _id: 1,
          insight: 1,
          avatar: 1,
          fullName: 1,
          proofpict: 1,
          username: 1,
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          metadata: 1,
          location: 1,
          visibility: 1,
          isIdVerified: 1,
          statusUser: 1,
          tags: 1,
          likes: 1,
          views: 1,
          shares: 1,
          comments: 1,
          isOwned: 1,
          privacy: 1,
          isViewed: 1,
          allowComments: 1,
          isSafe: 1,
          saleLike: 1,
          saleView: 1,
          monetize: 1,
          saleAmount: 1,
          mediaref: 1,
          rotate: 1,
          mediaBasePath: 1,
          mediaUri: 1,
          mediaType: 1,
          mediaThumbEndpoint: 1,
          mediaEndpoint: 1,
          mediaThumbUri: 1,
          apsaraId: 1,
          apsara: 1,
          tagPeople: 1,
          reportedUserCount: 1,
          reportedUserHandle: 1,
          reportedUser: 1,
          reportedStatus: 1,
          lastReasonReport: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUser", null]
                }, {
                  $eq: ["$reportedUser", ""]
                }, {
                  $eq: ["$reportedUser", []]
                },]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUser.description"
              }
            },

          },
          lastAppeal: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                },]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reason"
              }
            },

          },
          lastAppealAdmin: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                },]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reasonAdmin"
              }
            },

          },
          createdAtReportLast: {
            $last: "$reportedUser.createdAt"
          },
          createdAtAppealLast: {
            $last: "$reportedUserHandle.createdAt"
          },
          statusLast: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                }]
              },
              then: "BARU",
              else: {
                $last: "$reportedUserHandle.status"
              }
            },

          },


        }
      },
      {
        $project: {
          _id: 1,
          insight: 1,
          avatar: 1,
          fullName: 1,
          proofpict: 1,
          username: 1,
          createdAt: 1,
          updatedAt: 1,
          postID: 1,
          email: 1,
          postType: 1,
          description: 1,
          title: 1,
          active: 1,
          metadata: 1,
          location: 1,
          visibility: 1,
          isIdVerified: 1,
          statusUser: 1,
          tags: 1,
          likes: 1,
          views: 1,
          shares: 1,
          comments: 1,
          isOwned: 1,
          privacy: 1,
          isViewed: 1,
          allowComments: 1,
          isSafe: 1,
          saleLike: 1,
          saleView: 1,
          monetize: 1,
          saleAmount: 1,
          mediaref: 1,
          rotate: 1,
          mediaBasePath: 1,
          mediaUri: 1,
          mediaType: 1,
          mediaThumbEndpoint: 1,
          mediaEndpoint: 1,
          mediaThumbUri: 1,
          apsaraId: 1,
          apsara: 1,
          tagPeople: 1,
          reportedUserCount: 1,
          reportedUserHandle: 1,
          reportedUser: 1,
          reportedStatus: 1,
          createdAtReportLast: 1,
          createdAtAppealLast: 1,
          lastAppeal: 1,
          lastAppealAdmin: 1,
          lastReasonReport: 1,
          statusLast: 1,
          reasonLastReport: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$lastReasonReport", null]
                }, {
                  $eq: ["$lastReasonReport", ""]
                }, {
                  $eq: ["$lastReasonReport", "Lainnya"]
                }]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUser.description"
              }
            },

          },
          reasonLastAppeal: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$lastAppeal", null]
                }, {
                  $eq: ["$lastAppeal", ""]
                }, {
                  $eq: ["$lastAppeal", "Lainnya"]
                }]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reason"
              }
            },

          },
          reasonLastAppealAdmin: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$lastAppealAdmin", null]
                }, {
                  $eq: ["$lastAppealAdmin", ""]
                }, {
                  $eq: ["$lastAppealAdmin", "Lainnya"]
                }]
              },
              then: "Lainnya",
              else: {
                $last: "$reportedUserHandle.reasonAdmin"
              }
            },

          },
          reportStatusLast: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$statusLast", null]
                }, {
                  $eq: ["$statusLast", ""]
                }, {
                  $eq: ["$statusLast", []]
                }, {
                  $eq: ["$statusLast", "BARU"]
                }]
              },
              then: "BARU",
              else: {
                $last: "$reportedUserHandle.status"
              }
            },

          },

        }
      },

      {
        $match: { postID: postID }
      }

    ]);

    return query;
  }


  async countPostAppeal() {
    let query = await this.PostsModel.aggregate([
      {
        $match: {

          'reportedUserHandle': { $ne: null }
        }
      },
      {
        $group: {
          _id: null,
          totalpost: {
            $sum: 1
          }
        }
      }
    ]);
    return query;
  }

  async countReason(postID: string) {
    let query = await this.PostsModel.aggregate([
      {
        $match: {

          postID: postID
        }
      },
      {
        $unwind: "$reportedUser"
      },
      {
        $match: {

          'reportedUser.active': true
        }
      },
      {
        $group: {
          _id: "$reportedUser.description",

          myCount: {
            $sum: 1
          }
        }
      },
      {
        $project: {
          _id: "$_id",
          "myCount": "$myCount",

        }
      }

    ]);
    return query;
  }

  async countReportStatus(startdate: string, enddate: string) {
    try {
      var currentdate = new Date(new Date(enddate).setDate(new Date(enddate).getDate() + 1));

      var dateend = currentdate.toISOString();
    } catch (e) {
      dateend = "";
    }

    var pipeline = [];

    if (startdate === undefined && enddate === undefined) {
      pipeline.push(
        {
          $addFields: {

            statusLast: {
              $cond: {
                if: {
                  $or: [{
                    $eq: ["$reportedUserHandle", null]
                  }, {
                    $eq: ["$reportedUserHandle", ""]
                  }, {
                    $eq: ["$reportedUserHandle", []]
                  }]
                },
                then: "BARU",
                else: {
                  $last: "$reportedUserHandle.status"
                }
              },

            },

          }
        },
        {
          $facet: {
            "moderation": [
              {
                $addFields: {
                  createdAtReportLast: "$createdAt",

                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {


                  active: true,
                  contentModeration: true
                }
              },

              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  },

                }
              },

            ],

            "report": [
              {
                $addFields: {
                  createdAtReportLast: {
                    $last: "$reportedUser.createdAt"
                  },
                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {

                  reportedUser: {
                    $ne: null
                  },
                  active: true,
                  // contentModeration: false
                }
              },
              {
                $match: {
                  reportedUser: {
                    $ne: []
                  },
                  active: true,
                  // contentModeration: false
                }
              },

              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  },

                }
              },

            ],
            "appeal": [
              {
                $addFields: {
                  createdAtReportLast: {
                    $last: "$reportedUserHandle.createdAt"
                  },
                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {

                  reportedUserHandle: {
                    $ne: null
                  },
                  active: true,

                }
              },
              {
                $match: {
                  reportedUserHandle: {
                    $ne: []
                  },
                  active: true,
                }
              },

              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  }
                }
              },

            ]
          },

        }
      );
    }
    else if (startdate !== undefined && enddate !== undefined) {
      pipeline.push({
        $addFields: {

          statusLast: {
            $cond: {
              if: {
                $or: [{
                  $eq: ["$reportedUserHandle", null]
                }, {
                  $eq: ["$reportedUserHandle", ""]
                }, {
                  $eq: ["$reportedUserHandle", []]
                }]
              },
              then: "BARU",
              else: {
                $last: "$reportedUserHandle.status"
              }
            },

          },

        }
      },
        {
          $facet: {
            "moderation": [
              {
                $addFields: {
                  createdAtReportLast: "$createdAt",

                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {


                  active: true,
                  contentModeration: true
                }
              },
              { $match: { createdAtReportLast: { "$gte": startdate, "$lte": dateend } } },
              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  },

                }
              },

            ],

            "report": [
              {
                $addFields: {
                  createdAtReportLast: {
                    $last: "$reportedUser.createdAt"
                  },
                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {

                  reportedUser: {
                    $ne: null
                  },
                  active: true,
                  contentModeration: false
                }
              },
              {
                $match: {
                  reportedUser: {
                    $ne: []
                  },
                  active: true,
                  contentModeration: false
                }
              },
              { $match: { createdAtReportLast: { "$gte": startdate, "$lte": dateend } } },
              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  },

                }
              },

            ],
            "appeal": [
              {
                $addFields: {
                  createdAtReportLast: {
                    $last: "$reportedUserHandle.createdAt"
                  },
                  reportStatusLast: {
                    $cond: {
                      if: {
                        $or: [{
                          $eq: ["$statusLast", null]
                        }, {
                          $eq: ["$statusLast", ""]
                        }, {
                          $eq: ["$statusLast", []]
                        }, {
                          $eq: ["$statusLast", "BARU"]
                        }]
                      },
                      then: "BARU",
                      else: {
                        $last: "$reportedUserHandle.status"
                      }
                    },

                  },

                }
              },
              {
                $match: {

                  reportedUserHandle: {
                    $ne: null
                  },
                  active: true,
                  contentModeration: false
                }
              },
              {
                $match: {
                  reportedUserHandle: {
                    $ne: []
                  },
                  active: true,
                  contentModeration: false
                }
              },
              { $match: { createdAtReportLast: { "$gte": startdate, "$lte": dateend } } },
              {
                $group: {
                  _id: "$reportStatusLast",
                  myCount: {
                    $sum: 1
                  }
                }
              },

            ]
          },

        });
    }

    let query = await this.PostsModel.aggregate(pipeline);

    return query;
  }

  async testLandingpage() {

    let today = new Date();
    //today.setHours(today.getHours() + 7);
    // console.log(today);
    let query = await this.PostsModel.aggregate([
      {
        "$unwind": {
          "path": "$boosted",
          "preserveNullAndEmptyArrays": true
        }
      },
      {
        "$unwind": {
          "path": "$boosted.boostSession",
          "preserveNullAndEmptyArrays": true
        }
      },
      {
        "$set": {
          "timeStart": {
            "$dateFromString": {
              "dateString": {
                "$concat": [
                  {
                    "$dateToString": {
                      "format": "%Y-%m-%d",
                      "date": new Date()
                    }
                  },
                  "T",
                  "$boosted.boostSession.timeStart"
                ]
              }
            }
          }
        }
      },
      {
        "$set": {
          "timeEnd": {
            "$dateFromString": {
              "dateString": {
                "$concat": [
                  {
                    "$dateToString": {
                      "format": "%Y-%m-%d",
                      "date": new Date()
                    }
                  },
                  "T",
                  "$boosted.boostSession.timeEnd"
                ]
              }
            }
          }
        }
      },
      {
        $set: {
          "testDate": {
            $add: [new Date(), 25200000]
          }
        }
      },
      {
        $facet:
        {
          //pic
          "pict": [
            {
              $sort: {
                "timeStart": - 1,
                "isBoost": - 1,
                "createdAt": - 1
              }
            },
            {
              $match:
              {
                $or: [
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "pict"
                      },
                      {
                        $expr: {
                          $lte: ["$boosted.boostSession.start", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$boosted.boostSession.end", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $lte: ["$timeStart", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$timeEnd", "$testDate",]
                        }
                      },
                      {

                        "timeStart": {
                          $ne: null
                        }
                      },
                      {

                        "timeEnd": {
                          $ne: null
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: "1@1.com"
                          }
                        }
                      },
                      {
                        $or: [
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": "1@1.com"
                              },
                              {
                                "boosted.boostViewer.isLast": true
                              },
                              {
                                $expr: {
                                  $gt: ["$boosted.boostViewer.timeEnd", "$testDate",]
                                }
                              },

                            ]
                          },
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": {
                                  $ne: "1@1.com"
                                }
                              },

                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "pict"
                      },
                      {
                        "timeStart": null
                      },

                    ]
                  },
                ]
              }
            },
            {
              "$lookup": {
                from: "mediapicts",
                as: "media",
                let: {
                  localID: '$postID'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "apsara": 1,
                      "apsaraId": 1,
                      "apsaraThumbId": 1,
                      "mediaEndpoint": 1,
                      "mediaUri": 1,
                      "mediaThumbEndpoint": 1,
                      "mediaThumbUri": 1,

                    }
                  }
                ],

              },

            },
            {
              "$lookup": {
                from: "interests_repo",
                as: "cats",
                let: {
                  localID: '$category.id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "interestName": 1,
                      "langIso": 1,
                      "icon": 1,
                      "createdAt": 1,
                      "updatedAt": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "insights",
                as: "insight",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "followers": 1,
                      "followings": 1,
                      "unfollows": 1,
                      "likes": 1,
                      "views": 1,
                      "comments": 1,
                      "posts": 1,
                      "shares": 1,
                      "reactions": 1,
                      "views_profile": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "userTag",
                let: {
                  localID: '$tagPeople.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$_id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "username",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userbasics",
                as: "userBasic",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "fullName": 1,
                      "profilePict": 1,
                      "isCelebrity": 1,
                      "isIdVerified": 1,
                      "isPrivate": 1,

                    }
                  }
                ],

              }
            },
            {
              $unwind: {
                path: "$userBasic",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              "$lookup": {
                from: "mediaprofilepicts",
                as: "avatar",
                let: {
                  localID: '$userBasic.profilePict.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$mediaID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "mediaBasePath": 1,
                      "mediaUri": 1,
                      "originalName": 1,
                      "fsSourceUri": 1,
                      "fsSourceName": 1,
                      "fsTargetUri": 1,
                      "mediaType": 1,

                    }
                  }
                ],

              }
            },
            {
              $skip: 0
            },
            {
              $limit: 15
            },
            {
              $unwind: {
                path: "$media",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $unwind: {
                path: "$username",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $project: {
                "testDate": 1,
                "musicId": 1,
                "tagPeople": "$userTag",
                "mediaType": "$media.mediaType",
                "email": 1,
                "postType": 1,
                "description": 1,
                "active": 1,
                "createdAt": 1,
                "updatedAt": 1,
                "expiration": 1,
                "visibility": 1,
                "location": 1,
                "tags": 1,
                "allowComments": 1,
                "isSafe": 1,
                "isOwned": 1,
                "certified": 1,
                "saleAmount": 1,
                "saleLike": 1,
                "saleView": 1,
                "likes": 1,
                "views": 1,
                "shares": 1,
                "userProfile": 1,
                "contentMedias": 1,
                "category": 1,
                "tagDescription": 1,
                "metadata": 1,
                "boostDate": 1,
                "end": "$boosted.boostSession.end",
                "start": "$boosted.boostSession.start",
                "isBoost": 1,
                "boostViewer": 1,
                "boostCount": 1,
                "contentModeration": 1,
                "reportedStatus": 1,
                "reportedUserCount": 1,
                "contentModerationResponse": 1,
                "reportedUser": 1,
                "timeStart": 1,
                "timeEnd": 1,
                "apsara": "$media.apsara",
                "apsaraId": "$media.apsaraId",
                "apsaraThumbId": "$media.apsaraThumbId",
                "mediaEndpoint": "$media.mediaEndpoint",
                "mediaUri": "$media.mediaUri",
                "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
                "mediaThumbUri": "$media.mediaThumbUri",
                "cats": 1,
                "insight": 1,
                "fullName": "$userBasic.fullName",
                "username": "$username.username",
                "avatar": 1,
                "privacy": [{
                  "isCelebrity": "$userBasic.isCelebrity"
                }, {
                  "isIdVerified": "$userBasic.isIdVerified"
                }, {
                  "isPrivate": "$userBasic.isPrivate"
                }]
              }
            }
          ],

          //video
          "video": [
            {
              $sort: {
                "timeStart": - 1,
                "isBoost": - 1,
                "createdAt": - 1
              }
            },
            {
              $match:
              {
                $or: [
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "vid"
                      },
                      {
                        $expr: {
                          $lte: ["$boosted.boostSession.start", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$boosted.boostSession.end", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $lte: ["$timeStart", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$timeEnd", "$testDate",]
                        }
                      },
                      {

                        "timeStart": {
                          $ne: null
                        }
                      },
                      {

                        "timeEnd": {
                          $ne: null
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: "1@1.com"
                          }
                        }
                      },
                      {
                        $or: [
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": "1@1.com"
                              },
                              {
                                "boosted.boostViewer.isLast": true
                              },
                              {
                                $expr: {
                                  $gt: ["$boosted.boostViewer.timeEnd", "$testDate",]
                                }
                              },

                            ]
                          },
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": {
                                  $ne: "1@1.com"
                                }
                              },

                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "vid"
                      },
                      {
                        "timeStart": null
                      },

                    ]
                  },
                ]
              }
            },
            {
              "$lookup": {
                from: "mediavideos",
                as: "media",
                let: {
                  localID: '$postID'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "apsara": 1,
                      "apsaraId": 1,
                      "apsaraThumbId": 1,
                      "mediaEndpoint": 1,
                      "mediaUri": 1,
                      "mediaThumbEndpoint": 1,
                      "mediaThumbUri": 1,

                    }
                  }
                ],

              },

            },
            {
              "$lookup": {
                from: "interests_repo",
                as: "cats",
                let: {
                  localID: '$category.id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "interestName": 1,
                      "langIso": 1,
                      "icon": 1,
                      "createdAt": 1,
                      "updatedAt": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "insights",
                as: "insight",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "followers": 1,
                      "followings": 1,
                      "unfollows": 1,
                      "likes": 1,
                      "views": 1,
                      "comments": 1,
                      "posts": 1,
                      "shares": 1,
                      "reactions": 1,
                      "views_profile": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "userTag",
                let: {
                  localID: '$tagPeople.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$_id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "username",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userbasics",
                as: "userBasic",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "fullName": 1,
                      "profilePict": 1,
                      "isCelebrity": 1,
                      "isIdVerified": 1,
                      "isPrivate": 1,

                    }
                  }
                ],

              }
            },
            {
              $unwind: {
                path: "$userBasic",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              "$lookup": {
                from: "mediaprofilepicts",
                as: "avatar",
                let: {
                  localID: '$userBasic.profilePict.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$mediaID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "mediaBasePath": 1,
                      "mediaUri": 1,
                      "originalName": 1,
                      "fsSourceUri": 1,
                      "fsSourceName": 1,
                      "fsTargetUri": 1,
                      "mediaType": 1,

                    }
                  }
                ],

              }
            },
            {
              $skip: 0
            },
            {
              $limit: 15
            },
            {
              $unwind: {
                path: "$media",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $unwind: {
                path: "$username",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $project: {
                "testDate": 1,
                "musicId": 1,
                "tagPeople": "$userTag",
                "mediaType": "$media.mediaType",
                "email": 1,
                "postType": 1,
                "description": 1,
                "active": 1,
                "createdAt": 1,
                "updatedAt": 1,
                "expiration": 1,
                "visibility": 1,
                "location": 1,
                "tags": 1,
                "allowComments": 1,
                "isSafe": 1,
                "isOwned": 1,
                "certified": 1,
                "saleAmount": 1,
                "saleLike": 1,
                "saleView": 1,
                "likes": 1,
                "views": 1,
                "shares": 1,
                "userProfile": 1,
                "contentMedias": 1,
                "category": 1,
                "tagDescription": 1,
                "metadata": 1,
                "boostDate": 1,
                "end": "$boosted.boostSession.end",
                "start": "$boosted.boostSession.start",
                "isBoost": 1,
                "boostViewer": 1,
                "boostCount": 1,
                "contentModeration": 1,
                "reportedStatus": 1,
                "reportedUserCount": 1,
                "contentModerationResponse": 1,
                "reportedUser": 1,
                "timeStart": 1,
                "timeEnd": 1,
                "apsara": "$media.apsara",
                "apsaraId": "$media.apsaraId",
                "apsaraThumbId": "$media.apsaraThumbId",
                "mediaEndpoint": "$media.mediaEndpoint",
                "mediaUri": "$media.mediaUri",
                "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
                "mediaThumbUri": "$media.mediaThumbUri",
                "cats": 1,
                "insight": 1,
                "fullName": "$userBasic.fullName",
                "username": "$username.username",
                "avatar": 1,
                "privacy": [{
                  "isCelebrity": "$userBasic.isCelebrity"
                }, {
                  "isIdVerified": "$userBasic.isIdVerified"
                }, {
                  "isPrivate": "$userBasic.isPrivate"
                }]
              }
            }
          ],

          //diary
          "diary": [
            {
              $sort: {
                "timeStart": - 1,
                "isBoost": - 1,
                "createdAt": - 1
              }
            },
            {
              $match:
              {
                $or: [
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "diary"
                      },
                      {
                        $expr: {
                          $lte: ["$boosted.boostSession.start", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$boosted.boostSession.end", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $lte: ["$timeStart", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$timeEnd", "$testDate",]
                        }
                      },
                      {

                        "timeStart": {
                          $ne: null
                        }
                      },
                      {

                        "timeEnd": {
                          $ne: null
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: "1@1.com"
                          }
                        }
                      },
                      {
                        $or: [
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": "1@1.com"
                              },
                              {
                                "boosted.boostViewer.isLast": true
                              },
                              {
                                $expr: {
                                  $gt: ["$boosted.boostViewer.timeEnd", "$testDate",]
                                }
                              },

                            ]
                          },
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": {
                                  $ne: "1@1.com"
                                }
                              },

                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "diary"
                      },
                      {
                        "timeStart": null
                      },

                    ]
                  },
                ]
              }
            },
            {
              "$lookup": {
                from: "mediadiaries",
                as: "media",
                let: {
                  localID: '$postID'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "apsara": 1,
                      "apsaraId": 1,
                      "apsaraThumbId": 1,
                      "mediaEndpoint": 1,
                      "mediaUri": 1,
                      "mediaThumbEndpoint": 1,
                      "mediaThumbUri": 1,

                    }
                  }
                ],

              },

            },
            {
              "$lookup": {
                from: "interests_repo",
                as: "cats",
                let: {
                  localID: '$category.id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "interestName": 1,
                      "langIso": 1,
                      "icon": 1,
                      "createdAt": 1,
                      "updatedAt": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "insights",
                as: "insight",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "followers": 1,
                      "followings": 1,
                      "unfollows": 1,
                      "likes": 1,
                      "views": 1,
                      "comments": 1,
                      "posts": 1,
                      "shares": 1,
                      "reactions": 1,
                      "views_profile": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "userTag",
                let: {
                  localID: '$tagPeople.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$_id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "username",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userbasics",
                as: "userBasic",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "fullName": 1,
                      "profilePict": 1,
                      "isCelebrity": 1,
                      "isIdVerified": 1,
                      "isPrivate": 1,

                    }
                  }
                ],

              }
            },
            {
              $unwind: {
                path: "$userBasic",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              "$lookup": {
                from: "mediaprofilepicts",
                as: "avatar",
                let: {
                  localID: '$userBasic.profilePict.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$mediaID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "mediaBasePath": 1,
                      "mediaUri": 1,
                      "originalName": 1,
                      "fsSourceUri": 1,
                      "fsSourceName": 1,
                      "fsTargetUri": 1,
                      "mediaType": 1,

                    }
                  }
                ],

              }
            },
            {
              $skip: 0
            },
            {
              $limit: 15
            },
            {
              $unwind: {
                path: "$media",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $unwind: {
                path: "$username",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $project: {
                "testDate": 1,
                "musicId": 1,
                "tagPeople": "$userTag",
                "mediaType": "$media.mediaType",
                "email": 1,
                "postType": 1,
                "description": 1,
                "active": 1,
                "createdAt": 1,
                "updatedAt": 1,
                "expiration": 1,
                "visibility": 1,
                "location": 1,
                "tags": 1,
                "allowComments": 1,
                "isSafe": 1,
                "isOwned": 1,
                "certified": 1,
                "saleAmount": 1,
                "saleLike": 1,
                "saleView": 1,
                "likes": 1,
                "views": 1,
                "shares": 1,
                "userProfile": 1,
                "contentMedias": 1,
                "category": 1,
                "tagDescription": 1,
                "metadata": 1,
                "boostDate": 1,
                "end": "$boosted.boostSession.end",
                "start": "$boosted.boostSession.start",
                "isBoost": 1,
                "boostViewer": 1,
                "boostCount": 1,
                "contentModeration": 1,
                "reportedStatus": 1,
                "reportedUserCount": 1,
                "contentModerationResponse": 1,
                "reportedUser": 1,
                "timeStart": 1,
                "timeEnd": 1,
                "apsara": "$media.apsara",
                "apsaraId": "$media.apsaraId",
                "apsaraThumbId": "$media.apsaraThumbId",
                "mediaEndpoint": "$media.mediaEndpoint",
                "mediaUri": "$media.mediaUri",
                "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
                "mediaThumbUri": "$media.mediaThumbUri",
                "cats": 1,
                "insight": 1,
                "fullName": "$userBasic.fullName",
                "username": "$username.username",
                "avatar": 1,
                "privacy": [{
                  "isCelebrity": "$userBasic.isCelebrity"
                }, {
                  "isIdVerified": "$userBasic.isIdVerified"
                }, {
                  "isPrivate": "$userBasic.isPrivate"
                }]
              }
            }
          ],

          //story
          "story": [
            {
              $sort: {
                "timeStart": - 1,
                "isBoost": - 1,
                "createdAt": - 1
              }
            },
            {
              $match:
              {
                $or: [
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "story"
                      },
                      {
                        $expr: {
                          $lte: ["$boosted.boostSession.start", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$boosted.boostSession.end", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $lte: ["$timeStart", "$testDate",]
                        }
                      },
                      {
                        $expr: {
                          $gt: ["$timeEnd", "$testDate",]
                        }
                      },
                      {

                        "timeStart": {
                          $ne: null
                        }
                      },
                      {

                        "timeEnd": {
                          $ne: null
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: "1@1.com"
                          }
                        }
                      },
                      {
                        $or: [
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": "1@1.com"
                              },
                              {
                                "boosted.boostViewer.isLast": true
                              },
                              {
                                $expr: {
                                  $gt: ["$boosted.boostViewer.timeEnd", "$testDate",]
                                }
                              },

                            ]
                          },
                          {
                            $and: [
                              {
                                "boosted.boostViewer.email": {
                                  $ne: "1@1.com"
                                }
                              },

                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    $and: [
                      {
                        $or: [
                          {
                            "reportedStatus": "ALL"
                          },
                          {
                            "reportedStatus": null
                          },

                        ]
                      },
                      {
                        "visibility": "PUBLIC"
                      },
                      {
                        "active": true
                      },
                      {
                        "postType": "story"
                      },
                      {
                        "timeStart": null
                      },

                    ]
                  },
                ]
              }
            },
            {
              "$lookup": {
                from: "mediastories",
                as: "media",
                let: {
                  localID: '$postID'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "apsara": 1,
                      "apsaraId": 1,
                      "apsaraThumbId": 1,
                      "mediaEndpoint": 1,
                      "mediaUri": 1,
                      "mediaThumbEndpoint": 1,
                      "mediaThumbUri": 1,

                    }
                  }
                ],

              },

            },
            {
              "$lookup": {
                from: "interests_repo",
                as: "cats",
                let: {
                  localID: '$category.id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "interestName": 1,
                      "langIso": 1,
                      "icon": 1,
                      "createdAt": 1,
                      "updatedAt": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "insights",
                as: "insight",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "followers": 1,
                      "followings": 1,
                      "unfollows": 1,
                      "likes": 1,
                      "views": 1,
                      "comments": 1,
                      "posts": 1,
                      "shares": 1,
                      "reactions": 1,
                      "views_profile": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "userTag",
                let: {
                  localID: '$tagPeople.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$_id', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userauths",
                as: "username",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {

                      "username": 1
                    }
                  }
                ],

              }
            },
            {
              "$lookup": {
                from: "userbasics",
                as: "userBasic",
                let: {
                  localID: '$email'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$email', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "fullName": 1,
                      "profilePict": 1,
                      "isCelebrity": 1,
                      "isIdVerified": 1,
                      "isPrivate": 1,

                    }
                  }
                ],

              }
            },
            {
              $unwind: {
                path: "$userBasic",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              "$lookup": {
                from: "mediaprofilepicts",
                as: "avatar",
                let: {
                  localID: '$userBasic.profilePict.$id'
                },
                pipeline: [
                  {
                    $match:
                    {


                      $expr: {
                        $eq: ['$mediaID', '$$localID']
                      }
                    }
                  },
                  {
                    $project: {
                      "mediaBasePath": 1,
                      "mediaUri": 1,
                      "originalName": 1,
                      "fsSourceUri": 1,
                      "fsSourceName": 1,
                      "fsTargetUri": 1,
                      "mediaType": 1,

                    }
                  }
                ],

              }
            },
            {
              $skip: 0
            },
            {
              $limit: 15
            },
            {
              $unwind: {
                path: "$media",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $unwind: {
                path: "$username",
                preserveNullAndEmptyArrays: true
              }
            },
            {
              $project: {
                "testDate": 1,
                "musicId": 1,
                "tagPeople": "$userTag",
                "mediaType": "$media.mediaType",
                "email": 1,
                "postType": 1,
                "description": 1,
                "active": 1,
                "createdAt": 1,
                "updatedAt": 1,
                "expiration": 1,
                "visibility": 1,
                "location": 1,
                "tags": 1,
                "allowComments": 1,
                "isSafe": 1,
                "isOwned": 1,
                "certified": 1,
                "saleAmount": 1,
                "saleLike": 1,
                "saleView": 1,
                "likes": 1,
                "views": 1,
                "shares": 1,
                "userProfile": 1,
                "contentMedias": 1,
                "category": 1,
                "tagDescription": 1,
                "metadata": 1,
                "boostDate": 1,
                "end": "$boosted.boostSession.end",
                "start": "$boosted.boostSession.start",
                "isBoost": 1,
                "boostViewer": 1,
                "boostCount": 1,
                "contentModeration": 1,
                "reportedStatus": 1,
                "reportedUserCount": 1,
                "contentModerationResponse": 1,
                "reportedUser": 1,
                "timeStart": 1,
                "timeEnd": 1,
                "apsara": "$media.apsara",
                "apsaraId": "$media.apsaraId",
                "apsaraThumbId": "$media.apsaraThumbId",
                "mediaEndpoint": "$media.mediaEndpoint",
                "mediaUri": "$media.mediaUri",
                "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
                "mediaThumbUri": "$media.mediaThumbUri",
                "cats": 1,
                "insight": 1,
                "fullName": "$userBasic.fullName",
                "username": "$username.username",
                "avatar": 1,
                "privacy": [{
                  "isCelebrity": "$userBasic.isCelebrity"
                }, {
                  "isIdVerified": "$userBasic.isIdVerified"
                }, {
                  "isPrivate": "$userBasic.isPrivate"
                }]
              }
            }
          ],

        }
      },
    ]);

    return query;
  }

  async finddatasearchconten(key: string, email: string, skip: number, limit: number, pict: any, vid: any, diary: any, user: any) {
    var pipeline = [];

    pipeline.push({
      $project: {
        "dedy": key
      }
    },
      {
        $limit: 1
      },);

    if (pict === true && vid === false && diary === false && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === false && vid === true && diary === false && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "certified": 1,
                          "isLiked": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === false && vid === false && diary === true && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },

                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$mediaUri"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email
                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === true && vid === true && diary === false && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "certified": 1,
                          "isLiked": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],


          },

        },);

    }
    else if (pict === true && vid === false && diary === true && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },

                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$mediaUri"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email
                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },);
    }
    else if (pict === false && vid === true && diary === true && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "certified": 1,
                          "isLiked": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },

                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$mediaUri"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email
                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === true && vid === true && diary === true && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "certified": 1,
                          "isLiked": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },

                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$mediaUri"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email
                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === false && vid === false && diary === false && user === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match: {
                          $expr: {
                            $regexMatch: {
                              input: "$username",
                              regex: "$$name",
                              options: "i"
                            }
                          }
                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },
                      {
                        $skip: skip
                      },
                      {
                        $limit: limit
                      },

                    ],

                  }
                },
                //{
                //    $group: {
                //					_id:{
                //				"fullName": "$userBasic.fullname",
                //        "profilePict": "$userBasic.profilePict",
                //        "username": "$userAuth.username",
                //        "email": "$userAuth.email",
                //        "avatar": "$avatar"}
                //        //"idUserAuth": "$userAuth._id",
                //    }
                //},
                {
                  $project: {
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "username": "$userAuth.username",
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },
                    //"idUserAuth": "$userAuth._id",
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },);
    }
    else if (pict === false && vid === true && diary === false && user === false) {
      pipeline.push(

        {
          $facet:
          {

            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "certified": 1,
                          "isLiked": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === true && vid === false && diary === false && user === false) {
      pipeline.push(

        {
          $facet:
          {
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/pict/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email,

                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },);
    }
    else if (pict === false && vid === false && diary === true && user === false) {
      pipeline.push(

        {
          $facet:
          {

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $regexMatch: {
                                  input: "$description",
                                  regex: "$$name",
                                  options: "i"
                                }
                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          "boosted":
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  "$dateToString": {
                                    "format": "%Y-%m-%d %H:%M:%S",
                                    "date": {
                                      $add: [new Date(), 25200000]
                                    }
                                  }
                                }, "$boosted.boostSession.timeEnd"]
                              },
                              then: [],
                              else: '$boosted'
                            }
                          },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,

                        }
                      },
                      {
                        $lookup: {
                          from: 'userauths',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'authdata',

                        }
                      },
                      {
                        $lookup: {
                          from: 'userbasics',
                          localField: 'email',
                          foreignField: 'email',
                          as: 'basicdata',

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": {
                            $arrayElemAt: ['$authdata.username', 0]
                          },
                          'profilepictid': {
                            $arrayElemAt: ['$basicdata.profilePict.$id', 0]
                          },

                        }
                      },
                      {
                        $lookup: {
                          from: 'mediaprofilepicts',
                          localField: 'profilepictid',
                          foreignField: '_id',
                          as: 'avatar',

                        }
                      },
                      {
                        $unwind: {
                          path: "$avatar",

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "profilepictid": 1,
                          "avatar": {

                            mediaEndpoint: {
                              "$concat": ["/profilepict/", "$avatar.mediaID"]
                            },

                          },

                        }
                      },
                      {
                        $project: {
                          "boosted": 1,
                          "reportedStatus": 1,
                          "insight": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "certified": 1,
                          "username": 1,
                          "avatar": 1,

                        }
                      },

                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$mediaUri"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "likes",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$postID', '$$localID']
                              }
                            },
                            {
                              "email": email
                            },
                            {
                              "eventType": "LIKE"
                            }
                          ]
                        }
                      },

                    ],

                  },

                },
                {
                  $project: {
                    "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "certified": "$pict.certified",
                    "username": "$pict.username",
                    "avatar": "$pict.avatar",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isLiked":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$likes.eventType", {
                              "$indexOfArray": [
                                "$likes.postID",
                                "$pict.postID"
                              ]
                            }]
                          }, "LIKE"]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },);
    }

    const query = await this.PostsModel.aggregate(pipeline);
    return query;
  }
  async thum(thum_data: string): Promise<any> {
    var data = await this.seaweedfsService.read(thum_data.replace('/localrepo', ''));
    return data;
  }
  async pict(media: string): Promise<any> {
    var data = await this.seaweedfsService.read(media.replace('/localrepo', ''));
    return data;
  }

  async stream(mediaFile: string): Promise<any> {
    console.log(mediaFile);
    var data = await this.seaweedfsService.read("/" + mediaFile);
    return data;
  }

  async streamV2(mediaFile: string): Promise<any> {
    console.log(mediaFile);
    var data = await this.seaweedfsService.read("/" + mediaFile);
    return data;
  }

  async updateActive(id: string, updatedAt: string, remark: string) {
    let data = await this.PostsModel.updateMany({ "_id": id },

      { $set: { "active": false, "updatedAt": updatedAt, "reportedUserHandle.$[].remark": remark, "reportedUserHandle.$[].status": "DELETE", "reportedUserHandle.$[].updatedAt": updatedAt } });
    return data;
  }

  async updateActiveEmpty(id: string, updatedAt: string, reportedUserHandle: any[]) {
    let data = await this.PostsModel.updateMany({ "_id": id },

      { $set: { "active": false, "updatedAt": updatedAt, "reportedUserHandle": reportedUserHandle } });
    return data;
  }

  async updateDitangguhkan(id: string, reason: string, updatedAt: string, reasonId: ObjectId) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "OWNED", "updatedAt": updatedAt, "reportedUserHandle.$[].reasonId": reasonId, "reportedUserHandle.$[].reasonAdmin": reason, "reportedUserHandle.$[].status": "DITANGGUHKAN", "reportedUserHandle.$[].updatedAt": updatedAt } });
    return data;
  }

  async updateDitangguhkanEmpty(id: string, updatedAt: string, reportedUserHandle: any[]) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "OWNED", "updatedAt": updatedAt, "reportedUserHandle": reportedUserHandle } });
    return data;
  }

  async updateStatusOwned(id: string, updatedAt: string) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "OWNED", "updatedAt": updatedAt, "reportedUserHandle.$[].status": "DITANGGUHKAN", "reportedUserHandle.$[].updatedAt": updatedAt } });
    return data;
  }

  async updateFlaging(id: string, updatedAt: string) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "BLURRED", "updatedAt": updatedAt, "reportedUserHandle.$[].status": "FLAGING", "reportedUserHandle.$[].updatedAt": updatedAt } });
    return data;
  }
  async updateFlagingEmpty(id: string, updatedAt: string, reportedUserHandle: any[]) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "BLURRED", "updatedAt": updatedAt, "reportedUserHandle": reportedUserHandle } });
    return data;
  }

  async updateTidakditangguhkan(id: string, updatedAt: string) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "ALL", "updatedAt": updatedAt, "reportedUserCount": 0, "reportedUserHandle.$[].status": "TIDAK DITANGGUHKAN", "reportedUserHandle.$[].updatedAt": updatedAt } });
    return data;
  }

  async updateTidakditangguhkanEmpty(id: string, updatedAt: string, reportedUserHandle: any[]) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      { $set: { "reportedStatus": "ALL", "updatedAt": updatedAt, "reportedUserCount": 0, "reportedUserHandle": reportedUserHandle } });
    return data;
  }

  async nonactive(id: string, updatedAt: string) {
    let data = await this.PostsModel.updateMany({ "_id": id },
      {
        $set: {
          "reportedUser.$[].active": false, "reportedUser.$[].updatedAt": updatedAt
        }


      });
    return data;
  }

  async find200(): Promise<Posts[]> {
    return this.PostsModel.find({ reportedUserCount: { $gte: 200 } }).exec();
  }

  async updateBoostViewer(id: string, email: string) {
    this.PostsModel.findOne({ _id: id }).exec().then((ps) => {
      console.log("post boost: " + ps.postID);
      let bs = ps.boosted;
      if (bs != undefined) {
        for (let i = 0; i < bs.length; i++) {
          let bbs = bs[i];
          if (bbs.boostSession != undefined) {
            let bootSession = bbs.boostSession;
            let today = new Date().getTime();
            let st = new Date(String(bootSession.start)).getTime();
            let ed = new Date(String(bootSession.end)).getTime();

            if (st <= today && ed >= today) {
              let interval = Number(bbs.boostInterval.value);
              interval = interval * 60 * 1000;
              let a = (today - st);
              console.log("today: " + a + " interval: " + interval);
              let c = Math.ceil(a / interval);
              console.log("round today: " + c);
              let d = st + (interval * c);

              //let ted = d + (7 * 3600 * 1000);
              let ted = d;

              let td = new Date(ted);
              let stoday = new Date(td.getTime() - (td.getTimezoneOffset() * 60000)).toISOString().replace('T', ' ');
              stoday = stoday.substring(0, 19);
              console.log(st + " " + d + " " + ted + " " + stoday);

              let tdx = new Date(today);
              let xtoday = new Date(tdx.getTime() - (tdx.getTimezoneOffset() * 60000)).toISOString().replace('T', ' ');
              xtoday = xtoday.substring(0, 19);

              let bv: any[] = bbs.boostViewer;
              if (bv != undefined) {
                if (bv.length > 0) {
                  for (let x = 0; x < bv.length; x++) {
                    let bbv = bv[x];
                    if (String(bbv.email) == email) {
                      if (bbv.isLast == true) {
                        bbv.isLast = false;
                      }
                    }
                  }

                  let o = {
                    email: email,
                    createAt: xtoday,
                    timeEnd: stoday,
                    isLast: true
                  };

                  bv.push(o);
                } else {
                  let o = {
                    email: email,
                    createAt: xtoday,
                    timeEnd: stoday,
                    isLast: true
                  };

                  bv.push(o);
                }
              }
            }
          }

        }

        console.log(JSON.stringify(bs));

        this.PostsModel.updateOne(
          {
            "_id": id,
          },
          {
            $set: {
              "boosted": bs
            }
          },
          function (err, docs) {
            if (err) {
              console.log(err);
            } else {
              console.log(docs);
            }
          }
        );
      }

    });
  }

  async isLike(email: string, postID: string) {
    let query = await this.contentEventService.findisLike(email, postID);
    return query;
  }

  async getPostByDate(startdate: string) {
    var before = new Date(startdate).toISOString().split("T")[0];
    var input = new Date();
    input.setDate(input.getDate() + 1);
    var today = new Date(input).toISOString().split("T")[0];
    //kalo error, coba ganti jadi set dan jadi object
    var query = await this.PostsModel.aggregate([
      {
        "$match":
        {
          createdAt:
          {
            "$gte": before,
            "$lte": today
          },
        }
      },
      {
        "$project":
        {
          createdAt:
          {
            "$substr":
              [
                "$createdAt", 0, 10
              ]
          }
        }
      },
      {
        "$group":
        {
          _id:
          {
            "$dateFromString":
            {
              "format": "%Y-%m-%d",
              "dateString": "$createdAt"

            }
          },
          totalperhari:
          {
            "$sum": 1
          }
        }
      },
      {
        "$project":
        {
          _id: 1,
          totalperhari: 1
        }
      },
      {
        "$unwind":
        {
          path: "$_id"
        }
      },
      {
        "$sort":
        {
          _id: 1
        }
      },
      {
        "$group":
        {
          _id: null,
          total:
          {
            "$sum": "$totalperhari"
          },
          resultdata:
          {
            "$push":
            {
              _id:
              {
                "$substr":
                  [
                    {
                      "$toString": "$_id"
                    }, 0, 10
                  ]
              },
              totaldata: "$totalperhari"
            }
          }
        }
      }
    ]);

    return query;
  }

  async getAllSertifikasiChart() {
    var query = await this.PostsModel.aggregate([
      {
        "$project":
        {
          certified:
          {
            "$ifNull":
              [
                "$certified", false
              ]
          }
        }
      },
      {
        "$group":
        {
          _id: "$certified",
          totaldata:
          {
            "$sum": 1
          },
        }
      },
      {
        "$project":
        {
          _id:
          {
            "$cond":
            {
              if:
              {
                "$eq": ["$_id", true]
              },
              then: "BERSERTIFIKAT",
              else: "TIDAK BERSERTIFIKAT"
            }
          },
          totaldata: 1
        }
      },
      {
        "$unwind":
        {
          path: "$_id"
        }
      },
      {
        "$group":
        {
          _id: null,
          totaldata:
          {
            "$sum": "$totaldata"
          },
          resultdata:
          {
            "$push":
            {
              _id: "$_id",
              total: "$totaldata"
            }
          }
        }
      },
      {
        "$unwind":
        {
          path: "$resultdata"
        }
      },
      {
        "$group":
        {
          _id: null,
          data:
          {
            "$push":
            {
              id: "$resultdata._id",
              total: "$resultdata.total",
              persentase:
              {
                $multiply:
                  [
                    {
                      $divide:
                        [
                          "$resultdata.total", "$totaldata"
                        ]
                    }, 100
                  ]
              }
            }
          }
        }
      }
    ]);

    return query;
  }

  async analiticPost(startdate: string, enddate: string) {
    try {
      var currentdate = new Date(new Date(enddate).setDate(new Date(enddate).getDate() + 1));

      var dateend = currentdate.toISOString();

      var dt = dateend.substring(0, 10);
    } catch (e) {
      dt = "";
    }
    var query = await this.PostsModel.aggregate(
      [
        {
          "$match":
          {
            createdAt:
            {
              "$gte": startdate,
              "$lte": dt
            },
            postType:
            {
              "$in": ["pict", "vid", "diary", "story"]
            }
          }
        },
        {
          "$project":
          {
            createdAt:
            {
              "$substr":
                [
                  "$createdAt", 0, 10
                ]
            },
            postType: 1
          }
        },

        {
          "$group":
          {
            _id: "$createdAt",
            pict:
            {
              "$sum":
              {
                "$switch":
                {
                  branches:
                    [
                      {
                        "case":
                        {
                          "$eq": ["$postType", "pict"]
                        },
                        "then": 1
                      }
                    ],
                  "default": 0
                }
              }
            },
            vid:
            {
              "$sum":
              {
                "$switch":
                {
                  branches:
                    [
                      {
                        "case":
                        {
                          "$eq": ["$postType", "vid"]
                        },
                        "then": 1
                      }
                    ],
                  "default": 0
                }
              }
            },
            story:
            {
              "$sum":
              {
                "$switch":
                {
                  branches:
                    [
                      {
                        "case":
                        {
                          "$eq": ["$postType", "story"]
                        },
                        "then": 1
                      }
                    ],
                  "default": 0
                }
              }
            },
            diary:
            {
              "$sum":
              {
                "$switch":
                {
                  branches:
                    [
                      {
                        "case":
                        {
                          "$eq": ["$postType", "diary"]
                        },
                        "then": 1
                      }
                    ],
                  "default": 0
                }
              }
            },
          }
        },

        {
          $project: {
            _id: 0,
            date: "$_id",
            diary: "$diary",
            pict: "$pict",
            vid: "$vid",
            story: "$story"
          }
        },

        {
          "$sort":
          {
            date: 1
          }
        }
      ]
    );
    return query;

  }

  async analitycview(startdate: string, enddate: string) {
    try {
      var currentdate = new Date(new Date(enddate).setDate(new Date(enddate).getDate() + 1));

      var dateend = currentdate.toISOString();

      var dt = dateend.substring(0, 10);
    } catch (e) {
      dt = "";
    }
    var query = await this.PostsModel.aggregate([
      {
        "$match":
        {
          createdAt: {
            $gte: startdate,
            $lte: dt

          }

        }
      },
      {
        "$project":
        {
          createdAt:
          {
            "$substr":
              [
                "$createdAt",
                0,
                10
              ]
          },
          views: 1,
          likes: 1,
          comments: 1
        }
      },
      {
        "$group":
        {
          _id: "$createdAt",
          views:
          {
            "$sum": "$views"

          },
          likes:
          {
            "$sum": "$likes"

          },
          comments:
          {
            "$sum": "$comments"

          },

        }
      },
      {
        $project: {
          _id: 0,
          date: "$_id",
          views: "$views",
          likes: "$likes",
          comments: "$comments"
        }
      },
      {
        "$sort":
        {
          date: 1
        }
      }
    ]);
    return query;
  }

  async createInterestCollection() {
    var query = await this.PostsModel.aggregate([
      {
        "$unwind":
        {
          path: "$category",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        "$match":
        {
          "$and":
            [
              {
                category:
                {
                  "$ne": ""
                }
              },
              {
                category:
                {
                  "$ne": null
                }
              },
            ]
        }
      },
      {
        "$project":
        {
          _id: 1,
          category: 1,
          categoryId: "$category.$id",
          postID: 1,
        }
      },
      {
        "$group":
        {
          _id: "$category.$id",
          total:
          {
            "$sum": 1
          },
          listdata:
          {
            "$push":
            {
              postID: "$_id"
            }
          }
        }
      },
      {
        "$sort":
        {
          _id: 1
        }
      },
      // coba coba
      {
        $out:
        {
          db: 'ProdAll',
          coll: 'interest_count'
        }
      },
    ]);

    return true;
  }

  async createTagsCollection() {
    var query = await this.PostsModel.aggregate([
      {
        "$unwind":
        {
          path: "$tags",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $set:
        {
          "converttags":
          {
            "$replaceAll":
            {
              input: "$tags",
              find: "#",
              replacement: ""
            },
          },
        }
      },
      {
        "$project":
        {
          _id: 1,
          tags:
          {
            "$toLower": "$tags"
          },
          converttags:
          {
            "$toLower": "$converttags"
          },
          postID: 1,
        }
      },
      {
        "$match":
        {
          "$and":
            [
              {
                converttags:
                {
                  "$ne": ""
                }
              },
              {
                converttags:
                {
                  "$ne": null
                }
              },
            ]
        }
      },
      {
        "$set":
        {
          finalconvert:
          {
            "$replaceAll":
            {
              input: "$converttags",
              find: '"',
              replacement: ""
            },
          },
        }
      },
      {
        "$project":
        {
          _id: 1,
          tags:
          {
            "$toLower": "$tags"
          },
          converttags2: "$finalconvert",
          postID: 1,
        }
      },
      {
        "$project":
        {
          _id: 1,
          postID: 1,
          converttags2: 1
        }
      },
      {
        "$sort":
        {
          converttags2: 1
        }
      },
      {
        "$group":
        {
          _id: "$converttags2",
          total:
          {
            "$sum": 1
          },
          listdata:
          {
            "$push":
            {
              postID: "$postID"
            }
          }
        }
      },
      {
        "$sort":
        {
          _id: 1
        }
      },
      // coba coba
      {
        $out:
        {
          db: 'ProdAll',
          coll: 'tag_count'
        }
      },
    ]);

    return true;
  }

  async finddatasearchcontenNew(key: string, email: string, skip: number, limit: number, pict: any, vid: any, diary: any, user: any, tag: any) {


    var pipeline = [];

    pipeline.push({
      $project: {
        "dedy": key
      }
    },
      {
        $limit: 1
      },);

    if (pict === true && vid === false && diary === false && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",

          }
        });
    }
    else if (pict === false && vid === true && diary === false && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            vid: "$vid",

          }
        });
    }
    else if (pict === false && vid === false && diary === true && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            diary: "$diary"
          }
        });
    }
    else if (pict === true && vid === true && diary === false && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            vid: "$vid",

          }
        });

    }
    else if (pict === true && vid === false && diary === true && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            diary: "$diary",

          }
        });
    }
    else if (pict === false && vid === true && diary === true && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            vid: "$vid",
            diary: "$diary",

          }
        });
    }
    else if (pict === true && vid === true && diary === true && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            vid: "$vid",
            diary: "$diary",

          }
        });
    }
    else if (pict === false && vid === false && diary === false && user === true && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
          }
        });
    }
    else if (pict === false && vid === true && diary === false && user === false && tag === false) {
      pipeline.push(

        {
          $facet:
          {

            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {

            vid: "$vid",

          }
        });
    }
    else if (pict === true && vid === false && diary === false && user === false && tag === false) {
      pipeline.push(

        {
          $facet:
          {
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

          },

        },
        {
          $project: {

            pict: "$pict"
          }
        });
    }
    else if (pict === false && vid === false && diary === true && user === false && tag === false) {
      pipeline.push(

        {
          $facet:
          {

            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {

            diary: "$diary",

          }
        });
    }
    else if (pict === false && vid === false && diary === false && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }

    else if (pict === false && vid === false && diary === false && user === true && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },
          }
        });
    }
    else if (pict === false && vid === false && diary === true && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === false && vid === true && diary === false && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            vid: "$vid",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === false && diary === false && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            pict: "$pict",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === true && diary === false && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            pict: "$pict",
            vid: "$vid",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === true && diary === true && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            pict: "$pict",
            vid: "$vid",
            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === false && diary === true && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            pict: "$pict",
            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === false && diary === false && user === true && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },
          }
        });
    }

    else if (pict === true && vid === true && diary === false && user === true && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            vid: "$vid",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === false && vid === true && diary === true && user === true && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],

            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            vid: "$vid",
            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === true && diary === true && user === false && tag === true) {
      pipeline.push(

        {
          $facet:
          {

            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {

            pict: "$pict",
            vid: "$vid",
            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === true && diary === true && user === true && tag === true) {
      pipeline.push(

        {
          $facet:
          {
            "user":
              [

                {
                  $lookup: {
                    from: "userauths",
                    pipeline: [
                      {
                        $match:
                        {
                          "username": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$username", key]
                          }
                        }
                      },
                      {
                        $set: {
                          length:
                          {
                            $cond: [
                              {
                                ifnull: ['$username', false]
                              },
                              {
                                $strLenCP: "$username"
                              },
                              0
                            ]
                          },

                        }
                      }
                    ],
                    as: "userAuth"
                  },

                },
                {
                  $unwind: {
                    path: "$userAuth",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "userbasics",
                    as: "userBasic",
                    let: {
                      localID: '$userAuth.email'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "fullName": 1,
                          "profilePict": 1,
                          "isCelebrity": 1,
                          "isIdVerified": 1,
                          "isPrivate": 1,

                        },

                      }
                    ]
                  },

                },
                {
                  $unwind: {
                    path: "$userBasic",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediaprofilepicts",
                    as: "avatar",
                    let: {
                      localID: '$userBasic.profilePict.$id'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$mediaID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {
                          "mediaBasePath": 1,
                          "mediaUri": 1,
                          "originalName": 1,
                          "fsSourceUri": 1,
                          "fsSourceName": 1,
                          "fsTargetUri": 1,
                          "mediaType": 1,
                          "mediaEndpoint": {
                            "$concat": ["/profilepict/", "$mediaUri"]
                          }
                        }
                      },

                    ],

                  }
                },
                {
                  "$lookup": {
                    from: "friend_list",
                    as: "friend",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $or: [
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$localID']
                                  }
                                },
                                {
                                  "friendlist.email": email
                                }
                              ]
                            },
                            {
                              $and: [
                                {
                                  $expr: {
                                    $eq: ['$email', '$$user']
                                  }
                                },
                                {
                                  "friendlist.email": '$userAuth.email'
                                }
                              ]
                            }
                          ]
                        }
                      },
                      {
                        $project: {
                          friend:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $size: '$friendlist'
                                }, 0]
                              },
                              then: 3,
                              else: 0
                            }
                          },

                        }
                      },

                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "follower",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "receiverParty": email
                            },
                            {
                              "eventType": "FOLLOWER",

                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          follower:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 2,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  "$lookup": {
                    from: "contentevents",
                    as: "following",
                    let: {
                      localID: '$userAuth.email',
                      user: email
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $expr: {
                                $eq: ['$email', '$$localID']
                              }
                            },
                            {
                              "senderParty": email
                            },
                            {
                              "eventType": "FOLLOWING"
                            },
                            {
                              "event": "ACCEPT"
                            },
                            {
                              "active": true
                            },

                          ]
                        }
                      },
                      {
                        $project: {
                          following:
                          {
                            $cond: {
                              if: {
                                $gt: [{
                                  $strLenCP: "$email"
                                }, 0]
                              },
                              then: 1,
                              else: 0
                            }
                          },

                        }
                      }
                    ]
                  },

                },
                {
                  $project: {
                    "dodol": {
                      $ifNull: ["$userAuth.username", "kosong"]
                    },
                    "friend": {
                      $arrayElemAt: ["$friend.friend", 0]
                    },
                    "follower":
                    {
                      $arrayElemAt: ["$follower.follower", 0]
                    },
                    "following":
                    {
                      $arrayElemAt: ["$following.following", 0]
                    },
                    "statusEN":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "FRIEND",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "FOLLOWING",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "FOLLOWER",
                                else: "NOT CONNECTED"
                              }
                            },

                          }
                        },

                      }
                    },
                    "statusID":
                    {
                      $cond: {
                        if: {
                          $gt: [{
                            $arrayElemAt: ["$friend.friend", 0]
                          }, 0]
                        },
                        then: "PERTEMANAN",
                        else:
                        {
                          $cond: {
                            if: {
                              $gt: [{
                                $arrayElemAt: ["$follower.follower", 0]
                              }, 0]
                            },
                            then: "MENGIKUTI",
                            else:
                            {
                              $cond: {
                                if: {
                                  $gt: [{
                                    $arrayElemAt: ["$following.following", 0]
                                  }, 0]
                                },
                                then: "PENGIKUT",
                                else: "BELUM TERHUBUNG"
                              }
                            },

                          }
                        },

                      }
                    },
                    "fullName": "$userBasic.fullName",
                    "profilePict": "$userBasic.profilePict",
                    "profilePicts": "$userBasic.profilePicts",
                    "username": "$userAuth.username",
                    "length": "$userAuth.length",
                    "score": "$userAuth.score",
                    "totScore": {
                      $sum: [{
                        $arrayElemAt: ["$friend.friend", 0]
                      }, "$userAuth.score"]
                    },
                    "email": "$userAuth.email",
                    "avatar":
                    {
                      $cond: {
                        if: {
                          $eq: [{
                            $arrayElemAt: ["$avatar.mediaType", {
                              "$indexOfArray": [
                                "$avatar.mediaID",
                                '$userBasic.profilePict.$id'
                              ]
                            }]
                          }, "image"]
                        },
                        then: "$avatar",
                        else: "$taslimKONAG"
                      }
                    },

                  }
                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    friend: - 1,
                    follower: - 1,
                    following: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "tags":
              [
                {
                  $lookup: {
                    from: "tag_count",
                    pipeline: [
                      {
                        $match:
                        {
                          "_id": {
                            $regex: key
                          }
                        }
                      },
                      {
                        $set: {
                          score: {
                            $indexOfCP: ["$_id", "de"]
                          }
                        }
                      },
                      {
                        $set: {
                          length: {
                            $strLenCP: "$_id"
                          }
                        }
                      },
                      {
                        $set: {
                          dodol: "kancut"
                        }
                      },
                      {
                        $project: {
                          name: "$_id",
                          total: 1,
                          score: 1,
                          length: 1,
                          dodol: {
                            $ifNull: ["$_id", "kosong"]
                          },

                        }
                      },

                    ],
                    as: "tag"
                  },

                },
                {
                  $unwind: {
                    path: "$tag",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  $project: {
                    tag: "$tag.name",
                    total: "$tag.total",
                    score: "$tag.score",
                    length: "$tag.length",
                    dodol: "$tag.dodol",

                  },

                },
                {
                  $sort: {
                    score: 1,
                    length: 1,
                    total: - 1
                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ]
          },

        },
        {
          $project: {
            user:
            {
              $cond: {
                if: {
                  $eq: [{
                    $arrayElemAt: ["$user.dodol", 0]
                  }, "kosong"]
                },
                then: "$saassaas",
                else: "$user"
              }
            },
            pict: "$pict",
            vid: "$vid",
            diary: "$diary",
            dodol: "$tags.dodol",
            tags:
            {
              $cond: {
                if: {
                  $gt: [{ $size: "$tags.dodol" }, 0]
                },
                then: "$tags",
                else: "$tagsssdsd"
              }
            },

          }
        });
    }
    else if (pict === true && vid === true && diary === true && user === false && tag === false) {
      pipeline.push(

        {
          $facet:
          {

            //pict
            "pict":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "pict"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $set: {
                          scorePict: {
                            $meta: "textScore"
                          }
                        }
                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "scorePict": 1,
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,

                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediapicts",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scorePict": "$pict.scorePict",
                    //  "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scorePict: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "vid":
              [
                {
                  $lookup: {
                    from: "posts",
                    let: {
                      name: "$dedy"
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "vid"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreVid": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediavideos",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreVid": "$pict.scoreVid",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreVid: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
            "diary":
              [
                {
                  $lookup: {
                    from: "posts",
                    pipeline: [
                      {
                        $match:
                        {
                          $and: [
                            {
                              $text: {
                                $search: key

                              }
                            },
                            {
                              "reportedStatus": {
                                $ne: "OWNED"
                              }
                            },
                            {
                              "visibility": "PUBLIC"
                            },
                            {
                              "active": true
                            },
                            {
                              "postType": "diary"
                            },
                            {
                              "reportedUser.email": {
                                $not: {
                                  $regex: email
                                }
                              }
                            },

                          ]
                        },

                      },
                      {
                        $project: {
                          // "boosted":
                          // {
                          //   $cond: {
                          //     if: {
                          //       $gt: [{
                          //         "$dateToString": {
                          //           "format": "%Y-%m-%d %H:%M:%S",
                          //           "date": {
                          //             $add: [new Date(), 25200000]
                          //           }
                          //         }
                          //       }, "$boosted.boostSession.timeEnd"]
                          //     },
                          //     then: [],
                          //     else: '$boosted'
                          //   }
                          // },
                          "reportedStatus": 1,
                          "insight": {
                            "shares": "$shares",
                            "comments": "$comments",
                            "views": "$views",
                            "likes": "$likes",

                          },
                          "comments": "$comments",
                          "likes": "$likes",
                          "_id": 1,
                          "postID": 1,
                          "createdAt": 1,
                          "updatedAt": 1,
                          "email": 1,
                          "postType": 1,
                          "description": 1,
                          "active": 1,
                          "metadata": 1,
                          "location": 1,
                          "isOwned": 1,
                          "visibility": 1,
                          "isViewed": 1,
                          "allowComments": 1,
                          "saleAmount": 1,
                          "isLiked": 1,
                          "scoreDiary": {
                            $meta: "textScore"
                          }
                        }
                      }
                    ],
                    as: "pict"
                  },

                },
                {
                  $unwind: {
                    path: "$pict",
                    preserveNullAndEmptyArrays: true
                  }
                },
                {
                  "$lookup": {
                    from: "mediadiaries",
                    as: "media",
                    let: {
                      localID: '$pict.postID'
                    },
                    pipeline: [
                      {
                        $match:
                        {
                          $expr: {
                            $eq: ['$postID', '$$localID']
                          }
                        }
                      },
                      {
                        $project: {

                          "apsara": 1,
                          "apsaraId": 1,
                          "apsaraThumbId": 1,
                          "mediaEndpoint": {
                            "$concat": ["/stream/", "$postID"]
                          },
                          "mediaUri": 1,
                          "mediaThumbEndpoint": {
                            "$concat": ["/thumb/", "$postID"]
                          },
                          "mediaThumbUri": 1,
                          "mediaType": 1,

                        }
                      }
                    ],

                  },

                },
                // {
                //   "$lookup": {
                //     from: "contentevents",
                //     as: "likes",
                //     let: {
                //       localID: '$pict.postID'
                //     },
                //     pipeline: [
                //       {
                //         $match:
                //         {
                //           $and: [
                //             {
                //               $expr: {
                //                 $eq: ['$postID', '$$localID']
                //               }
                //             },
                //             {
                //               "email": email

                //             },
                //             {
                //               "eventType": "LIKE"
                //             }
                //           ]
                //         }
                //       },

                //     ],

                //   },

                // },
                {
                  $project: {
                    "scoreDiary": "$pict.scoreDiary",
                    // "boosted": "$pict.boosted",
                    "reportedStatus": "$pict.reportedStatus",
                    "_id": "$pict._id",
                    "mediaThumbEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaThumbEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaEndpoint":
                    {
                      $arrayElemAt: ['$media.mediaEndpoint', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "mediaType":
                    {
                      $arrayElemAt: ['$media.mediaType', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "createdAt": "$pict.createdAt",
                    "updatedAt": "$pict.updatedAt",
                    "postID": "$pict.postID",
                    "email": "$pict.email",
                    "postType": "$pict.postType",
                    "description": "$pict.description",
                    "active": "$pict.active",
                    "metadata": "$pict.metadata",
                    "location": "$pict.location",
                    "isOwned": "$pict.isOwned",
                    "visibility": "$pict.visibility",
                    "isViewed": "$pict.isViewed",
                    "allowComments": "$pict.allowComments",
                    "saleAmount": "$pict.saleAmount",
                    "monetize":
                    {
                      $cond: {
                        if: {
                          $gte: ["$pict.saleAmount", 1]
                        },
                        then: true,
                        else: "$taslimKONAG"
                      }
                    },
                    "insight":
                    {
                      $ifNull: ["$pict.insight", "$TaslimKAMPRET"]
                    },
                    "comments": "$pict.comments",
                    "likes": "$pict.likes",
                    "apsaraId":
                    {
                      $arrayElemAt: ['$media.apsaraId', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    "isApsara":
                    {
                      $arrayElemAt: ['$media.apsara', {
                        "$indexOfArray": [
                          "$media.postID",
                          "$pict.postID"
                        ]
                      }]
                    },
                    // "isLiked":
                    // {
                    //   $cond: {
                    //     if: {
                    //       $eq: [{
                    //         $arrayElemAt: ["$likes.eventType", {
                    //           "$indexOfArray": [
                    //             "$likes.postID",
                    //             "$pict.postID"
                    //           ]
                    //         }]
                    //       }, "LIKE"]
                    //     },
                    //     then: true,
                    //     else: "$taslimKONAG"
                    //   }
                    // },

                  }
                },
                {
                  $sort: {
                    scoreDiary: - 1,
                    comments: - 1,
                    likes: - 1,

                  }
                },
                {
                  $skip: skip
                },
                {
                  $limit: limit
                },

              ],
          },

        },
        {
          $project: {

            pict: "$pict",
            vid: "$vid",
            diary: "$diary",


          }
        });
    }
    const query = await this.PostsModel.aggregate(pipeline);
    return query;
  }

  async landingpage(email: string, type: string, skip: number, limit: number) {
    var pipeline = [];
    var dataseting = null;
    var sortObject = null;




    if (type == "pict") {
      try {
        dataseting = await this.settingsService.findOneByJenis("PictLandingPage");
        sortObject = dataseting.sortObject;
      } catch (e) {
        dataseting = null;
        sortObject = {};
      }

      pipeline.push(
        {
          "$unwind": {
            "path": "$boosted",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$unwind": {
            "path": "$boosted.boostSession",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$set": {
            "timeStart": {

              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeStart"
              ]
            }
          }
        },
        {
          "$set": {
            "timeEnd": {
              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeEnd"
              ]
            }
          }
        },
        {
          $set: {

            "testDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), 25200000]
                }
              }
            }
          }
        },
        {
          $set: {
            "storyDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), - 61200000]
                }
              }
            }
          }
        },
        {
          $match:
          {
            $or: [
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "pict"
                  },
                  {
                    $expr: {
                      $lte: ["$boosted.boostSession.start", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$boosted.boostSession.end", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $lte: ["$timeStart", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$timeEnd", "$testDate",]
                    }
                  },
                  {

                    "timeStart": {
                      $ne: null
                    }
                  },
                  {

                    "timeEnd": {
                      $ne: null
                    }
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email
                          }
                        }
                      },

                    ]
                  },
                  {
                    $or: [
                      {
                        "boosted.boostViewer": {
                          "$elemMatch": {
                            "email": email,
                            "isLast": true,
                            "timeEnd": {
                              $lte: {
                                $add: [new Date(), 25200000]
                              }
                            }
                          }
                        }
                      },
                      {
                        $and: [
                          {
                            "boosted.boostViewer.email": {
                              $ne: email
                            }
                          },

                        ]
                      }
                    ]
                  }
                ]
              },
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "pict"
                  },
                  {
                    "timeStart": null
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email,

                          }
                        }
                      },

                    ]
                  },

                ]
              },

            ]
          }
        },
        {
          $sort: {
            "isBoost": - 1,
            "createdAt": - 1
          }
        },
        {
          $skip: skip
        },
        {
          $limit: limit
        },
        {
          "$lookup": {
            from: "disquslogs",
            let: {
              localID: '$postID',
            },
            as: "comment",
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    },
                    {
                      "active": { $ne: false }
                    },

                  ]
                }
              },
              {
                "$lookup": {
                  from: "userauths",
                  as: "userComment",
                  let: {
                    localID: '$sender'
                  },
                  pipeline: [
                    {
                      $match:
                      {
                        $expr: {
                          $eq: ['$email', '$$localID']
                        }
                      }
                    },
                    {
                      $project: {
                        "username": 1
                      }
                    }
                  ],
                }
              },
              {
                $unwind: {
                  path: "$userComment"
                }
              },
              {
                $sort: {
                  createdAt: -1
                }
              },
              {
                $limit: 2
              },
            ]
          },
        },
        {
          "$lookup": {
            from: "friend_list",
            as: "friend",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $or: [
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        },
                        {
                          "friendlist.email": email
                        }
                      ]
                    },
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$user']
                          }
                        },
                        {
                          "friendlist.email": '$.email'
                        }
                      ]
                    }
                  ]
                }
              },
              {
                $project: {
                  friend:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $size: '$friendlist'
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              },

            ]
          },

        },
        {
          "$lookup": {
            from: "contentevents",
            as: "follower",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$receiverParty', '$$localID']
                      }
                    },
                    {
                      "email": email
                    },
                    {
                      "eventType": "FOLLOWER",

                    },
                    {
                      "event": "ACCEPT"
                    },
                    {
                      "active": true
                    },

                  ]
                }
              },
              {
                $project: {
                  follower:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $strLenCP: "$email"
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              }
            ]
          },

        },
        {
          "$lookup": {
            from: "mediapicts",
            as: "media",
            let: {
              localID: '$postID'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$postID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "apsara": 1,
                  "apsaraId": 1,
                  "apsaraThumbId": 1,
                  "mediaUri": 1,
                  "postID": 1,
                  "mediaEndpoint": {
                    "$concat": ["/pict/", "$mediaUri"]
                  },
                  "mediaThumbEndpoint": {
                    "$concat": ["/thumb/", "$postID"]
                  },
                  "mediaThumbUri": "$mediaThumb",
                  "mediaType": 1,

                }
              }
            ],

          },

        },
        {
          "$lookup": {
            from: "interests_repo",
            as: "cats",
            let: {
              localID: '$category.$id'
            },
            pipeline: [
              {
                $match: {

                  $expr: {
                    $and: [
                      {
                        $in: ['$_id', {
                          $ifNull: ['$$localID', []]
                        }]
                      },

                    ]
                  }
                }
              },
              {
                $project: {
                  "interestName": 1,
                  "langIso": 1,
                  "icon": 1,
                  "createdAt": 1,
                  "updatedAt": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userInterest",
            let: {
              localID: email
            },
            pipeline: [
              {
                $match: {
                  $expr: {
                    $and: [
                      {
                        $eq: ["$email", "$$localID"]
                      },
                    ]
                  }
                }
              },
              {
                $project: {
                  userInterests: "$userInterests.$id",
                  email: 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "userTag",
            let: {
              localID: '$tagPeople.$id'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $in: ['$_id', {
                      $ifNull: ['$$localID', []]
                    }]
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "username",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userBasic",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "fullName": 1,
                  "profilePict": 1,
                  "isCelebrity": 1,
                  "isIdVerified": 1,
                  "isPrivate": 1,

                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$userBasic",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          "$lookup": {
            from: "mediaprofilepicts",
            as: "avatar",
            let: {
              localID: '$userBasic.profilePict.$id'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$mediaID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "mediaBasePath": 1,
                  "mediaUri": 1,
                  "originalName": 1,
                  "fsSourceUri": 1,
                  "fsSourceName": 1,
                  "fsTargetUri": 1,
                  "mediaType": 1,
                  "mediaEndpoint": {
                    "$concat": ["/profilepict/", "$mediaID"]
                  }
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "mediamusic",
            as: "music",
            let: {
              localID: '$musicId'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$_id', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "musicTitle": 1,
                  "artistName": 1,
                  "albumName": 1,
                  "apsaraMusic": 1,
                  "apsaraThumnail": 1,
                  "genre": "$genre.name",
                  "theme": "$theme.name",
                  "mood": "$mood.name",

                }
              },
              {
                $unwind: {
                  path: "$genre",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$theme",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$mood",
                  preserveNullAndEmptyArrays: true
                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$media",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$username",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$music",
            preserveNullAndEmptyArrays: true
          }
        },

        {
          $unwind: {
            path: "$userInterest"
          }
        },
        {
          $project: {
            comment: 1,
            interest: {
              $filter: {
                input: "$category",
                as: "stud",
                cond: {
                  $in: [
                    "$$stud.$id",
                    "$userInterest.userInterests"
                  ]
                }
              }
            },
            "friend": {
              $ifNull: [{
                $arrayElemAt: ["$friend.friend", 0]
              }, 0]
            },
            "follower": {
              $ifNull: [{
                $arrayElemAt: ["$follower.follower", 0]
              }, 0]
            },
            "musicTitle": "$music.musicTitle",
            "postID": 1,
            "artistName": "$music.artistName",
            "albumName": "$music.albumName",
            "apsaraMusic": "$music.apsaraMusic",
            "apsaraThumnail": "$music.apsaraThumnail",
            "genre": "$music.genre.name",
            "theme": "$music.theme.name",
            "mood": "$music.mood.name",
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": "$userTag",
            "mediaType": "$media.mediaType",
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": "$likes",
            "views": "$views",
            "shares": "$shares",
            "comments": "$comments",
            "insight": [
              {
                "likes": "$likes",
                "views": "$views",
                "shares": "$shares",
                "comments": "$comments",

              }
            ],
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": "$boosted.boostSession.end",
            "start": "$boosted.boostSession.start",
            "isBoost": {
              $ifNull: ["$isBoost", 0]
            },
            "boostViewer": 1,
            "boostCount": 1,
            "boosted":
              [{
                $cond: {
                  if: {
                    $gt: [{
                      "$dateToString": {
                        "format": "%Y-%m-%d %H:%M:%S",
                        "date": {
                          $add: [new Date(), 25200000]
                        }
                      }
                    }, "$boosted.boostSession.end"]
                  },
                  then: "$kampretTaslim",
                  else: '$boosted'
                }
              }],
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": "$media.apsara",
            "apsaraId": "$media.apsaraId",
            "apsaraThumbId": "$media.apsaraThumbId",
            "mediaEndpoint": "$media.mediaEndpoint",
            "mediaUri": "$media.mediaUri",
            "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
            "mediaThumbUri": "$media.mediaThumbUri",
            "fullName": "$userBasic.fullName",
            "username": "$username.username",
            "avatar": 1,
            "statusCB": 1,
            "privacy": [{
              "isCelebrity": "$userBasic.isCelebrity"
            }, {
              "isIdVerified": "$userBasic.isIdVerified"
            }, {
              "isPrivate": "$userBasic.isPrivate"
            }]
          },

        },
        {
          $project: {
            comment: 1,
            intScore: { $size: "$interest" },
            "friend": 1,
            "follower": 1,
            "musicTitle": 1,
            "postID": 1,
            "artistName": 1,
            "albumName": 1,
            "apsaraMusic": 1,
            "apsaraThumnail": 1,
            "genre": 1,
            "theme": 1,
            "mood": 1,
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": 1,
            "mediaType": 1,
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": 1,
            "views": 1,
            "shares": 1,
            "comments": 1,
            "insight": 1,
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": 1,
            "start": 1,
            "isBoost": 1,
            "boostViewer": 1,
            "boostCount": 1,
            "boosted": 1,
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": 1,
            "apsaraId": 1,
            "apsaraThumbId": 1,
            "mediaEndpoint": 1,
            "mediaUri": 1,
            "mediaThumbEndpoint": 1,
            "mediaThumbUri": 1,
            "fullName": 1,
            "username": 1,
            "avatar": 1,
            "statusCB": 1,
            "privacy": 1,
          },

        },

      );

      pipeline.push(
        {
          $sort: sortObject
        },
      );
    }
    else if (type == "vid") {
      try {
        dataseting = await this.settingsService.findOneByJenis("VidLandingPage");
        sortObject = dataseting.sortObject;
      } catch (e) {
        dataseting = null;
        sortObject = {};
      }

      pipeline.push(
        {
          "$unwind": {
            "path": "$boosted",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$unwind": {
            "path": "$boosted.boostSession",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$set": {
            "timeStart": {

              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeStart"
              ]
            }
          }
        },
        {
          "$set": {
            "timeEnd": {
              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeEnd"
              ]
            }
          }
        },
        {
          $set: {

            "testDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), 25200000]
                }
              }
            }
          }
        },
        {
          $set: {
            "storyDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), - 61200000]
                }
              }
            }
          }
        },
        {
          $match:
          {
            $or: [
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "vid"
                  },
                  {
                    $expr: {
                      $lte: ["$boosted.boostSession.start", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$boosted.boostSession.end", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $lte: ["$timeStart", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$timeEnd", "$testDate",]
                    }
                  },
                  {

                    "timeStart": {
                      $ne: null
                    }
                  },
                  {

                    "timeEnd": {
                      $ne: null
                    }
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email
                          }
                        }
                      },

                    ]
                  },
                  {
                    $or: [
                      {
                        "boosted.boostViewer": {
                          "$elemMatch": {
                            "email": email,
                            "isLast": true,
                            "timeEnd": {
                              $lte: {
                                $add: [new Date(), 25200000]
                              }
                            }
                          }
                        }
                      },
                      {
                        $and: [
                          {
                            "boosted.boostViewer.email": {
                              $ne: email
                            }
                          },

                        ]
                      }
                    ]
                  }
                ]
              },
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "vid"
                  },
                  {
                    "timeStart": null
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email,

                          }
                        }
                      },

                    ]
                  },

                ]
              },

            ]
          }
        },
        {
          $sort: {
            "isBoost": - 1,
            "createdAt": - 1
          }
        },
        {
          $skip: skip
        },
        {
          $limit: limit
        },
        {
          "$lookup": {
            from: "disquslogs",
            let: {
              localID: '$postID',
            },
            as: "comment",
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    },
                    {
                      "active": { $ne: false }
                    },

                  ]
                }
              },
              {
                "$lookup": {
                  from: "userauths",
                  as: "userComment",
                  let: {
                    localID: '$sender'
                  },
                  pipeline: [
                    {
                      $match:
                      {
                        $expr: {
                          $eq: ['$email', '$$localID']
                        }
                      }
                    },
                    {
                      $project: {
                        "username": 1
                      }
                    }
                  ],
                }
              },
              {
                $unwind: {
                  path: "$userComment"
                }
              },
              {
                $sort: {
                  createdAt: -1
                }
              },
              {
                $limit: 2
              },
            ]
          },
        },
        {
          "$lookup": {
            from: "friend_list",
            as: "friend",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $or: [
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        },
                        {
                          "friendlist.email": email
                        }
                      ]
                    },
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$user']
                          }
                        },
                        {
                          "friendlist.email": '$.email'
                        }
                      ]
                    }
                  ]
                }
              },
              {
                $project: {
                  friend:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $size: '$friendlist'
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              },

            ]
          },

        },
        {
          "$lookup": {
            from: "contentevents",
            as: "follower",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$receiverParty', '$$localID']
                      }
                    },
                    {
                      "email": email
                    },
                    {
                      "eventType": "FOLLOWER",

                    },
                    {
                      "event": "ACCEPT"
                    },
                    {
                      "active": true
                    },

                  ]
                }
              },
              {
                $project: {
                  follower:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $strLenCP: "$email"
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              }
            ]
          },

        },
        {
          "$lookup": {
            from: "mediavideos",
            as: "media",
            let: {
              localID: '$postID'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$postID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "apsara": 1,
                  "apsaraId": 1,
                  "apsaraThumbId": 1,
                  "mediaUri": 1,
                  "postID": 1,
                  "mediaEndpoint": {
                    "$concat": ["/pict/", "$mediaUri"]
                  },
                  "mediaThumbEndpoint": {
                    "$concat": ["/thumb/", "$postID"]
                  },
                  "mediaThumbUri": "$mediaThumb",
                  "mediaType": 1,

                }
              }
            ],

          },

        },
        {
          "$lookup": {
            from: "interests_repo",
            as: "cats",
            let: {
              localID: '$category.$id'
            },
            pipeline: [
              {
                $match: {

                  $expr: {
                    $and: [
                      {
                        $in: ['$_id', {
                          $ifNull: ['$$localID', []]
                        }]
                      },

                    ]
                  }
                }
              },
              {
                $project: {
                  "interestName": 1,
                  "langIso": 1,
                  "icon": 1,
                  "createdAt": 1,
                  "updatedAt": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userInterest",
            let: {
              localID: email
            },
            pipeline: [
              {
                $match: {
                  $expr: {
                    $and: [
                      {
                        $eq: ["$email", "$$localID"]
                      },
                    ]
                  }
                }
              },
              {
                $project: {
                  userInterests: "$userInterests.$id",
                  email: 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "userTag",
            let: {
              localID: '$tagPeople.$id'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $in: ['$_id', {
                      $ifNull: ['$$localID', []]
                    }]
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "username",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userBasic",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "fullName": 1,
                  "profilePict": 1,
                  "isCelebrity": 1,
                  "isIdVerified": 1,
                  "isPrivate": 1,

                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$userBasic",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          "$lookup": {
            from: "mediaprofilepicts",
            as: "avatar",
            let: {
              localID: '$userBasic.profilePict.$id'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$mediaID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "mediaBasePath": 1,
                  "mediaUri": 1,
                  "originalName": 1,
                  "fsSourceUri": 1,
                  "fsSourceName": 1,
                  "fsTargetUri": 1,
                  "mediaType": 1,
                  "mediaEndpoint": {
                    "$concat": ["/profilepict/", "$mediaID"]
                  }
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "mediamusic",
            as: "music",
            let: {
              localID: '$musicId'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$_id', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "musicTitle": 1,
                  "artistName": 1,
                  "albumName": 1,
                  "apsaraMusic": 1,
                  "apsaraThumnail": 1,
                  "genre": "$genre.name",
                  "theme": "$theme.name",
                  "mood": "$mood.name",

                }
              },
              {
                $unwind: {
                  path: "$genre",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$theme",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$mood",
                  preserveNullAndEmptyArrays: true
                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$media",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$username",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$music",
            preserveNullAndEmptyArrays: true
          }
        },

        {
          $unwind: {
            path: "$userInterest"
          }
        },
        {
          $project: {
            comment: 1,
            interest: {
              $filter: {
                input: "$category",
                as: "stud",
                cond: {
                  $in: [
                    "$$stud.$id",
                    "$userInterest.userInterests"
                  ]
                }
              }
            },
            "friend": {
              $ifNull: [{
                $arrayElemAt: ["$friend.friend", 0]
              }, 0]
            },
            "follower": {
              $ifNull: [{
                $arrayElemAt: ["$follower.follower", 0]
              }, 0]
            },
            "musicTitle": "$music.musicTitle",
            "postID": 1,
            "artistName": "$music.artistName",
            "albumName": "$music.albumName",
            "apsaraMusic": "$music.apsaraMusic",
            "apsaraThumnail": "$music.apsaraThumnail",
            "genre": "$music.genre.name",
            "theme": "$music.theme.name",
            "mood": "$music.mood.name",
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": "$userTag",
            "mediaType": "$media.mediaType",
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": "$likes",
            "views": "$views",
            "shares": "$shares",
            "comments": "$comments",
            "insight": [
              {
                "likes": "$likes",
                "views": "$views",
                "shares": "$shares",
                "comments": "$comments",

              }
            ],
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": "$boosted.boostSession.end",
            "start": "$boosted.boostSession.start",
            "isBoost": {
              $ifNull: ["$isBoost", 0]
            },
            "boostViewer": 1,
            "boostCount": 1,
            "boosted":
              [{
                $cond: {
                  if: {
                    $gt: [{
                      "$dateToString": {
                        "format": "%Y-%m-%d %H:%M:%S",
                        "date": {
                          $add: [new Date(), 25200000]
                        }
                      }
                    }, "$boosted.boostSession.end"]
                  },
                  then: "$kampretTaslim",
                  else: '$boosted'
                }
              }],
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": "$media.apsara",
            "apsaraId": "$media.apsaraId",
            "apsaraThumbId": "$media.apsaraThumbId",
            "mediaEndpoint": "$media.mediaEndpoint",
            "mediaUri": "$media.mediaUri",
            "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
            "mediaThumbUri": "$media.mediaThumbUri",
            "fullName": "$userBasic.fullName",
            "username": "$username.username",
            "avatar": 1,
            "statusCB": 1,
            "privacy": [{
              "isCelebrity": "$userBasic.isCelebrity"
            }, {
              "isIdVerified": "$userBasic.isIdVerified"
            }, {
              "isPrivate": "$userBasic.isPrivate"
            }]
          },

        },
        {
          $project: {
            comment: 1,
            intScore: { $size: "$interest" },
            "friend": 1,
            "follower": 1,
            "musicTitle": 1,
            "postID": 1,
            "artistName": 1,
            "albumName": 1,
            "apsaraMusic": 1,
            "apsaraThumnail": 1,
            "genre": 1,
            "theme": 1,
            "mood": 1,
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": 1,
            "mediaType": 1,
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": 1,
            "views": 1,
            "shares": 1,
            "comments": 1,
            "insight": 1,
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": 1,
            "start": 1,
            "isBoost": 1,
            "boostViewer": 1,
            "boostCount": 1,
            "boosted": 1,
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": 1,
            "apsaraId": 1,
            "apsaraThumbId": 1,
            "mediaEndpoint": 1,
            "mediaUri": 1,
            "mediaThumbEndpoint": 1,
            "mediaThumbUri": 1,
            "fullName": 1,
            "username": 1,
            "avatar": 1,
            "statusCB": 1,
            "privacy": 1,
          },

        },

      );

      pipeline.push(
        {
          $sort: sortObject
        },
      );
    }
    else if (type == "diary") {
      try {
        dataseting = await this.settingsService.findOneByJenis("DiaryLandingPage");
        sortObject = dataseting.sortObject;
      } catch (e) {
        dataseting = null;
        sortObject = {};
      }

      pipeline.push(
        {
          "$unwind": {
            "path": "$boosted",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$unwind": {
            "path": "$boosted.boostSession",
            "preserveNullAndEmptyArrays": true
          }
        },
        {
          "$set": {
            "timeStart": {

              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeStart"
              ]
            }
          }
        },
        {
          "$set": {
            "timeEnd": {
              "$concat": [
                {
                  "$dateToString": {
                    "format": "%Y-%m-%d",
                    "date": new Date()
                  }
                },
                " ",
                "$boosted.boostSession.timeEnd"
              ]
            }
          }
        },
        {
          $set: {

            "testDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), 25200000]
                }
              }
            }
          }
        },
        {
          $set: {
            "storyDate":
            {
              "$dateToString": {
                "format": "%Y-%m-%d %H:%M:%S",
                "date": {
                  $add: [new Date(), - 61200000]
                }
              }
            }
          }
        },
        {
          $match:
          {
            $or: [
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "diary"
                  },
                  {
                    $expr: {
                      $lte: ["$boosted.boostSession.start", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$boosted.boostSession.end", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $lte: ["$timeStart", "$testDate",]
                    }
                  },
                  {
                    $expr: {
                      $gt: ["$timeEnd", "$testDate",]
                    }
                  },
                  {

                    "timeStart": {
                      $ne: null
                    }
                  },
                  {

                    "timeEnd": {
                      $ne: null
                    }
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email
                          }
                        }
                      },

                    ]
                  },
                  {
                    $or: [
                      {
                        "boosted.boostViewer": {
                          "$elemMatch": {
                            "email": email,
                            "isLast": true,
                            "timeEnd": {
                              $lte: {
                                $add: [new Date(), 25200000]
                              }
                            }
                          }
                        }
                      },
                      {
                        $and: [
                          {
                            "boosted.boostViewer.email": {
                              $ne: email
                            }
                          },

                        ]
                      }
                    ]
                  }
                ]
              },
              {
                $and: [
                  {
                    "reportedStatus": {
                      $ne: "OWNED"
                    }
                  },
                  {
                    "visibility": "PUBLIC"
                  },
                  {
                    "active": true
                  },
                  {
                    "postType": "diary"
                  },
                  {
                    "timeStart": null
                  },
                  {
                    $or: [
                      {
                        "reportedUser": {
                          "$elemMatch": {
                            "email": email,
                            "active": false,

                          }
                        }
                      },
                      {
                        "reportedUser.email": {
                          $not: {
                            $regex: email,

                          }
                        }
                      },

                    ]
                  },

                ]
              },

            ]
          }
        },
        {
          $sort: {
            "isBoost": - 1,
            "createdAt": - 1
          }
        },
        {
          $skip: skip
        },
        {
          $limit: limit
        },
        {
          "$lookup": {
            from: "disquslogs",
            let: {
              localID: '$postID',
            },
            as: "comment",
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$postID', '$$localID']
                      }
                    },
                    {
                      "active": { $ne: false }
                    },

                  ]
                }
              },
              {
                "$lookup": {
                  from: "userauths",
                  as: "userComment",
                  let: {
                    localID: '$sender'
                  },
                  pipeline: [
                    {
                      $match:
                      {
                        $expr: {
                          $eq: ['$email', '$$localID']
                        }
                      }
                    },
                    {
                      $project: {
                        "username": 1
                      }
                    }
                  ],
                }
              },
              {
                $unwind: {
                  path: "$userComment"
                }
              },
              {
                $sort: {
                  createdAt: -1
                }
              },
              {
                $limit: 2
              },
            ]
          },
        },
        {
          "$lookup": {
            from: "friend_list",
            as: "friend",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $or: [
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$localID']
                          }
                        },
                        {
                          "friendlist.email": email
                        }
                      ]
                    },
                    {
                      $and: [
                        {
                          $expr: {
                            $eq: ['$email', '$$user']
                          }
                        },
                        {
                          "friendlist.email": '$.email'
                        }
                      ]
                    }
                  ]
                }
              },
              {
                $project: {
                  friend:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $size: '$friendlist'
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              },

            ]
          },

        },
        {
          "$lookup": {
            from: "contentevents",
            as: "follower",
            let: {
              localID: '$email',
              user: email
            },
            pipeline: [
              {
                $match:
                {
                  $and: [
                    {
                      $expr: {
                        $eq: ['$receiverParty', '$$localID']
                      }
                    },
                    {
                      "email": email
                    },
                    {
                      "eventType": "FOLLOWER",

                    },
                    {
                      "event": "ACCEPT"
                    },
                    {
                      "active": true
                    },

                  ]
                }
              },
              {
                $project: {
                  follower:
                  {
                    $cond: {
                      if: {
                        $gt: [{
                          $strLenCP: "$email"
                        }, 0]
                      },
                      then: 1,
                      else: 0
                    }
                  },

                }
              }
            ]
          },

        },
        {
          "$lookup": {
            from: "mediadiaries",
            as: "media",
            let: {
              localID: '$postID'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$postID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "apsara": 1,
                  "apsaraId": 1,
                  "apsaraThumbId": 1,
                  "mediaUri": 1,
                  "postID": 1,
                  "mediaEndpoint": {
                    "$concat": ["/pict/", "$mediaUri"]
                  },
                  "mediaThumbEndpoint": {
                    "$concat": ["/thumb/", "$postID"]
                  },
                  "mediaThumbUri": "$mediaThumb",
                  "mediaType": 1,

                }
              }
            ],

          },

        },
        {
          "$lookup": {
            from: "interests_repo",
            as: "cats",
            let: {
              localID: '$category.$id'
            },
            pipeline: [
              {
                $match: {

                  $expr: {
                    $and: [
                      {
                        $in: ['$_id', {
                          $ifNull: ['$$localID', []]
                        }]
                      },

                    ]
                  }
                }
              },
              {
                $project: {
                  "interestName": 1,
                  "langIso": 1,
                  "icon": 1,
                  "createdAt": 1,
                  "updatedAt": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userInterest",
            let: {
              localID: email
            },
            pipeline: [
              {
                $match: {
                  $expr: {
                    $and: [
                      {
                        $eq: ["$email", "$$localID"]
                      },
                    ]
                  }
                }
              },
              {
                $project: {
                  userInterests: "$userInterests.$id",
                  email: 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "userTag",
            let: {
              localID: '$tagPeople.$id'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $in: ['$_id', {
                      $ifNull: ['$$localID', []]
                    }]
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userauths",
            as: "username",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {

                  "username": 1
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "userbasics",
            as: "userBasic",
            let: {
              localID: '$email'
            },
            pipeline: [
              {
                $match:
                {


                  $expr: {
                    $eq: ['$email', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "fullName": 1,
                  "profilePict": 1,
                  "isCelebrity": 1,
                  "isIdVerified": 1,
                  "isPrivate": 1,

                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$userBasic",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          "$lookup": {
            from: "mediaprofilepicts",
            as: "avatar",
            let: {
              localID: '$userBasic.profilePict.$id'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$mediaID', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "mediaBasePath": 1,
                  "mediaUri": 1,
                  "originalName": 1,
                  "fsSourceUri": 1,
                  "fsSourceName": 1,
                  "fsTargetUri": 1,
                  "mediaType": 1,
                  "mediaEndpoint": {
                    "$concat": ["/profilepict/", "$mediaID"]
                  }
                }
              }
            ],

          }
        },
        {
          "$lookup": {
            from: "mediamusic",
            as: "music",
            let: {
              localID: '$musicId'
            },
            pipeline: [
              {
                $match:
                {
                  $expr: {
                    $eq: ['$_id', '$$localID']
                  }
                }
              },
              {
                $project: {
                  "musicTitle": 1,
                  "artistName": 1,
                  "albumName": 1,
                  "apsaraMusic": 1,
                  "apsaraThumnail": 1,
                  "genre": "$genre.name",
                  "theme": "$theme.name",
                  "mood": "$mood.name",

                }
              },
              {
                $unwind: {
                  path: "$genre",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$theme",
                  preserveNullAndEmptyArrays: true
                }
              },
              {
                $unwind: {
                  path: "$mood",
                  preserveNullAndEmptyArrays: true
                }
              }
            ],

          }
        },
        {
          $unwind: {
            path: "$media",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$username",
            preserveNullAndEmptyArrays: true
          }
        },
        {
          $unwind: {
            path: "$music",
            preserveNullAndEmptyArrays: true
          }
        },

        {
          $unwind: {
            path: "$userInterest"
          }
        },
        {
          $project: {
            comment: 1,
            interest: {
              $filter: {
                input: "$category",
                as: "stud",
                cond: {
                  $in: [
                    "$$stud.$id",
                    "$userInterest.userInterests"
                  ]
                }
              }
            },
            "friend": {
              $ifNull: [{
                $arrayElemAt: ["$friend.friend", 0]
              }, 0]
            },
            "follower": {
              $ifNull: [{
                $arrayElemAt: ["$follower.follower", 0]
              }, 0]
            },
            "musicTitle": "$music.musicTitle",
            "postID": 1,
            "artistName": "$music.artistName",
            "albumName": "$music.albumName",
            "apsaraMusic": "$music.apsaraMusic",
            "apsaraThumnail": "$music.apsaraThumnail",
            "genre": "$music.genre.name",
            "theme": "$music.theme.name",
            "mood": "$music.mood.name",
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": "$userTag",
            "mediaType": "$media.mediaType",
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": "$likes",
            "views": "$views",
            "shares": "$shares",
            "comments": "$comments",
            "insight": [
              {
                "likes": "$likes",
                "views": "$views",
                "shares": "$shares",
                "comments": "$comments",

              }
            ],
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": "$boosted.boostSession.end",
            "start": "$boosted.boostSession.start",
            "isBoost": {
              $ifNull: ["$isBoost", 0]
            },
            "boostViewer": 1,
            "boostCount": 1,
            "boosted":
              [{
                $cond: {
                  if: {
                    $gt: [{
                      "$dateToString": {
                        "format": "%Y-%m-%d %H:%M:%S",
                        "date": {
                          $add: [new Date(), 25200000]
                        }
                      }
                    }, "$boosted.boostSession.end"]
                  },
                  then: "$kampretTaslim",
                  else: '$boosted'
                }
              }],
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": "$media.apsara",
            "apsaraId": "$media.apsaraId",
            "apsaraThumbId": "$media.apsaraThumbId",
            "mediaEndpoint": "$media.mediaEndpoint",
            "mediaUri": "$media.mediaUri",
            "mediaThumbEndpoint": "$media.mediaThumbEndpoint",
            "mediaThumbUri": "$media.mediaThumbUri",
            "fullName": "$userBasic.fullName",
            "username": "$username.username",
            "avatar": 1,
            "statusCB": 1,
            "privacy": [{
              "isCelebrity": "$userBasic.isCelebrity"
            }, {
              "isIdVerified": "$userBasic.isIdVerified"
            }, {
              "isPrivate": "$userBasic.isPrivate"
            }]
          },

        },
        {
          $project: {
            comment: 1,
            intScore: { $size: "$interest" },
            "friend": 1,
            "follower": 1,
            "musicTitle": 1,
            "postID": 1,
            "artistName": 1,
            "albumName": 1,
            "apsaraMusic": 1,
            "apsaraThumnail": 1,
            "genre": 1,
            "theme": 1,
            "mood": 1,
            "testDate": 1,
            "musicId": 1,
            "music": 1,
            "tagPeople": 1,
            "mediaType": 1,
            "email": 1,
            "postType": 1,
            "description": 1,
            "active": 1,
            "createdAt": 1,
            "updatedAt": 1,
            "expiration": 1,
            "visibility": 1,
            "location": 1,
            "tags": 1,
            "allowComments": 1,
            "isSafe": 1,
            "isOwned": 1,
            "certified": 1,
            "saleAmount": 1,
            "saleLike": 1,
            "saleView": 1,
            "isShared": 1,
            "likes": 1,
            "views": 1,
            "shares": 1,
            "comments": 1,
            "insight": 1,
            "userProfile": 1,
            "contentMedias": 1,
            "category": "$cats",
            "tagDescription": 1,
            "metadata": 1,
            "boostDate": 1,
            "end": 1,
            "start": 1,
            "isBoost": 1,
            "boostViewer": 1,
            "boostCount": 1,
            "boosted": 1,
            "contentModeration": 1,
            "reportedStatus": 1,
            "reportedUserCount": 1,
            "contentModerationResponse": 1,
            "reportedUser": 1,
            "timeStart": 1,
            "timeEnd": 1,
            "apsara": 1,
            "apsaraId": 1,
            "apsaraThumbId": 1,
            "mediaEndpoint": 1,
            "mediaUri": 1,
            "mediaThumbEndpoint": 1,
            "mediaThumbUri": 1,
            "fullName": 1,
            "username": 1,
            "avatar": 1,
            "statusCB": 1,
            "privacy": 1,
          },

        },

      );

      pipeline.push(
        {
          $sort: sortObject
        },
      );
    }
    var query = await this.PostsModel.aggregate(pipeline);
    return query;
  }

}


